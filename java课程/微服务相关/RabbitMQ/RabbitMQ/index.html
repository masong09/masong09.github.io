
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>RabbitMQ - 我的文档</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rabbitmq" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="我的文档" class="md-header__button md-logo" aria-label="我的文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            我的文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RabbitMQ
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/01%20Java%E6%A6%82%E8%BF%B0/01%20-%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/" class="md-tabs__link md-tabs__link--active">
        Java课程
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC1%E7%AB%A0%20%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/" class="md-tabs__link">
        Java就业面试
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      学习文档
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="我的文档" class="md-nav__button md-logo" aria-label="我的文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    我的文档
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Java课程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java课程" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Java课程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Java基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java基础" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Java基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_1" type="checkbox" id="__nav_1_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1_1">
          基础部分
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="基础部分" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_1">
          <span class="md-nav__icon md-icon"></span>
          基础部分
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/01%20Java%E6%A6%82%E8%BF%B0/01%20-%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        Java概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/02%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/02%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        基本语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/03%20%E6%95%B0%E7%BB%84/03%20%E6%95%B0%E7%BB%84/" class="md-nav__link">
        数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/04%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/04%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        面向对象
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/05%20%E5%BC%82%E5%B8%B8/05%20%E5%BC%82%E5%B8%B8/" class="md-nav__link">
        异常
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_2" type="checkbox" id="__nav_1_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1_2">
          高级部分
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="高级部分" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          高级部分
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/06%20%E5%B8%B8%E7%94%A8%E7%B1%BBAPI/06%20%E5%B8%B8%E7%94%A8%E7%B1%BBAPI/" class="md-nav__link">
        常用类API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/07%20%E9%9B%86%E5%90%88/07%20%E9%9B%86%E5%90%88/" class="md-nav__link">
        集合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/08%20%E6%B3%9B%E5%9E%8B/08%20%E6%B3%9B%E5%9E%8B/" class="md-nav__link">
        泛型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/09%20File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/09%20File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" class="md-nav__link">
        File类与IO流
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/10%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/10%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        网络编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/11%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/11%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/12%20%E5%8F%8D%E5%B0%84/12%20%E5%8F%8D%E5%B0%84/" class="md-nav__link">
        反射
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/13%20Java8%E6%96%B0%E7%89%B9%E6%80%A7/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" class="md-nav__link">
        Java8新特性
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          MySQL数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MySQL数据库" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          MySQL数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/MySQL5.7%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3/" class="md-nav__link">
        MySQL5.7安装文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/MySQL%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        MySQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/JDBC%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        JDBC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          JavaWeb阶段
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="JavaWeb阶段" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          JavaWeb阶段
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day01/day01_HTML%26CSS/" class="md-nav__link">
        HTML&CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day02/day02_JS%26%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="md-nav__link">
        JS&正则表达式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day03/day03_VUE%26%E4%B9%A6%E5%9F%8E%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        VUE&书城第一阶段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day04/day04_XML%26Tomcat%26Http%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        XML&Tomcat&Http协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day05/day05_Servlet/" class="md-nav__link">
        Servlet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day06/day06_Request%26Response/" class="md-nav__link">
        Request&Response
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day07/day07_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第二阶
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day08/day08_Thymeleaf/" class="md-nav__link">
        Thymeleaf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day09/day09_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第三阶段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day10/day10_%E4%BC%9A%E8%AF%9D%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%281%29/" class="md-nav__link">
        会话&书城项目第四阶段1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day11/day11_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第四阶段2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day12/day12_Filter%26Listener%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        Filter&Listener&书城项目第五阶段1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day13/day13_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第五阶段2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day14/day14_Ajax%26Axios%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%85%AD%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        Ajax&Axios&书城项目第六阶段
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          经典框架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="经典框架" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          经典框架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Spring%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Spring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/SpringMVC%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        SpringMVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/MyBatis%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        MyBatis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/SSM%20%E6%95%B4%E5%90%88%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        SSM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Maven%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Maven
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/%E6%A1%86%E6%9E%B6%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%B3%BB%E5%88%97%E4%B9%8BLinuxCentOS7/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Redis/" class="md-nav__link">
        Redis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" type="checkbox" id="__nav_1_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_5">
          微服务相关
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="微服务相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          微服务相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker/Docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ElasticSearch/ElasticSearch/" class="md-nav__link">
        ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RabbitMQ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        RabbitMQ
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-mq" class="md-nav__link">
    1. 消息队列(中间件)MQ
  </a>
  
    <nav class="md-nav" aria-label="1. 消息队列(中间件)MQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    百度华为面试题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mq" class="md-nav__link">
    MQ（消息队列）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mq_1" class="md-nav__link">
    为什么会产生消息MQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    消息队列应用场景
  </a>
  
    <nav class="md-nav" aria-label="消息队列应用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    应用解耦
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    异步处理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    流量削峰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#111-qpspv" class="md-nav__link">
    1.1.1 什么是QPS,PV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-pv-uv-pr" class="md-nav__link">
    1.1.2 什么是PV , UV , PR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mq_2" class="md-nav__link">
    MQ有哪些缺点？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-amqp-jms" class="md-nav__link">
    1.2. AMQP 和 JMS
  </a>
  
    <nav class="md-nav" aria-label="1.2. AMQP 和 JMS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-amqp" class="md-nav__link">
    1.2.1. AMQP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-jms" class="md-nav__link">
    1.2.2. JMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-amqp-jms" class="md-nav__link">
    1.2.3. AMQP 与 JMS 区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3. 消息队列产品
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-rabbitmq" class="md-nav__link">
    1.4. RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="1.4. RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-rabbitmq" class="md-nav__link">
    1.4.1 RabbitMQ简介
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-rabbitmq" class="md-nav__link">
    1.4.2 RabbitMQ 中的相关概念：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-rabbitmq" class="md-nav__link">
    2. 安装及配置RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="2. 安装及配置RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1. 下载和安装
  </a>
  
    <nav class="md-nav" aria-label="2.1. 下载和安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.1.1. 下载
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    2.1.2. 安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.1.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214" class="md-nav__link">
    2.1.4. 卸载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2. 管理界面
  </a>
  
    <nav class="md-nav" aria-label="2.2. 管理界面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    2.2.1. 添加用户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-virtual-hosts" class="md-nav__link">
    2.2.2. 创建Virtual Hosts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    2.2.3. 设置权限
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-rabbitmq" class="md-nav__link">
    3. RabbitMQ入门
  </a>
  
    <nav class="md-nav" aria-label="3. RabbitMQ入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1. 搭建示例工程
  </a>
  
    <nav class="md-nav" aria-label="3.1. 搭建示例工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    3.1.1. 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312" class="md-nav__link">
    3.1.2. 添加依赖
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2. 编写生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3. 编写消费者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-amqp" class="md-nav__link">
    4. AMQP
  </a>
  
    <nav class="md-nav" aria-label="4. AMQP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1. 相关概念介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-rabbitmq" class="md-nav__link">
    4.2. RabbitMQ运转流程
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-rabbitmq" class="md-nav__link">
    5. RabbitMQ工作模式
  </a>
  
    <nav class="md-nav" aria-label="5. RabbitMQ工作模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-work-queues" class="md-nav__link">
    5.1. Work queues工作队列模式
  </a>
  
    <nav class="md-nav" aria-label="5.1. Work queues工作队列模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511" class="md-nav__link">
    5.1.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512" class="md-nav__link">
    5.1.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.1.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_1" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513" class="md-nav__link">
    5.1.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514" class="md-nav__link">
    5.1.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2. 订阅模式类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-publishsubscribe" class="md-nav__link">
    5.3. Publish/Subscribe发布与订阅模式
  </a>
  
    <nav class="md-nav" aria-label="5.3. Publish/Subscribe发布与订阅模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531" class="md-nav__link">
    5.3.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532" class="md-nav__link">
    5.3.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.3.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_2" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_2" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533" class="md-nav__link">
    5.3.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#534" class="md-nav__link">
    5.3.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-routing" class="md-nav__link">
    5.4. Routing路由模式
  </a>
  
    <nav class="md-nav" aria-label="5.4. Routing路由模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541" class="md-nav__link">
    5.4.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542" class="md-nav__link">
    5.4.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.4.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_3" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_3" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#543" class="md-nav__link">
    5.4.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#544" class="md-nav__link">
    5.4.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-topics" class="md-nav__link">
    5.5. Topics通配符模式
  </a>
  
    <nav class="md-nav" aria-label="5.5. Topics通配符模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#551" class="md-nav__link">
    5.5.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#552" class="md-nav__link">
    5.5.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.5.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_4" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_4" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#553" class="md-nav__link">
    5.5.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#554" class="md-nav__link">
    5.5.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56" class="md-nav__link">
    5.6. 模式总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-spring-rabbitmq" class="md-nav__link">
    6 Spring 整合RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="6 Spring 整合RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1. 搭建生产者工程
  </a>
  
    <nav class="md-nav" aria-label="6.1. 搭建生产者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#611" class="md-nav__link">
    6.1.1. 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#612" class="md-nav__link">
    6.1.2. 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#613" class="md-nav__link">
    6.1.3. 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#614" class="md-nav__link">
    6.1.4. 发送消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2. 搭建消费者工程
  </a>
  
    <nav class="md-nav" aria-label="6.2. 搭建消费者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621" class="md-nav__link">
    6.2.1. 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622" class="md-nav__link">
    6.2.2. 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#623" class="md-nav__link">
    6.2.3. 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#624" class="md-nav__link">
    6.2.4. 消息监听器
  </a>
  
    <nav class="md-nav" aria-label="6.2.4. 消息监听器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1）队列监听器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_5" class="md-nav__link">
    2）广播监听器1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_5" class="md-nav__link">
    3）广播监听器2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4）星号通配符监听器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5）井号通配符监听器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62_1" class="md-nav__link">
    6）井号通配符监听器2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-rabbitmq" class="md-nav__link">
    7 RabbitMQ高级特性
  </a>
  
    <nav class="md-nav" aria-label="7 RabbitMQ高级特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    7.1 消息的可靠投递
  </a>
  
    <nav class="md-nav" aria-label="7.1 消息的可靠投递">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#711-confirm" class="md-nav__link">
    7.1.1 Confirm 确认机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#712-return" class="md-nav__link">
    7.1.2 Return回退机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#713" class="md-nav__link">
    7.1.3 消息的可靠投递小结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#714-consumer-ack" class="md-nav__link">
    7.1.4 Consumer Ack
  </a>
  
    <nav class="md-nav" aria-label="7.1.4 Consumer Ack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7141" class="md-nav__link">
    7.1.4.1 自动确认
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7142" class="md-nav__link">
    7.1.4.2 手动确认
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    7.2 消费端限流
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-ttl" class="md-nav__link">
    7.3 TTL
  </a>
  
    <nav class="md-nav" aria-label="7.3 TTL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#731" class="md-nav__link">
    7.3.1 控制后台演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#732" class="md-nav__link">
    7.3.2 代码实现
  </a>
  
    <nav class="md-nav" aria-label="7.3.2 代码实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7321" class="md-nav__link">
    7.3.2.1 队列统一过期
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7322" class="md-nav__link">
    7.3.2.2 消息过期
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    7.4 死信队列
  </a>
  
    <nav class="md-nav" aria-label="7.4 死信队列">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#741" class="md-nav__link">
    7.4.1 过期时间代码实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#742" class="md-nav__link">
    7.4.2 长度限制代码实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#743" class="md-nav__link">
    7.4.3 测试消息拒收
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    7.5 延迟队列
  </a>
  
    <nav class="md-nav" aria-label="7.5 延迟队列">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#751" class="md-nav__link">
    7.5.1 代码实现
  </a>
  
    <nav class="md-nav" aria-label="7.5.1 代码实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7511" class="md-nav__link">
    7.5.1.1 生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7512" class="md-nav__link">
    7.5.1.2 消费者
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-rabbitmq" class="md-nav__link">
    8 RabbitMQ集成微服务
  </a>
  
    <nav class="md-nav" aria-label="8 RabbitMQ集成微服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-rabbitadmin" class="md-nav__link">
    8.1 RabbitAdmin应用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-rabbitadmin" class="md-nav__link">
    8.2 RabbitAdmin源码分析
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-rabbitmq" class="md-nav__link">
    8.3 RabbitMQ声明式配置使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-rabbitmqspringboot" class="md-nav__link">
    8.4 RabbitMQ与SpringBoot整合
  </a>
  
    <nav class="md-nav" aria-label="8.4 RabbitMQ与SpringBoot整合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#841" class="md-nav__link">
    8.4.1 搭建生产者工程
  </a>
  
    <nav class="md-nav" aria-label="8.4.1 搭建生产者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8411" class="md-nav__link">
    8.4.1.1 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8412" class="md-nav__link">
    8.4.1.2 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8413" class="md-nav__link">
    8.4.1.3 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8414" class="md-nav__link">
    8.4.1.4 创建配置类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8415" class="md-nav__link">
    8.4.1.5 创建入口类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8416" class="md-nav__link">
    8.4.1.6 发送消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#842" class="md-nav__link">
    8.4.2 搭建消费者工程
  </a>
  
    <nav class="md-nav" aria-label="8.4.2 搭建消费者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8421" class="md-nav__link">
    8.4.2.1 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8422" class="md-nav__link">
    8.4.2.2 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8423" class="md-nav__link">
    8.4.2.3 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8424" class="md-nav__link">
    8.4.2.4 消息监听器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    9 消息百分百成功投递
  </a>
  
    <nav class="md-nav" aria-label="9 消息百分百成功投递">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    9.1 数据库文件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    10 消息幂等性保障
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-mq" class="md-nav__link">
    11 MQ高级集群操作
  </a>
  
    <nav class="md-nav" aria-label="11 MQ高级集群操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linuxmq" class="md-nav__link">
    安装Linux版本MQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    日志
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    集群和负载均衡操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SpringBoot/SpringBoot/" class="md-nav__link">
        SpringBoot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SpringCloud/SpringCloud/" class="md-nav__link">
        SpringCloud
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6">
          高级技术
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="高级技术" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          高级技术
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/git/Git%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/juc/JUC/" class="md-nav__link">
        JUC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/jvm/jvm/" class="md-nav__link">
        jvm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/mysql%E9%AB%98%E7%BA%A7/MySQL%E9%AB%98%E7%BA%A7/" class="md-nav__link">
        mysql高级
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/mysql%E9%AB%98%E7%BA%A7/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="md-nav__link">
        MySQL主从复制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/MyCat/Mycat/" class="md-nav__link">
        MyCat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/nginx/Nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7" type="checkbox" id="__nav_1_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7">
          项目文档
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="项目文档" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_7">
          <span class="md-nav__icon md-icon"></span>
          项目文档
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_1" type="checkbox" id="__nav_1_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_1">
          美年旅游
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="美年旅游" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_1">
          <span class="md-nav__icon md-icon"></span>
          美年旅游
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day01/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC1%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游01
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day02/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC2%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游02
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day03/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC3%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游03
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day04/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC4%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day05/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC5%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游05
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day06/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC6%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游06
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day07/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC7%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游07
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day08/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC8%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游08
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day09/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC9%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游09
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day10/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC10%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day11/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC11%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游11
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_2" type="checkbox" id="__nav_1_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_2">
          尚邻网
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚邻网" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_2">
          <span class="md-nav__icon md-icon"></span>
          尚邻网
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/1.%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/" class="md-nav__link">
        搭建环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/2.%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86/" class="md-nav__link">
        用户角色管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/3.Apache%20Dubbo/" class="md-nav__link">
        Apache Dubbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/4.%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/" class="md-nav__link">
        服务拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/5.%E4%BA%8C%E6%89%8B%E6%88%BF%E7%AE%A1%E7%90%86/" class="md-nav__link">
        二手房管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/6.%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/" class="md-nav__link">
        图片上传
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/7.%E5%89%8D%E7%AB%AF%E6%88%BF%E6%BA%90%E5%B1%95%E7%A4%BA/" class="md-nav__link">
        前端房源展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/8.%E5%89%8D%E7%AB%AF%E7%99%BB%E5%BD%95%E4%B8%8E%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%85%B3%E6%B3%A8/" class="md-nav__link">
        前端登录与注册与关注
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/9.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" class="md-nav__link">
        权限管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/10.spring%20security/" class="md-nav__link">
        spring security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/11.session%E5%85%B1%E4%BA%AB/" class="md-nav__link">
        session共享
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_3" type="checkbox" id="__nav_1_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_3">
          谷粒商城
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="谷粒商城" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_3">
          <span class="md-nav__icon md-icon"></span>
          谷粒商城
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/1.%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88nginx%E3%80%81cors%E3%80%81oss%EF%BC%89/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        谷粒商城01
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/2.%E5%88%86%E7%B1%BB%E3%80%81%E8%A7%84%E6%A0%BC%E3%80%81%E5%95%86%E5%93%81%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/" class="md-nav__link">
        谷粒商城02
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/3.%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8F%8Aseata/%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8F%8Aseata/" class="md-nav__link">
        谷粒商城03
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/4.elasticsearch%28DSL%E5%8F%8ASpringData-Elasticsearch%29/elasticsearch/" class="md-nav__link">
        谷粒商城04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/5.%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2/%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2/" class="md-nav__link">
        谷粒商城05
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/6.%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%EF%BC%88Thymeleaf%EF%BC%89%E5%8F%8A%E6%90%9C%E7%B4%A2%E9%A1%B5%E6%B8%B2%E6%9F%93/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf/" class="md-nav__link">
        谷粒商城06
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/7.%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%EF%BC%88RabbitMQ%EF%BC%89/%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" class="md-nav__link">
        谷粒商城07
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/8.%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%28%E7%BC%93%E5%AD%98%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E3%80%81Redisson%E3%80%81%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%29/%E9%A6%96%E9%A1%B5%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB/" class="md-nav__link">
        谷粒商城08
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/9.%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E5%8F%8A%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92%EF%BC%88CompletableFuture%EF%BC%89/%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5/" class="md-nav__link">
        谷粒商城09
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/10.%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/" class="md-nav__link">
        谷粒商城10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/11.%E8%B4%AD%E7%89%A9%E8%BD%A6%EF%BC%88SpringTask%EF%BC%89/%E8%B4%AD%E7%89%A9%E8%BD%A6/" class="md-nav__link">
        谷粒商城11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/12.%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88xxl-job%EF%BC%89/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88xxl-job%EF%BC%89/" class="md-nav__link">
        谷粒商城12
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/13.%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/" class="md-nav__link">
        谷粒商城13
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/14.%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/" class="md-nav__link">
        谷粒商城14
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_4" type="checkbox" id="__nav_1_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_4">
          尚融宝
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚融宝" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_4">
          <span class="md-nav__icon md-icon"></span>
          尚融宝
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part01-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/Part01-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
        项目介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part02-MyBatis-Plus/Part02-MyBatis-Plus/" class="md-nav__link">
        MyBatis-Plus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part03-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/Part03-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        后端接口工程搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part04-%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/Part04-%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        前端知识
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part05-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/Part05-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        管理平台前端搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part06-Alibaba%20EasyExcel/Part06-Alibaba%20EasyExcel/" class="md-nav__link">
        Alibaba EasyExcel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part07-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/Part07-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/" class="md-nav__link">
        数据字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part08-Redis%E7%BC%93%E5%AD%98/Part08-Redis%E7%BC%93%E5%AD%98/" class="md-nav__link">
        Redis缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part09-NuxtJS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93/Part09-NuxtJS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93/" class="md-nav__link">
        NuxtJS服务器端渲染
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part10-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1/Part10-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1/" class="md-nav__link">
        阿里云短信
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java课程/项目文档/尚融宝/Part11-分布式文件系统-阿里云OSS/分布式文件系统-阿里云OSS" class="md-nav__link">
        阿里云OSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C/Part12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C/" class="md-nav__link">
        用户注册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part13-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C/Part13-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C/" class="md-nav__link">
        访问令牌
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part14-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/Part14-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/" class="md-nav__link">
        用户认证
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part15-%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86/Part15-%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86/" class="md-nav__link">
        会员管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part16-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-OAuth2/Part16-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-OAuth2/" class="md-nav__link">
        OAuth2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part17-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/Part17-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="md-nav__link">
        内网穿透
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part18-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/Part18-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" class="md-nav__link">
        微信登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part19-%20SpringCloud/Part19-%20SpringCloud/" class="md-nav__link">
        SpringCloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part20-%E8%B4%A6%E6%88%B7%E7%BB%91%E5%AE%9A/Part20-%E8%B4%A6%E6%88%B7%E7%BB%91%E5%AE%9A/" class="md-nav__link">
        账户绑定
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part21-%E7%94%B3%E8%AF%B7%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6/Part21-%E7%94%B3%E8%AF%B7%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6/" class="md-nav__link">
        申请借款额度
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part22-%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6%E5%AE%A1%E6%A0%B8/Part22-%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6%E5%AE%A1%E6%A0%B8/" class="md-nav__link">
        借款额度审核
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part23-%E5%80%9F%E6%AC%BE%E7%94%B3%E8%AF%B7/Part23-%E5%80%9F%E6%AC%BE%E7%94%B3%E8%AF%B7/" class="md-nav__link">
        借款申请
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part24-%E5%80%9F%E6%AC%BE%E5%AE%A1%E6%A0%B8/Part24-%E5%80%9F%E6%AC%BE%E5%AE%A1%E6%A0%B8/" class="md-nav__link">
        借款审核
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part25-%E6%A0%87%E7%9A%84%E7%AE%A1%E7%90%86/Part25-%E6%A0%87%E7%9A%84%E7%AE%A1%E7%90%86/" class="md-nav__link">
        标的管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part26-%E6%88%91%E8%A6%81%E6%8A%95%E8%B5%84/Part26-%E6%88%91%E8%A6%81%E6%8A%95%E8%B5%84/" class="md-nav__link">
        我要投资
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part27-%E5%85%85%E5%80%BC/Part27-%E5%85%85%E5%80%BC/" class="md-nav__link">
        充值
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part28-%E6%8A%95%E6%A0%87/Part28-%E6%8A%95%E6%A0%87/" class="md-nav__link">
        投标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part29-%E6%94%BE%E6%AC%BE/Part29-%E6%94%BE%E6%AC%BE/" class="md-nav__link">
        放款
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part30-%E6%8A%95%E8%B5%84%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA/Part30-%E6%8A%95%E8%B5%84%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA/" class="md-nav__link">
        投资列表展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part31-%E6%8F%90%E7%8E%B0%E5%92%8C%E8%BF%98%E6%AC%BE/Part31-%E6%8F%90%E7%8E%B0%E5%92%8C%E8%BF%98%E6%AC%BE/" class="md-nav__link">
        提现和还款
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part32-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83/Part32-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83/" class="md-nav__link">
        个人中心
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part33-%E7%BD%91%E5%85%B3/Part33-%E7%BD%91%E5%85%B3/" class="md-nav__link">
        网关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part34-%E8%A1%A5%E5%85%85/Part34-%E8%A1%A5%E5%85%85/" class="md-nav__link">
        补充
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part35-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/Part35-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/" class="md-nav__link">
        微信支付
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_5" type="checkbox" id="__nav_1_7_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_5">
          尚医通
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚医通" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_5">
          <span class="md-nav__icon md-icon"></span>
          尚医通
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day01%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8EMyBatis%20Plus/day01%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%20Mybatis%20Plus/" class="md-nav__link">
        项目介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day02%20%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E5%8C%BB%E9%99%A2%E8%AE%BE%E7%BD%AE/day02%20%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E5%8C%BB%E9%99%A2%E8%AE%BE%E7%BD%AE/" class="md-nav__link">
        搭建环境和医院设置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day03%20%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/day03%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/" class="md-nav__link">
        前端基础知识（一）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day04%20%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%BA%8C%EF%BC%89/day04%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        前端基础知识（二）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day05%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/day05%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        平台管理前端搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day06%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/day06%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/" class="md-nav__link">
        数据字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day07mongodb/day07mongodb/" class="md-nav__link">
        mongodb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day08%E5%8C%BB%E9%99%A2%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3/day08%E5%8C%BB%E9%99%A2%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3/" class="md-nav__link">
        医院上传接口
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day09%E5%8C%BB%E9%99%A2%E7%AE%A1%E7%90%86/day09%E5%8C%BB%E9%99%A2%E7%AE%A1%E7%90%86/" class="md-nav__link">
        医院管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day10%E6%8E%92%E7%8F%AD%E7%AE%A1%E7%90%86%E5%92%8C%E7%BD%91%E5%85%B3/day10%E6%8E%92%E7%8F%AD%E7%AE%A1%E7%90%86%E5%92%8C%E7%BD%91%E5%85%B3/" class="md-nav__link">
        排班管理和网关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day11%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%A6%96%E9%A1%B5/day11%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%A6%96%E9%A1%B5/" class="md-nav__link">
        平台前端搭建与首页
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day12%E6%89%8B%E6%9C%BA%E7%99%BB%E5%BD%95/day12%E6%89%8B%E6%9C%BA%E7%99%BB%E5%BD%95/" class="md-nav__link">
        手机登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day13%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/day13%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" class="md-nav__link">
        微信登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day14%E9%98%BF%E9%87%8C%E4%BA%91OSS%E3%80%81%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%B0%B1%E8%AF%8A%E4%BA%BA/day14%E9%98%BF%E9%87%8C%E4%BA%91OSS%E3%80%81%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%B0%B1%E8%AF%8A%E4%BA%BA/" class="md-nav__link">
        阿里云OSS、用户认证与就诊人
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day15%E9%A2%84%E7%BA%A6%E6%8C%82%E5%8F%B7/day15%E9%A2%84%E7%BA%A6%E6%8C%82%E5%8F%B7/" class="md-nav__link">
        预约挂号
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day16%E9%A2%84%E7%BA%A6%E4%B8%8B%E5%8D%95/day16%E9%A2%84%E7%BA%A6%E4%B8%8B%E5%8D%95/" class="md-nav__link">
        预约下单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day17%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/day17%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/" class="md-nav__link">
        微信支付
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day18%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E7%BB%9F%E8%AE%A1/day18%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E7%BB%9F%E8%AE%A1/" class="md-nav__link">
        定时任务与统计
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Java就业面试
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java就业面试" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Java就业面试
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC1%E7%AB%A0%20%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        第1章 面试说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC2%E7%AB%A0%20%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/" class="md-nav__link">
        第2章 手写代码
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC3%E7%AB%A0%20JavaSE/" class="md-nav__link">
        第3章 JavaSE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC4%E7%AB%A0%20JVM/" class="md-nav__link">
        第4章 JVM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC5%E7%AB%A0%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        第5章 设计模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC6%E7%AB%A0%20MySql/" class="md-nav__link">
        第6章 MySql
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC7%E7%AB%A0%20Java%20Web/" class="md-nav__link">
        第7章 Java Web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC8%E7%AB%A0%20SSM%E6%A1%86%E6%9E%B6/" class="md-nav__link">
        第8章 SSM框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC9%E7%AB%A0%20SpringBoot/" class="md-nav__link">
        第9章 SpringBoot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC10%E7%AB%A0%20SpringCloud/" class="md-nav__link">
        第10章 SpringCloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC11%E7%AB%A0%20Redis/" class="md-nav__link">
        第11章 Redis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC12%E7%AB%A0%20MQ/" class="md-nav__link">
        第12章 MQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC13%E7%AB%A0%20ElasticSearch/" class="md-nav__link">
        第13章 ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC14%E7%AB%A0%20Dubbo/" class="md-nav__link">
        第14章 Dubbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC15%E7%AB%A0%20Zookeeper/" class="md-nav__link">
        第15章 Zookeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC16%E7%AB%A0%20Git/" class="md-nav__link">
        第16章 Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC17%E7%AB%A0%20Linux/" class="md-nav__link">
        第17章 Linux
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        学习文档
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-mq" class="md-nav__link">
    1. 消息队列(中间件)MQ
  </a>
  
    <nav class="md-nav" aria-label="1. 消息队列(中间件)MQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    百度华为面试题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mq" class="md-nav__link">
    MQ（消息队列）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mq_1" class="md-nav__link">
    为什么会产生消息MQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    消息队列应用场景
  </a>
  
    <nav class="md-nav" aria-label="消息队列应用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    应用解耦
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    异步处理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    流量削峰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#111-qpspv" class="md-nav__link">
    1.1.1 什么是QPS,PV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-pv-uv-pr" class="md-nav__link">
    1.1.2 什么是PV , UV , PR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mq_2" class="md-nav__link">
    MQ有哪些缺点？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-amqp-jms" class="md-nav__link">
    1.2. AMQP 和 JMS
  </a>
  
    <nav class="md-nav" aria-label="1.2. AMQP 和 JMS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-amqp" class="md-nav__link">
    1.2.1. AMQP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-jms" class="md-nav__link">
    1.2.2. JMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-amqp-jms" class="md-nav__link">
    1.2.3. AMQP 与 JMS 区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3. 消息队列产品
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-rabbitmq" class="md-nav__link">
    1.4. RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="1.4. RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-rabbitmq" class="md-nav__link">
    1.4.1 RabbitMQ简介
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-rabbitmq" class="md-nav__link">
    1.4.2 RabbitMQ 中的相关概念：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-rabbitmq" class="md-nav__link">
    2. 安装及配置RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="2. 安装及配置RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1. 下载和安装
  </a>
  
    <nav class="md-nav" aria-label="2.1. 下载和安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.1.1. 下载
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    2.1.2. 安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.1.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214" class="md-nav__link">
    2.1.4. 卸载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2. 管理界面
  </a>
  
    <nav class="md-nav" aria-label="2.2. 管理界面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    2.2.1. 添加用户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-virtual-hosts" class="md-nav__link">
    2.2.2. 创建Virtual Hosts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    2.2.3. 设置权限
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-rabbitmq" class="md-nav__link">
    3. RabbitMQ入门
  </a>
  
    <nav class="md-nav" aria-label="3. RabbitMQ入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1. 搭建示例工程
  </a>
  
    <nav class="md-nav" aria-label="3.1. 搭建示例工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    3.1.1. 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312" class="md-nav__link">
    3.1.2. 添加依赖
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2. 编写生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3. 编写消费者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-amqp" class="md-nav__link">
    4. AMQP
  </a>
  
    <nav class="md-nav" aria-label="4. AMQP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1. 相关概念介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-rabbitmq" class="md-nav__link">
    4.2. RabbitMQ运转流程
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-rabbitmq" class="md-nav__link">
    5. RabbitMQ工作模式
  </a>
  
    <nav class="md-nav" aria-label="5. RabbitMQ工作模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-work-queues" class="md-nav__link">
    5.1. Work queues工作队列模式
  </a>
  
    <nav class="md-nav" aria-label="5.1. Work queues工作队列模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511" class="md-nav__link">
    5.1.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512" class="md-nav__link">
    5.1.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.1.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_1" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513" class="md-nav__link">
    5.1.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514" class="md-nav__link">
    5.1.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2. 订阅模式类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-publishsubscribe" class="md-nav__link">
    5.3. Publish/Subscribe发布与订阅模式
  </a>
  
    <nav class="md-nav" aria-label="5.3. Publish/Subscribe发布与订阅模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531" class="md-nav__link">
    5.3.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532" class="md-nav__link">
    5.3.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.3.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_2" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_2" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533" class="md-nav__link">
    5.3.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#534" class="md-nav__link">
    5.3.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-routing" class="md-nav__link">
    5.4. Routing路由模式
  </a>
  
    <nav class="md-nav" aria-label="5.4. Routing路由模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541" class="md-nav__link">
    5.4.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542" class="md-nav__link">
    5.4.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.4.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_3" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_3" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#543" class="md-nav__link">
    5.4.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#544" class="md-nav__link">
    5.4.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-topics" class="md-nav__link">
    5.5. Topics通配符模式
  </a>
  
    <nav class="md-nav" aria-label="5.5. Topics通配符模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#551" class="md-nav__link">
    5.5.1. 模式说明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#552" class="md-nav__link">
    5.5.2. 代码
  </a>
  
    <nav class="md-nav" aria-label="5.5.2. 代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1）生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_4" class="md-nav__link">
    2）消费者1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_4" class="md-nav__link">
    3）消费者2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#553" class="md-nav__link">
    5.5.3. 测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#554" class="md-nav__link">
    5.5.4. 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56" class="md-nav__link">
    5.6. 模式总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-spring-rabbitmq" class="md-nav__link">
    6 Spring 整合RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="6 Spring 整合RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1. 搭建生产者工程
  </a>
  
    <nav class="md-nav" aria-label="6.1. 搭建生产者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#611" class="md-nav__link">
    6.1.1. 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#612" class="md-nav__link">
    6.1.2. 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#613" class="md-nav__link">
    6.1.3. 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#614" class="md-nav__link">
    6.1.4. 发送消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2. 搭建消费者工程
  </a>
  
    <nav class="md-nav" aria-label="6.2. 搭建消费者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621" class="md-nav__link">
    6.2.1. 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622" class="md-nav__link">
    6.2.2. 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#623" class="md-nav__link">
    6.2.3. 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#624" class="md-nav__link">
    6.2.4. 消息监听器
  </a>
  
    <nav class="md-nav" aria-label="6.2.4. 消息监听器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1）队列监听器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21_5" class="md-nav__link">
    2）广播监听器1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_5" class="md-nav__link">
    3）广播监听器2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4）星号通配符监听器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5）井号通配符监听器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62_1" class="md-nav__link">
    6）井号通配符监听器2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-rabbitmq" class="md-nav__link">
    7 RabbitMQ高级特性
  </a>
  
    <nav class="md-nav" aria-label="7 RabbitMQ高级特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    7.1 消息的可靠投递
  </a>
  
    <nav class="md-nav" aria-label="7.1 消息的可靠投递">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#711-confirm" class="md-nav__link">
    7.1.1 Confirm 确认机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#712-return" class="md-nav__link">
    7.1.2 Return回退机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#713" class="md-nav__link">
    7.1.3 消息的可靠投递小结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#714-consumer-ack" class="md-nav__link">
    7.1.4 Consumer Ack
  </a>
  
    <nav class="md-nav" aria-label="7.1.4 Consumer Ack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7141" class="md-nav__link">
    7.1.4.1 自动确认
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7142" class="md-nav__link">
    7.1.4.2 手动确认
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    7.2 消费端限流
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-ttl" class="md-nav__link">
    7.3 TTL
  </a>
  
    <nav class="md-nav" aria-label="7.3 TTL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#731" class="md-nav__link">
    7.3.1 控制后台演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#732" class="md-nav__link">
    7.3.2 代码实现
  </a>
  
    <nav class="md-nav" aria-label="7.3.2 代码实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7321" class="md-nav__link">
    7.3.2.1 队列统一过期
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7322" class="md-nav__link">
    7.3.2.2 消息过期
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    7.4 死信队列
  </a>
  
    <nav class="md-nav" aria-label="7.4 死信队列">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#741" class="md-nav__link">
    7.4.1 过期时间代码实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#742" class="md-nav__link">
    7.4.2 长度限制代码实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#743" class="md-nav__link">
    7.4.3 测试消息拒收
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    7.5 延迟队列
  </a>
  
    <nav class="md-nav" aria-label="7.5 延迟队列">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#751" class="md-nav__link">
    7.5.1 代码实现
  </a>
  
    <nav class="md-nav" aria-label="7.5.1 代码实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7511" class="md-nav__link">
    7.5.1.1 生产者
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7512" class="md-nav__link">
    7.5.1.2 消费者
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-rabbitmq" class="md-nav__link">
    8 RabbitMQ集成微服务
  </a>
  
    <nav class="md-nav" aria-label="8 RabbitMQ集成微服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-rabbitadmin" class="md-nav__link">
    8.1 RabbitAdmin应用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-rabbitadmin" class="md-nav__link">
    8.2 RabbitAdmin源码分析
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-rabbitmq" class="md-nav__link">
    8.3 RabbitMQ声明式配置使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-rabbitmqspringboot" class="md-nav__link">
    8.4 RabbitMQ与SpringBoot整合
  </a>
  
    <nav class="md-nav" aria-label="8.4 RabbitMQ与SpringBoot整合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#841" class="md-nav__link">
    8.4.1 搭建生产者工程
  </a>
  
    <nav class="md-nav" aria-label="8.4.1 搭建生产者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8411" class="md-nav__link">
    8.4.1.1 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8412" class="md-nav__link">
    8.4.1.2 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8413" class="md-nav__link">
    8.4.1.3 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8414" class="md-nav__link">
    8.4.1.4 创建配置类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8415" class="md-nav__link">
    8.4.1.5 创建入口类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8416" class="md-nav__link">
    8.4.1.6 发送消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#842" class="md-nav__link">
    8.4.2 搭建消费者工程
  </a>
  
    <nav class="md-nav" aria-label="8.4.2 搭建消费者工程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8421" class="md-nav__link">
    8.4.2.1 创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8422" class="md-nav__link">
    8.4.2.2 添加依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8423" class="md-nav__link">
    8.4.2.3 配置整合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8424" class="md-nav__link">
    8.4.2.4 消息监听器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    9 消息百分百成功投递
  </a>
  
    <nav class="md-nav" aria-label="9 消息百分百成功投递">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    9.1 数据库文件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    10 消息幂等性保障
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-mq" class="md-nav__link">
    11 MQ高级集群操作
  </a>
  
    <nav class="md-nav" aria-label="11 MQ高级集群操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linuxmq" class="md-nav__link">
    安装Linux版本MQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    日志
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    集群和负载均衡操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="rabbitmq">RabbitMQ<a class="headerlink" href="#rabbitmq" title="Permanent link">&para;</a></h1>
<h2 id="1-mq">1. 消息队列(中间件)MQ<a class="headerlink" href="#1-mq" title="Permanent link">&para;</a></h2>
<h3 id="_1">百度华为面试题<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>MQ适用于哪些业务场景？MQ有什么用？MQ的优点和缺点都有哪些？</p>
<p><strong>啥是MQ</strong></p>
</blockquote>
<p>A：你能给我解释了下MQ吗？</p>
<p>B：MQ就是消息队列。</p>
<p>A：嗯，不错，然后呢？</p>
<p>B：没了。</p>
<p>A：……</p>
<p>MQ，英文全拼为message queue，直译为消息队列。简单的理解，它就是一个容器。但是，当它作为一门技术时，就有了一些展开的问题。比如说，怎么存放？谁往进放？放进去又有什么用呢？Java里，MQ代表的是一门完整的技术。</p>
<p>那么，如何在深入技术之前，有逼格的介绍一下MQ呢？不妨从以下几个问题入手：</p>
<p>1． MQ经常应用于哪些业务场景？</p>
<p>2． MQ的缺点有哪些？</p>
<p>3． 常用的MQ组件有哪些？</p>
<h3 id="mq">MQ（消息队列）<a class="headerlink" href="#mq" title="Permanent link">&para;</a></h3>
<p>MQ全称为Message Queue, 消息队列(MQ)是一种应用程序对应用程序的通信方法。</p>
<p>介绍：消息队列就是基础数据结构中的“先进先出”的一种数据机构。想一下，生活中买东西，需要排队，先排的人先买消费，就是典型的“先进先出”。</p>
<p><img alt="1592728014273" src="../imgs/1592728014273.png" /></p>
<p>消息传递：指的是程序之间通过在消息中发送数据进行通信，而不是通过直接调用彼此来通信，直接调用通常是用于诸如远程过程调用的技术。</p>
<p>排队：指的是应用程序通过队列来通信。</p>
<h3 id="mq_1">为什么会产生消息MQ<a class="headerlink" href="#mq_1" title="Permanent link">&para;</a></h3>
<p>随着微服务架构的流行，MQ成了解决微服务之间问题的常用工具。</p>
<p>以电商应用为例，应用中有订单系统、库存系统、物流系统、支付系统。用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障，都会造成下单操作异常。</p>
<p>当转变成基于消息队列的方式后，系统间调用的问题会减少很多，比如物流系统因为发生故障，需要几分钟来修复。在这几分钟的时间里，物流系统要处理的内存被缓存在消息队列中，用户的下单操作可以正常完成。当物流系统恢复后，继续处理订单信息即可，中单用户感受不到物流系统的故障。提升系统的可用性。</p>
<p><img alt="1592728698723" src="../imgs/1592728698723.png" /></p>
<p>不同进程（process）之间传递消息时，两个进程之间耦合程度过高，改动一个进程，引发必须修改另一个进程，为了隔离这两个进程，在两进程间抽离出一层（一个模块），所有两进程之间传递的消息，都必须通过消息队列来传递，单独修改某一个进程，不会影响另一个；</p>
<p>不同进程（process）之间传递消息时，为了实现标准化，将消息的格式规范化了，并且，某一个进程接受的消息太多，一下子无法处理完，并且也有先后顺序，必须对收到的消息进行排队，因此诞生了事实上的消息队列；</p>
<p>在项目中，可将一些无需即时返回且耗时的操作提取出来，进行<strong>异步处理</strong>，而这种异步处理的方式大大的节省了服务器的请求响应时间，从而提高了系统的<strong>吞吐量</strong>。</p>
<h3 id="_2">消息队列应用场景<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>首先我们先说一下消息中间件的主要的作用:</p>
<p>[1]异步处理</p>
<p>[2]解耦服务</p>
<p>[3]流量削峰</p>
<p>上面的三点是我们使用消息中间件最主要的目的.</p>
<h4 id="_3">应用解耦<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>以电商应用为例，应用中有订单系统、库存系统、物流系统、支付系统。用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障，都会造成下单操作异常。</p>
<p>当转变成基于消息队列的方式后，系统间调用的问题会减少很多，比如物流系统因为发生故障，需要几分钟来修复。在这几分钟的时间里，物流系统要处理的内存被缓存在消息队列中，用户的下单操作可以正常完成。当物流系统恢复后，继续处理订单信息即可，中单用户感受不到物流系统的故障。提升系统的可用性。</p>
<p>传统模式:</p>
<p><img alt="1591517450861" src="../imgs/1591517450861.png" /></p>
<p>传统模式的缺点：</p>
<ul>
<li>系统间耦合性太强，如上图所示，系统A在代码中直接调用系统B和系统C的代码，如果将来D系统接入，系统A还需要修改代码，过于麻烦！</li>
</ul>
<p>中间件模式:</p>
<p><img alt="1591517532443" src="../imgs/1591517532443.png" /></p>
<p>中间件模式的的优点：</p>
<ul>
<li>将消息写入消息队列，需要消息的系统自己从消息队列中订阅，从而系统A不需要做任何修改。</li>
</ul>
<h4 id="_4">异步处理<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>场景说明：用户注册后，需要发注册邮件和注册短信,传统的做法有两种</p>
<p>1.串行的方式;</p>
<p>2.并行的方式 </p>
<p>(1)串行方式:将注册信息写入数据库后,发送注册邮件,再发送注册短信,以上三个任务全部完成后才返回给客户端。 这有一个问题是,邮件,短信并不是必须的,它只是一个通知,而这种做法让客户端等待没有必要等待的东西.</p>
<p><img alt="1591525532521" src="../imgs/1591525532521.png" /></p>
<p>(2)并行方式:将注册信息写入数据库后,发送邮件的同时,发送短信,以上三个任务完成后,返回给客户端,并行的方式能提高处理的时间。</p>
<p><img alt="1591525684529" src="../imgs/1591525684529.png" /></p>
<p>假设三个业务节点分别使用50ms,串行方式使用时间150ms,并行使用时间100ms。虽然并性已经提高的处理时间,但是,前面说过,邮件和短信对我正常的使用网站没有任何影响，客户端没有必要等着其发送完成才显示注册成功,英爱是写入数据库后就返回.</p>
<p>(3)消息队列
引入消息队列后，把发送邮件,短信不是必须的业务逻辑异步处理</p>
<p><img alt="1591525731572" src="../imgs/1591525731572.png" /></p>
<p>由此可以看出,引入消息队列后，用户的响应时间就等于写入数据库的时间+写入消息队列的时间(可以忽略不计),</p>
<p>引入消息队列后处理后,响应时间是串行的3倍,是并行的2倍。</p>
<p>传统模式的缺点：</p>
<ul>
<li>一些非必要的业务逻辑以同步的方式运行，太耗费时间。</li>
</ul>
<p>中间件模式的的优点：</p>
<ul>
<li>将消息写入消息队列，非必要的业务逻辑以异步的方式运行，加快响应速度</li>
</ul>
<h4 id="_5">流量削峰<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>流量削峰一般在秒杀活动中应用广泛
场景: 秒杀活动，一般会因为流量过大，导致应用挂掉,为了解决这个问题，一般在应用前端加入消息队列。
作用:
1.可以控制活动人数，超过此一定阀值的订单直接丢弃(我为什么秒杀一次都没有成功过呢^^)
2.可以缓解短时间的高流量压垮应用(应用程序按自己的最大处理能力获取订单)</p>
<p>以电商中的秒杀场景为例，采用同步处理：</p>
<ul>
<li>用户点击秒杀</li>
<li>调用订单服务，验证库存、锁定库存</li>
<li>跳转到支付页面进行支付</li>
</ul>
<p><strong>分析一下，存在的问题：</strong></p>
<ul>
<li>验证库存、锁定库存会访问数据库</li>
<li>秒杀场景，商品数量有限，请求量非常大，每个请求来了都做以上处理，直接会把数据库压垮，导致数据库无法对外提供服务，数据库的不可用直接导致整个业务的不可用，秒杀活动打水漂。</li>
<li>大量请求会同时到达，同时去访问数据库，数据库连接有限，导致很多请求会处于等待状态，导致并发性能急剧下降</li>
<li>大量用户同时操作库存，存在争抢数据库锁的情况，容易导致死锁</li>
<li>秒杀中数量一般是有限，大量用户抢购，其实最终只有很少的用户能够抢购到</li>
</ul>
<p>大家都有在银行办理业务的经验，银行处理业务的流程：<strong>领号、排队、等待叫号办理业务</strong>。</p>
<p><strong>秒杀中我们也可以参考银行办理业务的流程：</strong></p>
<ul>
<li>用户点击描述</li>
<li>系统接受到用户请求后，生成一个唯一的编号，然后投递一条消息（秒杀下单）到mq</li>
<li>响应用户：秒杀正在处理中</li>
<li>秒杀系统从mq中拉取消息进行处理，处理完成之后告知用户，这步操作对于用户来说是异步处理的过程</li>
</ul>
<p>从上面可以看出，从接受用户请求到响应用户请求，未访问数据库，只有生成编号和发送消息的操作，这部分处理速度是非常快的，不存在性能的问题，数据库也不存在压力的问题了，所有用户的请求都被作为一条消息投递到mq进行异步处理；从而解决了秒杀中同步处理遇到的各种问题。</p>
<p>传统模式</p>
<p>如订单系统，在下单的时候就会往数据库写数据。但是数据库只能支撑每秒1000左右的并发写入，并发量再高就容易宕机。低峰期的时候并发也就100多个，但是在高峰期时候，并发量会突然激增到5000以上，这个时候数据库肯定卡死了。</p>
<p><img alt="1587032574375" src="../imgs/1587032574375.png" /></p>
<p>传统模式的缺点：</p>
<ul>
<li>并发量大的时候，所有的请求直接怼到数据库，造成数据库连接异常</li>
</ul>
<p>中间件模式:</p>
<p>消息被MQ保存起来了，然后系统就可以按照自己的消费能力来消费，比如每秒1000个数据，这样慢慢写入数据库，这样就不会卡死数据库了。</p>
<p><img alt="1587032602155" src="../imgs/1587032602155.png" /></p>
<p>中间件模式的的优点：</p>
<p>系统A慢慢的按照数据库能处理的并发量，从消息队列中慢慢拉取消息。在生产中，这个短暂的高峰期积压是允许的。</p>
<blockquote>
<p>流量削峰也叫做削峰填谷</p>
</blockquote>
<p>使用了MQ之后，限制消费消息的速度为1000，但是这样一来，高峰期产生的数据势必会被积压在MQ中，高峰就被“削”掉了。但是因为消息积压，在高峰期过后的一段时间内，消费消息的速度还是会维持在1000QPS，直到消费完积压的消息,这就叫做“填谷”</p>
<p><img alt="1597793951342" src="../imgs/1597793951342.png" /></p>
<h4 id="111-qpspv">1.1.1 什么是QPS,PV<a class="headerlink" href="#111-qpspv" title="Permanent link">&para;</a></h4>
<blockquote>
<p>QPS</p>
</blockquote>
<p>QPS即每秒查询率，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。</p>
<blockquote>
<p>每秒查询率</p>
</blockquote>
<p>因特网上，经常用每秒查询率来衡量域名系统服务器的机器的性能，即为QPS。</p>
<p>或者理解：每秒的响应请求数，也即是最大吞吐能力。</p>
<blockquote>
<p>计算关系：</p>
</blockquote>
<p>QPS = 并发量 / 平均响应时间</p>
<p>并发量 = QPS * 平均响应时间</p>
<p>原理：每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间。</p>
<p>公式：( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS) 。</p>
<p>机器：峰值时间每秒QPS / 单台机器的QPS = 需要的机器 。</p>
<h4 id="112-pv-uv-pr">1.1.2 什么是PV , UV , PR<a class="headerlink" href="#112-pv-uv-pr" title="Permanent link">&para;</a></h4>
<p>① 什么是pv　　</p>
<p>PV(page view)，即页面浏览量，或点击量；通常是衡量一个网络新闻频道或网站甚至一条网络新闻的主要指标。</p>
<p>对pv的解释是，一个访问者在24小时(0点到24点)内到底看了你网站几个页面。这里需要强调：同一个人浏览你网站同一个页面，不重复计算pv量，点100次也算1次。说白了，pv就是一个访问者打开了你的几个页面。</p>
<p>PV之于网站，就像收视率之于电视，从某种程度上已成为投资者衡量商业网站表现的最重要尺度。</p>
<p>pv的计算：当一个访问着访问的时候，记录他所访问的页面和对应的IP，然后确定这个IP今天访问了这个页面没有。如果你的网站到了23点，单纯IP有60万条的话，每个访问者平均访问了3个页面，那么pv表的记录就要有180万条。</p>
<p>② 什么是uv
uv(unique visitor)，指访问某个站点或点击某条新闻的不同IP地址的人数。</p>
<p>在同一天内，uv只记录第一次进入网站的具有独立IP的访问者，在同一天内再次访问该网站则不计数。独立IP访问者提供了一定时间内不同观众数量的统计指标，而没有反应出网站的全面活动。</p>
<p>③ 什么是ＰＲ值
　　PR值，即PageRank，网页的级别技术，用来标识网页的等级/重要性。级别从1到10级，10级为满分。PR值越高说明该网页越受欢迎（越重要）。</p>
<p>例如：一个PR值为1的网站表明这个网站不太具有流行度，而PR值为7到10则表明这个网站非常受欢迎（或者说极其重要）。</p>
<h3 id="mq_2"><strong>MQ有哪些缺点？</strong><a class="headerlink" href="#mq_2" title="Permanent link">&para;</a></h3>
<p>了解了MQ的主要应用场景，那么，其缺点也是显而易见的。</p>
<p>1． 系统复杂性增加。毕竟是增加了一个中间件MQ，那么系统变得更复杂，就是不可避免的。但是，与其说是系统复杂性增加，不如说是给相关开发人员带来的新的学习成本。但是，一项技术本身就是这样，学时很痛苦，学会了，它就会变成一把利剑，帮助您开疆辟土。</p>
<p>2． 系统可用性降低。假设一个系统由若干个节点链式组成，每个节点出问题的概率是相同的，那么，20个节点的系统出问题的概率显然要高于10个节点的系统。所以，从这个角度来看，毕竟是增加了一个MQ中间件，出问题的概率显然会增大，系统可用性就会降低。</p>
<h3 id="12-amqp-jms">1.2. AMQP 和 JMS<a class="headerlink" href="#12-amqp-jms" title="Permanent link">&para;</a></h3>
<p>MQ是消息通信的模型；实现MQ的大致有两种主流方式：AMQP、JMS。</p>
<h4 id="121-amqp">1.2.1. AMQP<a class="headerlink" href="#121-amqp" title="Permanent link">&para;</a></h4>
<p>AMQP是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和JMS的本质差别，AMQP不从API层进行限定，而是直接定义网络交换的数据格式。</p>
<h4 id="122-jms">1.2.2. JMS<a class="headerlink" href="#122-jms" title="Permanent link">&para;</a></h4>
<p>JMS即Java消息服务（JavaMessage Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</p>
<h4 id="123-amqp-jms">1.2.3. AMQP 与 JMS 区别<a class="headerlink" href="#123-amqp-jms" title="Permanent link">&para;</a></h4>
<ul>
<li>JMS是定义了统一的接口，来对消息操作进行统一；AMQP是通过规定协议来统一数据交互的格式</li>
<li>JMS限定了必须使用Java语言；AMQP只是协议，不规定实现方式，因此是跨语言的。</li>
<li>JMS规定了两种消息模式；而AMQP的消息模式更加丰富</li>
</ul>
<h3 id="13">1.3. 消息队列产品<a class="headerlink" href="#13" title="Permanent link">&para;</a></h3>
<p>市场上常见的消息队列有如下：</p>
<ul>
<li>ActiveMQ：基于JMS</li>
<li>ZeroMQ：基于C语言开发</li>
<li>RabbitMQ：基于AMQP协议，erlang语言开发，稳定性好</li>
<li>RocketMQ：基于JMS，阿里巴巴产品</li>
<li>Kafka：类似MQ的产品；分布式消息系统，高吞吐量</li>
</ul>
<p><img alt="1587034675618" src="../imgs/1587034675618.png" /></p>
<h3 id="14-rabbitmq">1.4. RabbitMQ<a class="headerlink" href="#14-rabbitmq" title="Permanent link">&para;</a></h3>
<p>RabbitMQ是由erlang语言开发，基于AMQP（Advanced Message Queue 高级消息队列协议）协议实现的消息队列，它是一种应用程序之间的通信方法，消息队列在分布式系统开发中应用非常广泛。</p>
<p>RabbitMQ官方地址：<a href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a></p>
<p>RabbitMQ提供了6种模式：简单模式，work模式，Publish/Subscribe发布与订阅模式，Routing路由模式，Topics主题模式，RPC远程调用模式（远程调用，不太算MQ；暂不作介绍）；</p>
<p>官网对应模式介绍：<a href="https://www.rabbitmq.com/getstarted.html">https://www.rabbitmq.com/getstarted.html</a></p>
<p><img alt="1555988678324" src="../imgs/1555988678324.png" /></p>
<h4 id="141-rabbitmq">1.4.1 RabbitMQ简介<a class="headerlink" href="#141-rabbitmq" title="Permanent link">&para;</a></h4>
<p>AMQP，即 Advanced
Message Queuing Protocol（高级消息队列协议），是一个网络协议，是应用层协议的一个开放标准，为面向消息的中间件设计。基于此协议的客户端与消息中间件可传递消息，并不受客户端/中间件不同产品，不同的开发语言等条件的限制。2006年，AMQP 规范发布。类比HTTP。</p>
<p><img alt="1587035270468" src="../imgs/1587035270468.png" /></p>
<p>2007年，Rabbit 技术公司基于 AMQP 标准开发的 RabbitMQ 1.0 发布。RabbitMQ 采用 Erlang 语言开发。Erlang 语言由 Ericson 设计，专门为开发高并发和分布式系统的一种语言，在电信领域使用广泛。</p>
<p>RabbitMQ 基础架构如下图：</p>
<p><img alt="1587035316236" src="../imgs/1587035316236.png" /></p>
<h4 id="142-rabbitmq">1.4.2 RabbitMQ 中的相关概念：<a class="headerlink" href="#142-rabbitmq" title="Permanent link">&para;</a></h4>
<p>Broker：接收和分发消息的应用，RabbitMQ Server就是 Message Broker</p>
<p>Virtual host：出于多租户和安全因素设计的，把 AMQP 的基本组件划分到一个虚拟的分组中，类似于网络中的 namespace 概念。当多个不同的用户使用同一个 RabbitMQ server 提供的服务时，可以划分出多个vhost，每个用户在自己的 vhost 创建 exchange／queue 等</p>
<p>Connection：publisher／consumer 和 broker 之间的 TCP 连接</p>
<p>Channel：如果每一次访问 RabbitMQ 都建立一个 Connection，在消息量大的时候建立 TCP Connection的开销将是巨大的，效率也较低。Channel 是在 connection 内部建立的逻辑连接，如果应用程序支持多线程，通常每个thread创建单独的 channel 进行通讯，AMQP method 包含了channel id 帮助客户端和message broker 识别 channel，所以 channel 之间是完全隔离的。Channel 作为轻量级的 Connection 极大减少了操作系统建立 TCP connection 的开销</p>
<p>Exchange：message 到达 broker 的第一站，根据分发规则，匹配查询表中的 routing key，分发消息到queue 中去。常用的类型有：direct (point-to-point), topic (publish-subscribe) and fanout (multicast)</p>
<p>Queue：消息最终被送到这里等待 consumer 取走</p>
<p>Binding：exchange 和 queue 之间的虚拟连接，binding 中可以包含 routing key。Binding 信息被保存到 exchange 中的查询表中，用于 message 的分发依据</p>
<h2 id="2-rabbitmq">2. 安装及配置RabbitMQ<a class="headerlink" href="#2-rabbitmq" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1. 下载和安装<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<h4 id="211">2.1.1. 下载<a class="headerlink" href="#211" title="Permanent link">&para;</a></h4>
<p><strong>1.下载Erlang的rpm包</strong></p>
<p>RabbitMQ是Erlang语言编写，所以Erang环境必须要有，注：Erlang环境一定要与RabbitMQ版本匹配：</p>
<p><a href="https://www.rabbitmq.com/which-erlang.html">https://www.rabbitmq.com/which-erlang.html</a> </p>
<p><img alt="1646206410002" src="../imgs/1646206410002.png" /></p>
<p>Erlang下载地址：<a href="https://www.rabbitmq.com/releases/erlang/">https://www.rabbitmq.com/releases/erlang/</a>（根据自身需求及匹配关系，下载对应rpm包）</p>
<p><a href="https://dl.bintray.com/rabbitmq-erlang/rpm/erlang/21/el/7/x86_64/erlang-21.3.8.9-1.el7.x86_64.rpm">https://dl.bintray.com/rabbitmq-erlang/rpm/erlang/21/el/7/x86_64/erlang-21.3.8.9-1.el7.x86_64.rpm</a></p>
<p><strong>2.下载socat的rpm包</strong></p>
<p>rabbitmq安装依赖于socat，所以需要下载socat。</p>
<p>socat下载地址：<a href="http://repo.iotti.biz/CentOS/7/x86_64/socat-1.7.3.2-5.el7.lux.x86_64.rpm">http://repo.iotti.biz/CentOS/7/x86_64/socat-1.7.3.2-5.el7.lux.x86_64.rpm</a></p>
<p><strong>3.下载RabbitMQ的rpm包</strong></p>
<p>RabbitMQ下载地址：<a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a>（根据自身需求及匹配关系，下载对应rpm包）rabbitmq-server-3.8.1-1.el7.noarch.rpm</p>
<p><img alt="1646206440640" src="../imgs/1646206440640.png" /></p>
<h4 id="212">2.1.2. 安装<a class="headerlink" href="#212" title="Permanent link">&para;</a></h4>
<p><strong>1.安装Erlang、Socat、RabbitMQ</strong></p>
<p><strong>①rpm -ivh</strong> <strong>erlang-21.3.8.9-1.el7.x86_64.rpm</strong> </p>
<p><strong>②rpm -ivh</strong> <strong>socat-1.7.3.2-1.el6.lux.x86_64.rpm</strong></p>
<p>在安装rabbitmq之前需要先安装socat，否则，报错。</p>
<p>可以采用yum安装方式：yum install socat，我们这里采用rpm安装方式</p>
<p><strong>③rpm -ivh</strong> <strong>rabbitmq-server-3.8.1-1.el7.noarch.rpm</strong> </p>
<p>/usr/lib/rabbitmq/bin/ </p>
<p><strong>2.启用管理插件</strong></p>
<p>rabbitmq-plugins enable rabbitmq_management</p>
<p><strong>3.启动RabbitMQ</strong></p>
<p>systemctl start rabbitmq-server.service</p>
<p>systemctl status rabbitmq-server.service</p>
<p>systemctl restart rabbitmq-server.service</p>
<p>systemctl stop rabbitmq-server.service </p>
<p><strong>4.查看进程</strong></p>
<p>ps -ef | grep rabbitmq</p>
<h4 id="213">2.1.3. 测试<a class="headerlink" href="#213" title="Permanent link">&para;</a></h4>
<p>o    关闭防火墙：systemctl stop firewalld.service</p>
<p>o   在web浏览器中输入地址：<a href="http://虚拟机ip:15672/">http://虚拟机ip:15672/</a></p>
<p>o   输入默认账号密码： guest ： guest，guest用户默认不允许远程连接。</p>
<p><img alt="1646206480542" src="../imgs/1646206480542.png" /></p>
<p><strong>增加自定义账号</strong></p>
<p>l  添加管理员账号密码：rabbitmqctl add_user admin admin</p>
<p>l  分配账号角色：rabbitmqctl set_user_tags admin administrator</p>
<p>l  修改密码：rabbitmqctl change_password admin 123456</p>
<p>l  查看用户列表：rabbitmqctl list_users</p>
<p>使用新账号登录，成功界面</p>
<p><img alt="1646206501942" src="../imgs/1646206501942.png" /></p>
<p><strong>管理界面标签页介绍</strong></p>
<p>l  overview：概览</p>
<p>l  connections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才可以完成消息的生产和消费，在这里可以查看连接情况</p>
<p>l  channels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。</p>
<p>l  Exchanges：交换机，用来实现消息的路由</p>
<p>l  Queues：队列，即消息队列，消息存放在队列中，等待消费，消费后被移除队列。</p>
<p><strong>端口：</strong></p>
<p>l  5672：rabbitMq的编程语言客户端连接端口</p>
<p>l  15672：rabbitMq管理界面端口</p>
<p>l  25672：rabbitMq集群的端口</p>
<h4 id="214">2.1.4. 卸载<a class="headerlink" href="#214" title="Permanent link">&para;</a></h4>
<p>l  rpm -qa | grep rabbitmq</p>
<p>l  rpm -e rabbitmq-server</p>
<h3 id="22">2.2. 管理界面<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<h4 id="221">2.2.1. 添加用户<a class="headerlink" href="#221" title="Permanent link">&para;</a></h4>
<p>如果不使用guest，我们也可以自己创建一个用户：</p>
<p><img alt="1646206518753" src="../imgs/1646206518753.png" /></p>
<p>1、 超级管理员(administrator)</p>
<p>可登录管理控制台，可查看所有的信息，并且可以对用户，策略(policy)进行操作。</p>
<p>2、 监控者(monitoring)</p>
<p>可登录管理控制台，同时可以查看rabbitmq节点的相关信息(进程数，内存使用情况，磁盘使用情况等)</p>
<p>3、 策略制定者(policymaker)</p>
<p>可登录管理控制台， 同时可以对policy进行管理。但无法查看节点的相关信息。</p>
<p>4、 普通管理者(management)</p>
<p>仅可登录管理控制台，无法看到节点信息，也无法对策略进行管理。</p>
<p>5、 其他</p>
<p>无法登录管理控制台，通常就是普通的生产者和消费者。</p>
<h4 id="222-virtual-hosts">2.2.2. 创建Virtual Hosts<a class="headerlink" href="#222-virtual-hosts" title="Permanent link">&para;</a></h4>
<p>虚拟主机：类似于mysql中的database。他们都是以“/”开头</p>
<p><img alt="1646206533181" src="../imgs/1646206533181.png" /></p>
<h4 id="223">2.2.3. 设置权限<a class="headerlink" href="#223" title="Permanent link">&para;</a></h4>
<p><img alt="1646206549068" src="../imgs/1646206549068.png" /></p>
<p><img alt="1646206561012" src="../imgs/1646206561012.png" /></p>
<p><img alt="1646206569821" src="../imgs/1646206569821.png" /> </p>
<h2 id="3-rabbitmq">3. RabbitMQ入门<a class="headerlink" href="#3-rabbitmq" title="Permanent link">&para;</a></h2>
<p>官网： <code>https://www.rabbitmq.com/</code></p>
<p>需求：使用简单模式完成消息传递</p>
<p>步骤：</p>
<p>① 创建工程（生成者、消费者）</p>
<p>② 分别添加依赖</p>
<p>③ 编写生产者发送消息</p>
<p>④ 编写消费者接收消息</p>
<h3 id="31">3.1. 搭建示例工程<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<h4 id="311">3.1.1. 创建工程<a class="headerlink" href="#311" title="Permanent link">&para;</a></h4>
<p>创建项目：<code>rabbitmq-producer</code></p>
<p><img alt="1587001114105" src="../imgs/1587001114105.png" /></p>
<p>创建项目：<code>rabbitmq-consumer</code> </p>
<p><img alt="1587001212451" src="../imgs/1587001212451.png" /></p>
<h4 id="312">3.1.2. 添加依赖<a class="headerlink" href="#312" title="Permanent link">&para;</a></h4>
<p>往两个rabbitmq的pom.xml文件中添加如下依赖：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.rabbitmq<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>amqp-client<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.6.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>


    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</code></pre></div>
<h3 id="32">3.2. 编写生产者<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>编写消息生产者 <code>com.atguigu.rabbitmq.simple.Producer</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.simple</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Producer</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="c1">//创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//主机地址;默认为 localhost</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span>
        <span class="c1">//连接端口;默认为 5672</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span>
        <span class="c1">//虚拟主机名称;默认为 /</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
        <span class="c1">//连接用户名；默认为guest</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>
        <span class="c1">//连接密码；默认为guest</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>

        <span class="c1">//创建连接</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>

        <span class="c1">// 创建频道</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>

        <span class="c1">// 声明（创建）队列</span>
        <span class="cm">/**</span>
<span class="cm">         * queue      参数1：队列名称</span>
<span class="cm">         * durable    参数2：是否定义持久化队列,当mq重启之后，还在</span>
<span class="cm">         * exclusive  参数3：是否独占本次连接</span>
<span class="cm">         *            ① 是否独占，只能有一个消费者监听这个队列</span>
<span class="cm">         *            ② 当connection关闭时，是否删除队列</span>
<span class="cm">         * autoDelete 参数4：是否在不使用的时候自动删除队列，当没有consumer时，自动删除</span>
<span class="cm">         * arguments  参数5：队列其它参数</span>
<span class="cm">         */</span>

        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="s">&quot;simple_queue&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

        <span class="c1">// 要发送的信息</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;你好；小兔子！&quot;</span><span class="p">;</span>
        <span class="cm">/**</span>
<span class="cm">         * 参数1：交换机名称，如果没有指定则使用默认Default Exchage</span>
<span class="cm">         * 参数2：路由key,简单模式可以传递队列名称</span>
<span class="cm">         * 参数3：配置信息</span>
<span class="cm">         * 参数4：消息内容</span>
<span class="cm">         */</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicPublish</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;simple_queue&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">message</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;已发送消息：&quot;</span> <span class="o">+</span> <span class="n">message</span><span class="p">);</span>

        <span class="c1">// 关闭资源</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
        <span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>运行程序：<code>http://127.0.0.1:15672</code></p>
<p>在执行上述的消息发送之后；可以登录rabbitMQ的管理控制台，可以发现队列和其消息：</p>
<p><img alt="1587003712158" src="../imgs/1587003712158.png" /></p>
<p><img alt="1587004259989" src="../imgs/1587004259989.png" /></p>
<h3 id="33">3.3. 编写消费者<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>编写消息的消费者 <code>com.atguigu.rabbitmq.simple.Consumer</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.simple</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="c1">//5. 创建队列Queue</span>
        <span class="cm">/*</span>
<span class="cm">        queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&lt;String, Object&gt; arguments)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. durable:是否持久化，当mq重启之后，还在</span>
<span class="cm">            3. exclusive：</span>
<span class="cm">                * 是否独占。只能有一个消费者监听这队列</span>
<span class="cm">                * 当Connection关闭时，是否删除队列</span>
<span class="cm">                *</span>
<span class="cm">            4. autoDelete:是否自动删除。当没有Consumer时，自动删除掉</span>
<span class="cm">            5. arguments：参数。</span>

<span class="cm">         */</span>
        <span class="c1">//如果没有一个名字叫hello_world的队列，则会创建该队列，如果有则不会创建</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="s">&quot;simple_queue&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>


        <span class="c1">// 接收消息</span>
        <span class="n">DefaultConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">               回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">               1. consumerTag：标识</span>
<span class="cm">               2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">               3. properties:配置信息</span>
<span class="cm">               4. body：数据</span>

<span class="cm">            */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;consumerTag：&quot;</span><span class="o">+</span><span class="n">consumerTag</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Exchange：&quot;</span><span class="o">+</span><span class="n">envelope</span><span class="p">.</span><span class="na">getExchange</span><span class="p">());</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;RoutingKey：&quot;</span><span class="o">+</span><span class="n">envelope</span><span class="p">.</span><span class="na">getRoutingKey</span><span class="p">());</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;properties：&quot;</span><span class="o">+</span><span class="n">properties</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">};</span>
          <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认 ,类似咱们发短信，发送成功会收到一个确认消息</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 消费者类似一个监听程序，主要是用来监听消息</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="s">&quot;simple_queue&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>运行程序</p>
<p><img alt="1587007466574" src="../imgs/1587007466574.png" /></p>
<h3 id="34">3.4. 小结<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>上述的入门案例中中其实使用的是如下的简单模式：</p>
<p><img alt="1555991074575" src="../imgs/1555991074575.png" /></p>
<p>在上图的模型中，有以下概念：</p>
<ul>
<li>P：生产者，也就是要发送消息的程序</li>
<li>C：消费者：消息的接受者，会一直等待消息到来。</li>
<li>queue：消息队列，图中红色部分。类似一个邮箱，可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。</li>
</ul>
<h2 id="4-amqp">4. AMQP<a class="headerlink" href="#4-amqp" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1. 相关概念介绍<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p>AMQP  一个提供统一消息服务的应用层标准高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计。</p>
<p>AMQP是一个二进制协议，拥有一些现代化特点：多信道、协商式，异步，安全，扩平台，中立，高效。</p>
<p>RabbitMQ是AMQP协议的Erlang的实现。</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>连接Connection</td>
<td>一个网络连接，比如TCP/IP套接字连接。</td>
</tr>
<tr>
<td>会话Session</td>
<td>端点之间的命名对话。在一个会话上下文中，保证“恰好传递一次”。</td>
</tr>
<tr>
<td>信道Channel</td>
<td>多路复用连接中的一条独立的双向数据流通道。为会话提供物理传输介质。</td>
</tr>
<tr>
<td>客户端Client</td>
<td>AMQP连接或者会话的发起者。AMQP是非对称的，客户端生产和消费消息，服务器存储和路由这些消息。</td>
</tr>
<tr>
<td>服务节点Broker</td>
<td>消息中间件的服务节点；一般情况下可以将一个RabbitMQ Broker看作一台RabbitMQ 服务器。</td>
</tr>
<tr>
<td>端点</td>
<td>AMQP对话的任意一方。一个AMQP连接包括两个端点（一个是客户端，一个是服务器）。</td>
</tr>
<tr>
<td>消费者Consumer</td>
<td>一个从消息队列里请求消息的客户端程序。</td>
</tr>
<tr>
<td>生产者Producer</td>
<td>一个向交换机发布消息的客户端应用程序。</td>
</tr>
</tbody>
</table>
<h3 id="42-rabbitmq">4.2. RabbitMQ运转流程<a class="headerlink" href="#42-rabbitmq" title="Permanent link">&para;</a></h3>
<p>在入门案例中：</p>
<ul>
<li>生产者发送消息</li>
<li>生产者创建连接（Connection），开启一个信道（Channel），连接到RabbitMQ Broker；</li>
<li>声明队列并设置属性；如是否排它，是否持久化，是否自动删除；</li>
<li>将路由键（空字符串）与队列绑定起来；</li>
<li>发送消息至RabbitMQ Broker；</li>
<li>关闭信道；</li>
<li>关闭连接；</li>
<li>消费者接收消息</li>
<li>消费者创建连接（Connection），开启一个信道（Channel），连接到RabbitMQ Broker</li>
<li>向Broker 请求消费相应队列中的消息，设置相应的回调函数；</li>
<li>等待Broker回应闭关投递响应队列中的消息，消费者接收消息；</li>
<li>确认（ack，自动确认）接收到的消息；</li>
<li>RabbitMQ从队列中删除相应已经被确认的消息；</li>
<li>关闭信道；</li>
<li>关闭连接；</li>
</ul>
<p><img alt="1565105223969" src="../imgs/1565105223969.png" /></p>
<h2 id="5-rabbitmq">5. RabbitMQ工作模式<a class="headerlink" href="#5-rabbitmq" title="Permanent link">&para;</a></h2>
<h3 id="51-work-queues">5.1. Work queues工作队列模式<a class="headerlink" href="#51-work-queues" title="Permanent link">&para;</a></h3>
<h4 id="511">5.1.1. 模式说明<a class="headerlink" href="#511" title="Permanent link">&para;</a></h4>
<p><img alt="1556009144848" src="../imgs/1556009144848.png" /></p>
<p><code>Work Queues</code>与入门程序的<code>简单模式</code>相比，多了一个或一些消费端，多个消费端共同消费同一个队列中的消息。</p>
<p><strong>应用场景</strong>：对于 任务过重或任务较多情况使用工作队列可以提高任务处理的速度。</p>
<h4 id="512">5.1.2. 代码<a class="headerlink" href="#512" title="Permanent link">&para;</a></h4>
<p><code>Work Queues</code>与入门程序的<code>简单模式</code>的代码是几乎一样的；可以完全复制，并复制多一个消费者进行多个消费者同时消费消息的测试。</p>
<h5 id="1">1）生产者<a class="headerlink" href="#1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.work</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Producer</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s">&quot;work_queue&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="c1">//创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//主机地址;默认为 localhost</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span>
        <span class="c1">//连接端口;默认为 5672</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span>
        <span class="c1">//虚拟主机名称;默认为 /</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
        <span class="c1">//连接用户名；默认为guest</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>
        <span class="c1">//连接密码；默认为guest</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>

        <span class="c1">//创建连接</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>

        <span class="c1">// 创建频道</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>

        <span class="c1">//5. 创建队列Queue</span>
        <span class="cm">/*</span>
<span class="cm">        queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&lt;String, Object&gt; arguments)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. durable:是否持久化，当mq重启之后，还在</span>
<span class="cm">            3. exclusive：</span>
<span class="cm">                * 是否独占。只能有一个消费者监听这队列</span>
<span class="cm">                * 当Connection关闭时，是否删除队列</span>
<span class="cm">                *</span>
<span class="cm">            4. autoDelete:是否自动删除。当没有Consumer时，自动删除掉</span>
<span class="cm">            5. arguments：参数。</span>

<span class="cm">         */</span>
        <span class="c1">//如果没有一个名字叫hello_world的队列，则会创建该队列，如果有则不会创建</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="s">&quot;work_queues&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="cm">/*</span>
<span class="cm">        basicPublish(String exchange, String routingKey, BasicProperties props, byte[] body)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. exchange：交换机名称。简单模式下交换机会使用默认的 &quot;&quot;</span>
<span class="cm">            2. routingKey：路由名称</span>
<span class="cm">            3. props：配置信息</span>
<span class="cm">            4. body：发送消息数据</span>

<span class="cm">         */</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="s">&quot;hello rabbitmq~~~&quot;</span><span class="p">;</span>

            <span class="c1">//6. 发送消息</span>
            <span class="n">channel</span><span class="p">.</span><span class="na">basicPublish</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;work_queues&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="n">body</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
        <span class="p">}</span>



        <span class="c1">//7.释放资源</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
        <span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><img alt="1587031670462" src="../imgs/1587031670462.png" /></p>
<h5 id="21_1">2）消费者1<a class="headerlink" href="#21_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.work</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer1</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s">&quot;work_queue&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="c1">//5. 创建队列Queue</span>
        <span class="cm">/*</span>
<span class="cm">        queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&lt;String, Object&gt; arguments)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. durable:是否持久化，当mq重启之后，还在</span>
<span class="cm">            3. exclusive：</span>
<span class="cm">                * 是否独占。只能有一个消费者监听这队列</span>
<span class="cm">                * 当Connection关闭时，是否删除队列</span>
<span class="cm">                *</span>
<span class="cm">            4. autoDelete:是否自动删除。当没有Consumer时，自动删除掉</span>
<span class="cm">            5. arguments：参数。</span>

<span class="cm">         */</span>
        <span class="c1">//如果没有一个名字叫hello_world的队列，则会创建该队列，如果有则不会创建</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="s">&quot;work_queues&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">                回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">                1. consumerTag：标识</span>
<span class="cm">                2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">                3. properties:配置信息</span>
<span class="cm">                4. body：数据</span>

<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
              <span class="cm">/*  System.out.println(&quot;consumerTag：&quot;+consumerTag);</span>
<span class="cm">                System.out.println(&quot;Exchange：&quot;+envelope.getExchange());</span>
<span class="cm">                System.out.println(&quot;RoutingKey：&quot;+envelope.getRoutingKey());</span>
<span class="cm">                System.out.println(&quot;properties：&quot;+properties);*/</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="s">&quot;work_queues&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="32_1">3）消费者2<a class="headerlink" href="#32_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.work</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer2</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s">&quot;work_queue&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="c1">//5. 创建队列Queue</span>
        <span class="cm">/*</span>
<span class="cm">        queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&lt;String, Object&gt; arguments)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. durable:是否持久化，当mq重启之后，还在</span>
<span class="cm">            3. exclusive：</span>
<span class="cm">                * 是否独占。只能有一个消费者监听这队列</span>
<span class="cm">                * 当Connection关闭时，是否删除队列</span>
<span class="cm">                *</span>
<span class="cm">            4. autoDelete:是否自动删除。当没有Consumer时，自动删除掉</span>
<span class="cm">            5. arguments：参数。</span>

<span class="cm">         */</span>
        <span class="c1">//如果没有一个名字叫hello_world的队列，则会创建该队列，如果有则不会创建</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="s">&quot;work_queues&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">                回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">                1. consumerTag：标识</span>
<span class="cm">                2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">                3. properties:配置信息</span>
<span class="cm">                4. body：数据</span>

<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
              <span class="cm">/*  System.out.println(&quot;consumerTag：&quot;+consumerTag);</span>
<span class="cm">                System.out.println(&quot;Exchange：&quot;+envelope.getExchange());</span>
<span class="cm">                System.out.println(&quot;RoutingKey：&quot;+envelope.getRoutingKey());</span>
<span class="cm">                System.out.println(&quot;properties：&quot;+properties);*/</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="s">&quot;work_queues&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>运行两个消费者</p>
<p><img alt="1587008719288" src="../imgs/1587008719288.png" /></p>
<h4 id="513">5.1.3. 测试<a class="headerlink" href="#513" title="Permanent link">&para;</a></h4>
<p>启动两个消费者，然后再启动生产者发送消息；到IDEA的两个消费者对应的控制台查看是否竞争性的接收到消息。</p>
<p><img alt="1587008577505" src="../imgs/1587008577505.png" /></p>
<h4 id="514">5.1.4. 小结<a class="headerlink" href="#514" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>在一个队列中如果有多个消费者，那么消费者之间对于同一个消息的关系是<strong>竞争</strong>的关系。</p>
</li>
<li>
<p>Work Queues 对于任务过重或任务较多情况使用工作队列可以提高任务处理的速度。例如：短信服务部署多个，只需要有一个节点成功发送即可。</p>
</li>
</ol>
<h3 id="52">5.2. 订阅模式类型<a class="headerlink" href="#52" title="Permanent link">&para;</a></h3>
<p>订阅模式示例图：</p>
<p><img alt="1556014499573" src="../imgs/1556014499573.png" /></p>
<p>前面2个案例中，只有3个角色：</p>
<ul>
<li>P：生产者，也就是要发送消息的程序</li>
<li>C：消费者：消息的接受者，会一直等待消息到来。</li>
<li>queue：消息队列，图中红色部分</li>
</ul>
<p>而在订阅模型中，多了一个exchange角色，而且过程略有变化：</p>
<ul>
<li>P：生产者，也就是要发送消息的程序，但是不再发送到队列中，而是发给X（交换机）</li>
<li>C：消费者，消息的接受者，会一直等待消息到来。</li>
<li>Queue：消息队列，接收消息、缓存消息。</li>
<li>Exchange：交换机，图中的X。一方面，接收生产者发送的消息。另一方面，知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。Exchange有常见以下3种类型：</li>
<li>Fanout：广播，将消息交给所有绑定到交换机的队列</li>
<li>Direct：定向，把消息交给符合指定routing key 的队列</li>
<li>Topic：通配符，把消息交给符合routing pattern（路由模式） 的队列</li>
</ul>
<p><strong>Exchange（交换机）只负责转发消息，不具备存储消息的能力</strong>，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！</p>
<h3 id="53-publishsubscribe">5.3. Publish/Subscribe发布与订阅模式<a class="headerlink" href="#53-publishsubscribe" title="Permanent link">&para;</a></h3>
<h4 id="531">5.3.1. 模式说明<a class="headerlink" href="#531" title="Permanent link">&para;</a></h4>
<p><img alt="1556010329032" src="../imgs/1556010329032.png" /></p>
<p>发布订阅模式：
1、每个消费者监听自己的队列。
2、生产者将消息发给broker，由交换机将消息转发到绑定此交换机的每个队列，每个绑定交换机的队列都将接收
到消息</p>
<h4 id="532">5.3.2. 代码<a class="headerlink" href="#532" title="Permanent link">&para;</a></h4>
<h5 id="1_1">1）生产者<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.ps</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.BuiltinExchangeType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Producer</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="p">{</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>

        <span class="c1">//4.  创建频道</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>

           <span class="cm">/*</span>

<span class="cm">       exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map&lt;String, Object&gt; arguments)</span>
<span class="cm">       参数：</span>
<span class="cm">        1. exchange:交换机名称</span>
<span class="cm">        2. type:交换机类型</span>
<span class="cm">            DIRECT(&quot;direct&quot;),：定向</span>
<span class="cm">            FANOUT(&quot;fanout&quot;),：扇形（广播），发送消息到每一个与之绑定队列。</span>
<span class="cm">            TOPIC(&quot;topic&quot;),通配符的方式</span>
<span class="cm">            HEADERS(&quot;headers&quot;);参数匹配</span>

<span class="cm">        3. durable:是否持久化</span>
<span class="cm">        4. autoDelete:自动删除</span>
<span class="cm">        5. internal：内部使用。 一般false</span>
<span class="cm">        6. arguments：参数</span>
<span class="cm">        */</span>

        <span class="n">String</span> <span class="n">exchangeName</span> <span class="o">=</span> <span class="s">&quot;test_fanout&quot;</span><span class="p">;</span>
        <span class="c1">//5. 创建交换机</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">exchangeDeclare</span><span class="p">(</span><span class="n">exchangeName</span><span class="p">,</span> <span class="n">BuiltinExchangeType</span><span class="p">.</span><span class="na">FANOUT</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="c1">//6. 创建队列</span>
        <span class="n">String</span> <span class="n">queue1Name</span> <span class="o">=</span> <span class="s">&quot;test_fanout_queue1&quot;</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_fanout_queue2&quot;</span><span class="p">;</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="c1">//7. 绑定队列和交换机</span>
        <span class="cm">/*</span>
<span class="cm">        queueBind(String queue, String exchange, String routingKey)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. exchange：交换机名称</span>
<span class="cm">            3. routingKey：路由键，绑定规则</span>
<span class="cm">                如果交换机的类型为fanout ，routingKey设置为&quot;&quot;</span>
<span class="cm">         */</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">);</span>

        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="s">&quot;日志信息：张三调用了findAll方法...日志级别：info...&quot;</span><span class="p">;</span>
        <span class="c1">//8. 发送消息</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicPublish</span><span class="p">(</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="n">body</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>

        <span class="c1">//9. 释放资源</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
        <span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>运行</p>
<p><img alt="1587031341925" src="../imgs/1587031341925.png" /></p>
<h5 id="21_2">2）消费者1<a class="headerlink" href="#21_2" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.ps</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer1</span> <span class="p">{</span>
    <span class="c1">//队列名称</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FANOUT_QUEUE_1</span> <span class="o">=</span> <span class="s">&quot;fanout_queue_1&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">queue1Name</span> <span class="o">=</span> <span class="s">&quot;test_fanout_queue1&quot;</span><span class="p">;</span>


        <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">                回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">                1. consumerTag：标识</span>
<span class="cm">                2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">                3. properties:配置信息</span>
<span class="cm">                4. body：数据</span>

<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
              <span class="cm">/*  System.out.println(&quot;consumerTag：&quot;+consumerTag);</span>
<span class="cm">                System.out.println(&quot;Exchange：&quot;+envelope.getExchange());</span>
<span class="cm">                System.out.println(&quot;RoutingKey：&quot;+envelope.getRoutingKey());</span>
<span class="cm">                System.out.println(&quot;properties：&quot;+properties);*/</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;将日志信息打印到控制台.....&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="32_2">3）消费者2<a class="headerlink" href="#32_2" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.ps</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer1</span> <span class="p">{</span>
    <span class="c1">//队列名称</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FANOUT_QUEUE_1</span> <span class="o">=</span> <span class="s">&quot;fanout_queue_1&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_fanout_queue2&quot;</span><span class="p">;</span>


        <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">                回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">                1. consumerTag：标识</span>
<span class="cm">                2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">                3. properties:配置信息</span>
<span class="cm">                4. body：数据</span>

<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
              <span class="cm">/*  System.out.println(&quot;consumerTag：&quot;+consumerTag);</span>
<span class="cm">                System.out.println(&quot;Exchange：&quot;+envelope.getExchange());</span>
<span class="cm">                System.out.println(&quot;RoutingKey：&quot;+envelope.getRoutingKey());</span>
<span class="cm">                System.out.println(&quot;properties：&quot;+properties);*/</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;将日志信息打印到控制台.....&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="533">5.3.3. 测试<a class="headerlink" href="#533" title="Permanent link">&para;</a></h4>
<p>启动所有消费者，然后使用生产者发送消息；在每个消费者对应的控制台可以查看到生产者发送的所有消息；到达<strong>广播</strong>的效果。</p>
<p>在执行完测试代码后，其实到RabbitMQ的管理后台找到<code>Exchanges</code>选项卡，点击 <code>fanout_exchange</code> 的交换机，可以查看到如下的绑定：</p>
<p><img alt="1556015006220" src="../imgs/1556015006220.png" /></p>
<h4 id="534">5.3.4. 小结<a class="headerlink" href="#534" title="Permanent link">&para;</a></h4>
<p>交换机需要与队列进行绑定，绑定之后；一个消息可以被多个消费者都收到。</p>
<p><strong>发布订阅模式与工作队列模式的区别</strong></p>
<p>1、工作队列模式不用定义交换机，而发布/订阅模式需要定义交换机。 </p>
<p>2、发布/订阅模式的生产方是面向交换机发送消息，工作队列模式的生产方是面向队列发送消息(底层使用默认交换机)。</p>
<p>3、发布/订阅模式需要设置队列和交换机的绑定，工作队列模式不需要设置，实际上工作队列模式会将队列绑 定到默认的交换机 。</p>
<h3 id="54-routing">5.4. Routing路由模式<a class="headerlink" href="#54-routing" title="Permanent link">&para;</a></h3>
<h4 id="541">5.4.1. 模式说明<a class="headerlink" href="#541" title="Permanent link">&para;</a></h4>
<p>路由模式特点：</p>
<ul>
<li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个<code>RoutingKey</code>（路由key）</li>
<li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>。</li>
<li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的<code>Routing Key</code>进行判断，只有队列的<code>Routingkey</code>与消息的 <code>Routing key</code>完全一致，才会接收到消息</li>
</ul>
<p><img alt="1556029284397" src="../imgs/1556029284397.png" /></p>
<p>图解：</p>
<ul>
<li>P：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。</li>
<li>X：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列</li>
<li>C1：消费者，其所在队列指定了需要routing key 为 error 的消息</li>
<li>C2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息</li>
</ul>
<h4 id="542">5.4.2. 代码<a class="headerlink" href="#542" title="Permanent link">&para;</a></h4>
<p>在编码上与 <code>Publish/Subscribe发布与订阅模式</code> 的区别是交换机的类型为：Direct，还有队列绑定交换机的时候需要指定routing key。</p>
<h5 id="1_2">1）生产者<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h5>
<p><div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.routing</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.BuiltinExchangeType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Producer</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:路由模式的交换机类型为：direct</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>


        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel频道</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
       <span class="cm">/*</span>

<span class="cm">       exchangeDeclare(String exchange, BuiltinExchangeType type, boolean durable, boolean autoDelete, boolean internal, Map&lt;String, Object&gt; arguments)</span>
<span class="cm">       参数：</span>
<span class="cm">        1. exchange:交换机名称</span>
<span class="cm">        2. type:交换机类型</span>
<span class="cm">            DIRECT(&quot;direct&quot;),：定向</span>
<span class="cm">            FANOUT(&quot;fanout&quot;),：扇形（广播），发送消息到每一个与之绑定队列。</span>
<span class="cm">            TOPIC(&quot;topic&quot;),通配符的方式</span>
<span class="cm">            HEADERS(&quot;headers&quot;);参数匹配</span>

<span class="cm">        3. durable:是否持久化</span>
<span class="cm">        4. autoDelete:自动删除</span>
<span class="cm">        5. internal：内部使用。 一般false</span>
<span class="cm">        6. arguments：参数</span>
<span class="cm">        */</span>
       <span class="n">String</span> <span class="n">exchangeName</span> <span class="o">=</span> <span class="s">&quot;test_direct&quot;</span><span class="p">;</span>
       <span class="c1">// 创建交换机</span>
       <span class="n">channel</span><span class="p">.</span><span class="na">exchangeDeclare</span><span class="p">(</span><span class="n">exchangeName</span><span class="p">,</span><span class="n">BuiltinExchangeType</span><span class="p">.</span><span class="na">DIRECT</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
       <span class="c1">// 创建队列</span>
       <span class="n">String</span> <span class="n">queue1Name</span> <span class="o">=</span> <span class="s">&quot;test_direct_queue1&quot;</span><span class="p">;</span>
       <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_direct_queue2&quot;</span><span class="p">;</span>
        <span class="c1">// 声明（创建）队列</span>
        <span class="cm">/**</span>
<span class="cm">         * 参数1：队列名称</span>
<span class="cm">         * 参数2：是否定义持久化队列</span>
<span class="cm">         * 参数3：是否独占本次连接</span>
<span class="cm">         * 参数4：是否在不使用的时候自动删除队列</span>
<span class="cm">         * 参数5：队列其它参数</span>
<span class="cm">         */</span>
       <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
       <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
       <span class="c1">// 队列绑定交换机</span>
        <span class="c1">// 队列1绑定error</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;error&quot;</span><span class="p">);</span>
        <span class="c1">// 队列2绑定info error warning</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;info&quot;</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;error&quot;</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;warning&quot;</span><span class="p">);</span>

        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;日志信息：张三调用了delete方法.错误了,日志级别error&quot;</span><span class="p">;</span>
        <span class="c1">// 发送消息</span>
        <span class="cm">/**</span>
<span class="cm">         * 参数1：交换机名称，如果没有指定则使用默认Default Exchage</span>
<span class="cm">         * 参数2：路由key,简单模式可以传递队列名称</span>
<span class="cm">         * 参数3：消息其它属性</span>
<span class="cm">         * 参数4：消息内容</span>
<span class="cm">         */</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicPublish</span><span class="p">(</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;warning&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="n">message</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

        <span class="c1">//9. 释放资源</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
        <span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
运行</p>
<p><img alt="1587022483860" src="../imgs/1587022483860.png" /></p>
<p><img alt="1587022569210" src="../imgs/1587022569210.png" /></p>
<h5 id="21_3">2）消费者1<a class="headerlink" href="#21_3" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.routing</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer1</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>

        <span class="n">String</span> <span class="n">queue1Name</span> <span class="o">=</span> <span class="s">&quot;test_direct_queue1&quot;</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_direct_queue2&quot;</span><span class="p">;</span>
      <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>
<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">               回调方法，当收到消息后，会自动执行该方法</span>
<span class="cm">               1. consumerTag：标识</span>
<span class="cm">               2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">               3. properties:配置信息</span>
<span class="cm">               4. body：数据</span>
<span class="cm">            */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;将日志信息打印到控制台.....&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="32_3">3）消费者2<a class="headerlink" href="#32_3" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.routing</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer2</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>

        <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_direct_queue2&quot;</span><span class="p">;</span>
      <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>
<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">               回调方法，当收到消息后，会自动执行该方法</span>
<span class="cm">               1. consumerTag：标识</span>
<span class="cm">               2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">               3. properties:配置信息</span>
<span class="cm">               4. body：数据</span>
<span class="cm">            */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;将日志信息存储到数据库.....&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="543">5.4.3. 测试<a class="headerlink" href="#543" title="Permanent link">&para;</a></h4>
<p>启动所有消费者，然后使用生产者发送消息；在消费者对应的控制台可以查看到生产者发送对应routing key对应队列的消息；到达按照需要接收的效果。</p>
<p><img alt="1587023420309" src="../imgs/1587023420309.png" /></p>
<h4 id="544">5.4.4. 小结<a class="headerlink" href="#544" title="Permanent link">&para;</a></h4>
<p>Routing模式要求队列在绑定交换机时要指定routing key，消息会转发到符合routing key的队列。</p>
<h3 id="55-topics">5.5. Topics通配符模式<a class="headerlink" href="#55-topics" title="Permanent link">&para;</a></h3>
<h4 id="551">5.5.1. 模式说明<a class="headerlink" href="#551" title="Permanent link">&para;</a></h4>
<p><code>Topic</code>类型与<code>Direct</code>相比，都是可以根据<code>RoutingKey</code>把消息路由到不同的队列。只不过<code>Topic</code>类型<code>Exchange</code>可以让队列在绑定<code>Routing key</code> 的时候<strong>使用通配符</strong>！</p>
<p><code>Routingkey</code> 一般都是有一个或多个单词组成，多个单词之间以”.”分割，例如： <code>item.insert</code></p>
<p>通配符规则：</p>
<p><code>#</code>：匹配一个或多个词</p>
<p><code>*</code>：匹配不多不少恰好1个词</p>
<p>举例：</p>
<p><code>item.#</code>：能够匹配<code>item.insert.abc</code> 或者 <code>item.insert</code></p>
<p><code>item.*</code>：只能匹配<code>item.insert</code></p>
<p><img alt="1556031362048" src="../imgs/1556031362048.png" /></p>
<p><img alt="1556031519931" src="../imgs/1556031519931.png" /></p>
<p>图解：</p>
<ul>
<li>红色Queue：绑定的是<code>usa.#</code> ，因此凡是以 <code>usa.</code>开头的<code>routing key</code> 都会被匹配到</li>
<li>黄色Queue：绑定的是<code>#.news</code> ，因此凡是以 <code>.news</code>结尾的 <code>routing key</code> 都会被匹配</li>
</ul>
<h4 id="552">5.5.2. 代码<a class="headerlink" href="#552" title="Permanent link">&para;</a></h4>
<h5 id="1_3">1）生产者<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h5>
<p>使用topic类型的Exchange，发送消息的routing key有3种： <code>order.info</code></p>
<p><div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.topic</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.BuiltinExchangeType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Producer</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>


        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>

        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
         <span class="cm">/*</span>
<span class="cm">       参数：</span>
<span class="cm">        1. exchange:交换机名称</span>
<span class="cm">        2. type:交换机类型</span>
<span class="cm">            DIRECT(&quot;direct&quot;),：定向</span>
<span class="cm">            FANOUT(&quot;fanout&quot;),：扇形（广播），发送消息到每一个与之绑定队列。</span>
<span class="cm">            TOPIC(&quot;topic&quot;),通配符的方式</span>
<span class="cm">            HEADERS(&quot;headers&quot;);参数匹配</span>

<span class="cm">        3. durable:是否持久化</span>
<span class="cm">        4. autoDelete:自动删除</span>
<span class="cm">        5. internal：内部使用。 一般false</span>
<span class="cm">        6. arguments：参数</span>
<span class="cm">        */</span>
         <span class="n">String</span> <span class="n">exchangeName</span> <span class="o">=</span> <span class="s">&quot;test_topic&quot;</span><span class="p">;</span>
         <span class="c1">// 创建交换机</span>
         <span class="n">channel</span><span class="p">.</span><span class="na">exchangeDeclare</span><span class="p">(</span><span class="n">exchangeName</span><span class="p">,</span> <span class="n">BuiltinExchangeType</span><span class="p">.</span><span class="na">TOPIC</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
         <span class="c1">// 创建队列</span>
        <span class="n">String</span> <span class="n">queue1Name</span> <span class="o">=</span> <span class="s">&quot;test_topic_queue1&quot;</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_topic_queue2&quot;</span><span class="p">;</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueDeclare</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="c1">// 绑定队列和交换机</span>
        <span class="cm">/**</span>
<span class="cm">         *  参数：</span>
<span class="cm">             1. queue：队列名称</span>
<span class="cm">             2. exchange：交换机名称</span>
<span class="cm">             3. routingKey：路由键，绑定规则</span>
<span class="cm">                 如果交换机的类型为fanout ，routingKey设置为&quot;&quot;</span>
<span class="cm">         */</span>
        <span class="c1">// routing key  系统的名称.日志的级别。</span>
        <span class="c1">//=需求： 所有error级别的日志存入数据库，所有order系统的日志存入数据库</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;#.error&quot;</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;order.*&quot;</span><span class="p">);</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">queueBind</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;*.*&quot;</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="s">&quot;日志信息：张三调用了findAll方法...日志级别：info...&quot;</span><span class="p">;</span>
        <span class="c1">//8. 发送消息goods.info，goods.error</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicPublish</span><span class="p">(</span><span class="n">exchangeName</span><span class="p">,</span><span class="s">&quot;order.info&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="n">body</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
       <span class="c1">//9. 释放资源</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
        <span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
运行程序</p>
<p><img alt="1587025193406" src="../imgs/1587025193406.png" /></p>
<p><img alt="1587025259473" src="../imgs/1587025259473.png" /></p>
<h5 id="21_4">2）消费者1<a class="headerlink" href="#21_4" title="Permanent link">&para;</a></h5>
<p>接收两种类型的消息：更新商品和删除商品</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.topic</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer1</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">queue1Name</span> <span class="o">=</span> <span class="s">&quot;test_topic_queue1&quot;</span><span class="p">;</span>


        <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">                回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">                1. consumerTag：标识</span>
<span class="cm">                2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">                3. properties:配置信息</span>
<span class="cm">                4. body：数据</span>

<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
              <span class="cm">/*  System.out.println(&quot;consumerTag：&quot;+consumerTag);</span>
<span class="cm">                System.out.println(&quot;Exchange：&quot;+envelope.getExchange());</span>
<span class="cm">                System.out.println(&quot;RoutingKey：&quot;+envelope.getRoutingKey());</span>
<span class="cm">                System.out.println(&quot;properties：&quot;+properties);*/</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="n">queue1Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="32_4">3）消费者2<a class="headerlink" href="#32_4" title="Permanent link">&para;</a></h5>
<p>接收所有类型的消息：新增商品，更新商品和删除商品。</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.topic</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer1</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-04-16</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumer2</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">//1.创建连接工厂</span>
        <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="p">();</span>
        <span class="c1">//2. 设置参数</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">);</span><span class="c1">//ip  默认值 localhost</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="mi">5672</span><span class="p">);</span> <span class="c1">//端口  默认值 5672</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="c1">//虚拟机 默认值/</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//用户名 默认 guest</span>
        <span class="n">factory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span><span class="c1">//密码 默认值 guest</span>
        <span class="c1">//3. 创建连接 Connection</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newConnection</span><span class="p">();</span>
        <span class="c1">//4. 创建Channel</span>
        <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="na">createChannel</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">queue2Name</span> <span class="o">=</span> <span class="s">&quot;test_topic_queue2&quot;</span><span class="p">;</span>


        <span class="cm">/*</span>
<span class="cm">        basicConsume(String queue, boolean autoAck, Consumer callback)</span>
<span class="cm">        参数：</span>
<span class="cm">            1. queue：队列名称</span>
<span class="cm">            2. autoAck：是否自动确认</span>
<span class="cm">            3. callback：回调对象</span>

<span class="cm">         */</span>
        <span class="c1">// 接收消息</span>
        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="p">(</span><span class="n">channel</span><span class="p">){</span>
            <span class="cm">/*</span>
<span class="cm">                回调方法，当收到消息后，会自动执行该方法</span>

<span class="cm">                1. consumerTag：标识</span>
<span class="cm">                2. envelope：获取一些信息，交换机，路由key...</span>
<span class="cm">                3. properties:配置信息</span>
<span class="cm">                4. body：数据</span>

<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="p">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="p">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">AMQP</span><span class="p">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
              <span class="cm">/*  System.out.println(&quot;consumerTag：&quot;+consumerTag);</span>
<span class="cm">                System.out.println(&quot;Exchange：&quot;+envelope.getExchange());</span>
<span class="cm">                System.out.println(&quot;RoutingKey：&quot;+envelope.getRoutingKey());</span>
<span class="cm">                System.out.println(&quot;properties：&quot;+properties);*/</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;body：&quot;</span><span class="o">+</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">channel</span><span class="p">.</span><span class="na">basicConsume</span><span class="p">(</span><span class="n">queue2Name</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="n">consumer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="553">5.5.3. 测试<a class="headerlink" href="#553" title="Permanent link">&para;</a></h4>
<p>启动所有消费者，然后使用生产者发送消息；在消费者对应的控制台可以查看到生产者发送对应routing key对应队列的消息；到达<strong>按照需要接收</strong>的效果；并且这些routing key可以使用通配符。</p>
<p><img alt="1587027210958" src="../imgs/1587027210958.png" /></p>
<h4 id="554">5.5.4. 小结<a class="headerlink" href="#554" title="Permanent link">&para;</a></h4>
<p>Topic主题模式可以实现 <code>Publish/Subscribe发布与订阅模式</code> 和 <code>Routing路由模式</code> 的功能；只是Topic在配置routing key 的时候可以使用通配符，显得更加灵活。</p>
<h3 id="56">5.6. 模式总结<a class="headerlink" href="#56" title="Permanent link">&para;</a></h3>
<p>RabbitMQ工作模式：
<strong>1、简单模式 HelloWorld</strong>
一个生产者、一个消费者，不需要设置交换机（使用默认的交换机）</p>
<p><strong>2、工作队列模式 Work Queue</strong>
一个生产者、多个消费者（竞争关系），不需要设置交换机（使用默认的交换机）</p>
<p><strong>3、发布订阅模式 Publish/subscribe</strong>
需要设置类型为fanout的交换机，并且交换机和队列进行绑定，当发送消息到交换机后，交换机会将消息发送到绑定的队列</p>
<p><strong>4、路由模式 Routing</strong>
需要设置类型为direct的交换机，交换机和队列进行绑定，并且指定routing key，当发送消息到交换机后，交换机会根据routing key将消息发送到对应的队列</p>
<p><strong>5、通配符模式 Topic</strong>
需要设置类型为topic的交换机，交换机和队列进行绑定，并且指定通配符方式的routing key，当发送消息到交换机后，交换机会根据routing key将消息发送到对应的队列</p>
<h2 id="6-spring-rabbitmq">6 Spring 整合RabbitMQ<a class="headerlink" href="#6-spring-rabbitmq" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1. 搭建生产者工程<a class="headerlink" href="#61" title="Permanent link">&para;</a></h3>
<h4 id="611">6.1.1. 创建工程<a class="headerlink" href="#611" title="Permanent link">&para;</a></h4>
<h4 id="612">6.1.2. 添加依赖<a class="headerlink" href="#612" title="Permanent link">&para;</a></h4>
<p>修改pom.xml文件内容为如下：</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.atguigu<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-rabbitmq-producer<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.8.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

     <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div>
<h4 id="613">6.1.3. 配置整合<a class="headerlink" href="#613" title="Permanent link">&para;</a></h4>
<p>1 创建<code>spring-rabbitmq-producer\src\main\resources\properties\rabbitmq.properties</code>连接参数等配置文件；</p>
<div class="highlight"><pre><span></span><code><span class="na">rabbitmq.host</span><span class="o">=</span><span class="s">localhost</span><span class="w"></span>
<span class="na">rabbitmq.port</span><span class="o">=</span><span class="s">5672</span><span class="w"></span>
<span class="na">rabbitmq.username</span><span class="o">=</span><span class="s">guest</span><span class="w"></span>
<span class="na">rabbitmq.password</span><span class="o">=</span><span class="s">guest</span><span class="w"></span>
<span class="na">rabbitmq.virtual-host</span><span class="o">=</span><span class="s">/</span><span class="w"></span>
</code></pre></div>
<p>2 创建 <code>spring-rabbitmq-producer\src\main\resources\spring\spring-rabbitmq.xml</code> 整合配置文件；</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:rabbit=</span><span class="s">&quot;http://www.springframework.org/schema/rabbit&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://www.springframework.org/schema/rabbit</span>
<span class="s">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!--加载配置文件--&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&quot;classpath:rabbitmq.properties&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- 定义rabbitmq connectionFactory --&gt;</span>
    <span class="nt">&lt;rabbit:connection-factory</span> <span class="na">id=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">host=</span><span class="s">&quot;${rabbitmq.host}&quot;</span>
                               <span class="na">port=</span><span class="s">&quot;${rabbitmq.port}&quot;</span>
                               <span class="na">username=</span><span class="s">&quot;${rabbitmq.username}&quot;</span>
                               <span class="na">password=</span><span class="s">&quot;${rabbitmq.password}&quot;</span>
                               <span class="na">virtual-host=</span><span class="s">&quot;${rabbitmq.virtual-host}&quot;</span><span class="nt">/&gt;</span>
    <span class="cm">&lt;!--定义管理交换机、队列--&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义持久化队列，不存在则自动创建；不绑定到交换机则绑定到默认交换机</span>
<span class="cm">    默认交换机类型为direct，名字为：&quot;&quot;，路由键为队列的名称</span>
<span class="cm">    --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;spring_queue&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_queue&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~广播；所有队列都能收到消息~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span>
    <span class="cm">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;spring_fanout_queue_1&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_fanout_queue_1&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;spring_fanout_queue_2&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_fanout_queue_2&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义广播类型交换机；并绑定上述两个队列--&gt;</span>
    <span class="nt">&lt;rabbit:fanout-exchange</span> <span class="na">id=</span><span class="s">&quot;spring_fanout_exchange&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_fanout_exchange&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">queue=</span><span class="s">&quot;spring_fanout_queue_1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">queue=</span><span class="s">&quot;spring_fanout_queue_2&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:fanout-exchange&gt;</span>

    <span class="cm">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~通配符；*匹配一个单词，#匹配多个单词 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span>
    <span class="cm">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;spring_topic_queue_star&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_topic_queue_star&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="cm">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;spring_topic_queue_well&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_topic_queue_well&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="cm">&lt;!--定义广播交换机中的持久化队列，不存在则自动创建--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;spring_topic_queue_well2&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_topic_queue_well2&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;rabbit:topic-exchange</span> <span class="na">id=</span><span class="s">&quot;spring_topic_exchange&quot;</span> <span class="na">name=</span><span class="s">&quot;spring_topic_exchange&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">pattern=</span><span class="s">&quot;atguigu.*&quot;</span> <span class="na">queue=</span><span class="s">&quot;spring_topic_queue_star&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">pattern=</span><span class="s">&quot;atguigu.#&quot;</span> <span class="na">queue=</span><span class="s">&quot;spring_topic_queue_well&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">pattern=</span><span class="s">&quot;guigu.#&quot;</span> <span class="na">queue=</span><span class="s">&quot;spring_topic_queue_well2&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:topic-exchange&gt;</span>

    <span class="cm">&lt;!--定义rabbitTemplate对象操作可以在代码中方便发送消息--&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">&quot;rabbitTemplate&quot;</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<h4 id="614">6.1.4. 发送消息<a class="headerlink" href="#614" title="Permanent link">&para;</a></h4>
<p>创建测试文件 <code>spring-rabbitmq-producer\src\test\java\com\atguigu\rabbitmq\ProducerTest.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">&quot;classpath:spring-rabbitmq.xml&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RabbitTemplate</span> <span class="n">rabbitTemplate</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * 只发队列消息</span>
<span class="cm">     * 默认交换机类型为 direct</span>
<span class="cm">     * 交换机的名称为空，路由键为队列的名称</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">queueTest</span><span class="p">(){</span>
        <span class="c1">//路由键与队列同名</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;spring_queue&quot;</span><span class="p">,</span> <span class="s">&quot;只发队列spring_queue的消息。&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 发送广播</span>
<span class="cm">     * 交换机类型为 fanout</span>
<span class="cm">     * 绑定到该交换机的所有队列都能够收到消息</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fanoutTest</span><span class="p">(){</span>
        <span class="cm">/**</span>
<span class="cm">         * 参数1：交换机名称</span>
<span class="cm">         * 参数2：路由键名（广播设置为空）</span>
<span class="cm">         * 参数3：发送的消息内容</span>
<span class="cm">         */</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;spring_fanout_exchange&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;发送到spring_fanout_exchange交换机的广播消息&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 通配符</span>
<span class="cm">     * 交换机类型为 topic</span>
<span class="cm">     * 匹配路由键的通配符，*表示一个单词，#表示多个单词</span>
<span class="cm">     * 绑定到该交换机的匹配队列能够收到对应消息</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">topicTest</span><span class="p">(){</span>
        <span class="cm">/**</span>
<span class="cm">         * 参数1：交换机名称</span>
<span class="cm">         * 参数2：路由键名</span>
<span class="cm">         * 参数3：发送的消息内容</span>
<span class="cm">         */</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;spring_topic_exchange&quot;</span><span class="p">,</span> <span class="s">&quot;atguigu.bj&quot;</span><span class="p">,</span> <span class="s">&quot;发送到spring_topic_exchange交换机atguigu.bj的消息&quot;</span><span class="p">);</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;spring_topic_exchange&quot;</span><span class="p">,</span> <span class="s">&quot;atguigu.bj.1&quot;</span><span class="p">,</span> <span class="s">&quot;发送到spring_topic_exchange交换机atguigu.bj.1的消息&quot;</span><span class="p">);</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;spring_topic_exchange&quot;</span><span class="p">,</span> <span class="s">&quot;atguigu.bj.2&quot;</span><span class="p">,</span> <span class="s">&quot;发送到spring_topic_exchange交换机atguigu.bj.2的消息&quot;</span><span class="p">);</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;spring_topic_exchange&quot;</span><span class="p">,</span> <span class="s">&quot;guigu.cn&quot;</span><span class="p">,</span> <span class="s">&quot;发送到spring_topic_exchange交换机guigu.cn的消息&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="62">6.2. 搭建消费者工程<a class="headerlink" href="#62" title="Permanent link">&para;</a></h3>
<h4 id="621">6.2.1. 创建工程<a class="headerlink" href="#621" title="Permanent link">&para;</a></h4>
<h4 id="622">6.2.2. 添加依赖<a class="headerlink" href="#622" title="Permanent link">&para;</a></h4>
<p>修改pom.xml文件内容为如下：</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.atguigu<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-rabbitmq-consumer<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.8.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

     <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>


<span class="nt">&lt;/project&gt;</span>
</code></pre></div>
<h4 id="623">6.2.3. 配置整合<a class="headerlink" href="#623" title="Permanent link">&para;</a></h4>
<p>创建<code>spring-rabbitmq-consumer\src\main\resources\properties\rabbitmq.properties</code>连接参数等配置文件；</p>
<div class="highlight"><pre><span></span><code><span class="na">rabbitmq.host</span><span class="o">=</span><span class="s">localhost</span><span class="w"></span>
<span class="na">rabbitmq.port</span><span class="o">=</span><span class="s">5672</span><span class="w"></span>
<span class="na">rabbitmq.username</span><span class="o">=</span><span class="s">guest</span><span class="w"></span>
<span class="na">rabbitmq.password</span><span class="o">=</span><span class="s">guest</span><span class="w"></span>
<span class="na">rabbitmq.virtual-host</span><span class="o">=</span><span class="s">/</span><span class="w"></span>
</code></pre></div>
<p>创建 <code>spring-rabbitmq-consumer\src\main\resources\spring\spring-rabbitmq.xml</code> 整合配置文件；</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:rabbit=</span><span class="s">&quot;http://www.springframework.org/schema/rabbit&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://www.springframework.org/schema/rabbit</span>
<span class="s">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!--加载配置文件--&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&quot;classpath:rabbitmq.properties&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- 定义rabbitmq connectionFactory --&gt;</span>
    <span class="nt">&lt;rabbit:connection-factory</span> <span class="na">id=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">host=</span><span class="s">&quot;${rabbitmq.host}&quot;</span>
                               <span class="na">port=</span><span class="s">&quot;${rabbitmq.port}&quot;</span>
                               <span class="na">username=</span><span class="s">&quot;${rabbitmq.username}&quot;</span>
                               <span class="na">password=</span><span class="s">&quot;${rabbitmq.password}&quot;</span>
                               <span class="na">virtual-host=</span><span class="s">&quot;${rabbitmq.virtual-host}&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;springQueueListener&quot;</span> <span class="na">class=</span><span class="s">&quot;com.atguigu.rabbitmq.listener.SpringQueueListener&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;fanoutListener1&quot;</span> <span class="na">class=</span><span class="s">&quot;com.atguigu.rabbitmq.listener.FanoutListener1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;fanoutListener2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.atguigu.rabbitmq.listener.FanoutListener2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;topicListenerStar&quot;</span> <span class="na">class=</span><span class="s">&quot;com.atguigu.rabbitmq.listener.TopicListenerStar&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;topicListenerWell&quot;</span> <span class="na">class=</span><span class="s">&quot;com.atguigu.rabbitmq.listener.TopicListenerWell&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;topicListenerWell2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.atguigu.rabbitmq.listener.TopicListenerWell2&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;rabbit:listener-container</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">auto-declare=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;springQueueListener&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;spring_queue&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;fanoutListener1&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;spring_fanout_queue_1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;fanoutListener2&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;spring_fanout_queue_2&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;topicListenerStar&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;spring_topic_queue_star&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;topicListenerWell&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;spring_topic_queue_well&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;topicListenerWell2&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;spring_topic_queue_well2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rabbit:listener-container&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<h4 id="624">6.2.4. 消息监听器<a class="headerlink" href="#624" title="Permanent link">&para;</a></h4>
<h5 id="1_4">1）队列监听器<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h5>
<p>创建 <code>spring-rabbitmq-consumer\src\main\java\com\atguigu\rabbitmq\listener\SpringQueueListener.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.rabbitmq.listener</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.MessageListener</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringQueueListener</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span> <span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;接收路由名称为：%s，路由键为：%s，队列名为：%s的消息：%s \n&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedExchange</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedRoutingKey</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getConsumerQueue</span><span class="p">(),</span>
                    <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>添加一个测试类，进行测试</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">&quot;classpath:spring-rabbitmq.xml&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerTest</span> <span class="p">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="p">(){</span>
        <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">){</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="21_5">2）广播监听器1<a class="headerlink" href="#21_5" title="Permanent link">&para;</a></h5>
<p>创建 <code>spring-rabbitmq-consumer\src\main\java\com\atguigu\rabbitmq\listener\FanoutListener1.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FanoutListener1</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span> <span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;广播监听器1：接收路由名称为：%s，路由键为：%s，队列名为：%s的消息：%s \n&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedExchange</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedRoutingKey</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getConsumerQueue</span><span class="p">(),</span>
                    <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="32_5">3）广播监听器2<a class="headerlink" href="#32_5" title="Permanent link">&para;</a></h5>
<p>创建 <code>spring-rabbitmq-consumer\src\main\java\com\atguigu\rabbitmq\listener\FanoutListener2.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FanoutListener2</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span> <span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;广播监听器2：接收路由名称为：%s，路由键为：%s，队列名为：%s的消息：%s \n&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedExchange</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedRoutingKey</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getConsumerQueue</span><span class="p">(),</span>
                    <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="4">4）星号通配符监听器<a class="headerlink" href="#4" title="Permanent link">&para;</a></h5>
<p>创建 <code>spring-rabbitmq-consumer\src\main\java\com\atguigu\rabbitmq\listener\TopicListenerStar.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TopicListenerStar</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span> <span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;通配符*监听器：接收路由名称为：%s，路由键为：%s，队列名为：%s的消息：%s \n&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedExchange</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedRoutingKey</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getConsumerQueue</span><span class="p">(),</span>
                    <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="5">5）井号通配符监听器<a class="headerlink" href="#5" title="Permanent link">&para;</a></h5>
<p>创建 <code>spring-rabbitmq-consumer\src\main\java\com\atguigu\rabbitmq\listener\TopicListenerWell.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TopicListenerWell</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span> <span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;通配符#监听器：接收路由名称为：%s，路由键为：%s，队列名为：%s的消息：%s \n&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedExchange</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedRoutingKey</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getConsumerQueue</span><span class="p">(),</span>
                    <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="62_1">6）井号通配符监听器2<a class="headerlink" href="#62_1" title="Permanent link">&para;</a></h5>
<p>创建 <code>spring-rabbitmq-consumer\src\main\java\com\atguigu\rabbitmq\listener\TopicListenerWell2.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TopicListenerWell2</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span> <span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;通配符#监听器2：接收路由名称为：%s，路由键为：%s，队列名为：%s的消息：%s \n&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedExchange</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getReceivedRoutingKey</span><span class="p">(),</span>
                    <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getConsumerQueue</span><span class="p">(),</span>
                    <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="7-rabbitmq">7 RabbitMQ高级特性<a class="headerlink" href="#7-rabbitmq" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 消息的可靠投递<a class="headerlink" href="#71" title="Permanent link">&para;</a></h3>
<p>在使用 RabbitMQ 的时候，作为消息发送方希望杜绝任何消息丢失或者投递失败场景。RabbitMQ 为我们提供了消息的确认机制，用来控制消息投递的可靠性模式。</p>
<p>消息的确认，是指生产者投递消息后，如果Broker收到消息，则会给我们生产这一个应答。</p>
<p>生产者进行接收应答，用来确定这条消息是否正常的发送到Broker，这种方式也是消息的可靠性投递的核心保障。</p>
<p><img alt="1591533978613" src="../imgs/1591533978613.png" /></p>
<p><strong>如何实现Confirm确认消息？</strong></p>
<p>第一步：在channel上开启确认模式：channel.confirmSelect()</p>
<p>第二步：在channel上添加监听：addConfirmListener，监听成功和失败的返回结果，</p>
<p>根据具体的结果对消息进行重新发送、或者记录日志等后续处理。</p>
<p>rabbitmq 整个消息投递的路径为：</p>
<p>producer---&gt;rabbitmq broker---&gt;exchange---&gt;queue---&gt;consumer</p>
<p>消息从 producer 到 exchange 则会返回一个 confirmCallback 。</p>
<p>消息从 exchange&rarr;queue 投递失败则会返回一个 returnCallback 。</p>
<p>我们将利用这两个 callback 控制消息的可靠性投递</p>
<h4 id="711-confirm">7.1.1 Confirm 确认机制<a class="headerlink" href="#711-confirm" title="Permanent link">&para;</a></h4>
<p>① 创建项目 <code>rabbitmq-producer-spring</code></p>
<p>② 添加pom文件</p>
<div class="highlight"><pre><span></span><code> <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.8.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</code></pre></div>
<p>③ 在resource 文件夹下面添加 配置文件 <code>rabbitmq.properties</code></p>
<div class="highlight"><pre><span></span><code>rabbitmq.host=localhost
rabbitmq.port=5672
rabbitmq.username=guest
rabbitmq.password=guest
rabbitmq.virtual-host=/
</code></pre></div>
<p>在resource 文件夹下面添加 配置文件 <code>spring-rabbitmq-producer.xml</code></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:rabbit=</span><span class="s">&quot;http://www.springframework.org/schema/rabbit&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://www.springframework.org/schema/rabbit</span>
<span class="s">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!--加载配置文件--&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&quot;classpath:rabbitmq.properties&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- 定义rabbitmq connectionFactory</span>
<span class="cm">     确认模式开启:publisher-confirms=&quot;true&quot;</span>

<span class="cm">    --&gt;</span>
    <span class="nt">&lt;rabbit:connection-factory</span> <span class="na">id=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">host=</span><span class="s">&quot;${rabbitmq.host}&quot;</span>
                               <span class="na">port=</span><span class="s">&quot;${rabbitmq.port}&quot;</span>
                               <span class="na">username=</span><span class="s">&quot;${rabbitmq.username}&quot;</span>
                               <span class="na">password=</span><span class="s">&quot;${rabbitmq.password}&quot;</span>
                               <span class="na">virtual-host=</span><span class="s">&quot;${rabbitmq.virtual-host}&quot;</span>
                               <span class="na">publisher-confirms=</span><span class="s">&quot;true&quot;</span>
                               <span class="na">publisher-returns=</span><span class="s">&quot;true&quot;</span>
    <span class="nt">/&gt;</span>
    <span class="cm">&lt;!--定义管理交换机、队列--&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义rabbitTemplate对象操作可以在代码中方便发送消息--&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">&quot;rabbitTemplate&quot;</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span><span class="nt">/&gt;</span>



    <span class="cm">&lt;!--消息可靠性投递（生产端）--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;test_queue_confirm&quot;</span> <span class="na">name=</span><span class="s">&quot;test_queue_confirm&quot;</span><span class="nt">&gt;&lt;/rabbit:queue&gt;</span>
    <span class="nt">&lt;rabbit:direct-exchange</span> <span class="na">name=</span><span class="s">&quot;test_exchange_confirm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">queue=</span><span class="s">&quot;test_queue_confirm&quot;</span> <span class="na">key=</span><span class="s">&quot;confirm&quot;</span><span class="nt">&gt;&lt;/rabbit:binding&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:direct-exchange&gt;</span>




<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<p>④ 创建测试类 ， 添加确认模式</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span>


<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.AmqpException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.MessagePostProcessor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.CorrelationData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">&quot;classpath:spring-rabbitmq-producer.xml&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RabbitTemplate</span> <span class="n">rabbitTemplate</span><span class="p">;</span>
    <span class="cm">/**</span>
<span class="cm">     * 确认模式：</span>
<span class="cm">     * 步骤：</span>
<span class="cm">     * 1. 确认模式开启：ConnectionFactory中开启publisher-confirms=&quot;true&quot;</span>
<span class="cm">     * 2. 在rabbitTemplate定义ConfirmCallBack回调函数</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testConfirm</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//2. 定义回调</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">setConfirmCallback</span><span class="p">(</span><span class="k">new</span> <span class="n">RabbitTemplate</span><span class="p">.</span><span class="na">ConfirmCallback</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">confirm</span><span class="p">(</span><span class="n">CorrelationData</span> <span class="n">correlationData</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">ack</span><span class="p">,</span> <span class="n">String</span> <span class="n">cause</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">ack</span><span class="p">){</span>
                    <span class="c1">//接收成功</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;接收成功消息&quot;</span> <span class="o">+</span> <span class="n">cause</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                    <span class="c1">//接收失败</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;接收失败消息&quot;</span> <span class="o">+</span> <span class="n">cause</span><span class="p">);</span>
                    <span class="c1">//做一些处理，让消息再次发送。</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="c1">//3. 发送消息</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;test_exchange_confirm000&quot;</span><span class="p">,</span> <span class="s">&quot;confirm&quot;</span><span class="p">,</span> <span class="s">&quot;message confirm....&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>运行程序</p>
<p><img alt="1587812545336" src="../imgs/1587812545336.png" /></p>
<h4 id="712-return">7.1.2 Return回退机制<a class="headerlink" href="#712-return" title="Permanent link">&para;</a></h4>
<p>Return Listener用于处理一些不可路由的消息。</p>
<p>我们的消息生产者，通过指定一个Exchange和Routingkey，把消息送到某一个队列中，</p>
<p>然后我们的消费者监听队列，进行消息处理操作。</p>
<p>但是在某些情况下，如果我们在发送消息的时候，当前的exchange不存在或者指定的路由key路由不到，</p>
<p>这个时候我们需要监听这种不可达的消息，就要使用return listener。</p>
<p><strong>在基础API中有一个关键的配置项：</strong></p>
<p><strong>Mandatory</strong>：如果为true，则监听会接收到路由不可达的消息，然后进行后续处理，</p>
<p>如果为false，那么broker端自动删除该消息。（默认false）</p>
<p><img alt="1591536834563" src="../imgs/1591536834563.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span>


<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.AmqpException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.MessagePostProcessor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.CorrelationData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">&quot;classpath:spring-rabbitmq-producer.xml&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RabbitTemplate</span> <span class="n">rabbitTemplate</span><span class="p">;</span>


    <span class="cm">/**</span>
<span class="cm">     * 回退模式： 当消息发送给Exchange后，Exchange路由到Queue失败是 才会执行 ReturnCallBack</span>
<span class="cm">     * 步骤：</span>
<span class="cm">     * 1. 开启回退模式:publisher-returns=&quot;true&quot;</span>
<span class="cm">     * 2. 设置ReturnCallBack</span>
<span class="cm">     * 3. 设置Exchange处理消息的模式：</span>
<span class="cm">     * 1. 如果消息没有路由到Queue，则丢弃消息（默认）</span>
<span class="cm">     * 2. 如果消息没有路由到Queue，返回给消息发送方ReturnCallBack</span>
<span class="cm">     */</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testReturn</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">//交换机设置强制处理失败消息的模式</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">setMandatory</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

        <span class="c1">//2.设置ReturnCallBack</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">setReturnCallback</span><span class="p">(</span><span class="k">new</span> <span class="n">RabbitTemplate</span><span class="p">.</span><span class="na">ReturnCallback</span><span class="p">()</span> <span class="p">{</span>
            <span class="cm">/**</span>
<span class="cm">             *</span>
<span class="cm">             * @param message   消息对象</span>
<span class="cm">             * @param replyCode 错误码</span>
<span class="cm">             * @param replyText 错误信息</span>
<span class="cm">             * @param exchange  交换机</span>
<span class="cm">             * @param routingKey 路由键</span>
<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnedMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">,</span> <span class="kt">int</span> <span class="n">replyCode</span><span class="p">,</span> <span class="n">String</span> <span class="n">replyText</span><span class="p">,</span> <span class="n">String</span> <span class="n">exchange</span><span class="p">,</span> <span class="n">String</span> <span class="n">routingKey</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;return 执行了....&quot;</span><span class="p">);</span>

                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">replyCode</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">replyText</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">exchange</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">routingKey</span><span class="p">);</span>

                <span class="c1">//处理</span>
            <span class="p">}</span>
        <span class="p">});</span>


        <span class="c1">//3. 发送消息</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;test_exchange_confirm&quot;</span><span class="p">,</span> <span class="s">&quot;confirm&quot;</span><span class="p">,</span> <span class="s">&quot;message confirm....&quot;</span><span class="p">);</span>
    <span class="p">}</span>


<span class="p">}</span>
</code></pre></div>
<h4 id="713">7.1.3 消息的可靠投递小结<a class="headerlink" href="#713" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>设置 <code>ConnectionFactory</code>的<code>publisher-confirms="true"</code> 开启 确认模式。</p>
</li>
<li>
<p>使用 <code>rabbitTemplate.setConfirmCallback</code> 设置回调函数。当消息发送到 <code>exchange</code> 后回调 <code>confirm</code> 方法。在方法中判断 <code>ack</code>，如果为<code>true</code>，则发送成功，如果为<code>false</code>，则发送失败，需要处理。</p>
</li>
<li>
<p>设置 <code>ConnectionFactory</code> 的 <code>publisher-returns="true"</code>  开启 退回模式。</p>
</li>
<li>
<p>使用 <code>rabbitTemplate.setReturnCallback</code> 设置退回函数，当消息从<code>exchange</code> 路由到 <code>queue</code> 失败后，如果设置了 <code>rabbitTemplate.setMandatory(true)</code> 参数，则会将消息退回给 <code>producer</code>并执行回调函数<code>returnedMessage</code></p>
</li>
</ul>
<h4 id="714-consumer-ack">7.1.4 Consumer Ack<a class="headerlink" href="#714-consumer-ack" title="Permanent link">&para;</a></h4>
<p>ack指Acknowledge，确认。 表示消费端收到消息后的确认方式。</p>
<p>有二种确认方式：</p>
<ul>
<li>
<p>自动确认：acknowledge="none"</p>
</li>
<li>
<p>手动确认：acknowledge="manual"</p>
</li>
</ul>
<p>其中自动确认是指，当消息一旦被Consumer接收到，则自动确认收到，并将相应 message 从 RabbitMQ 的消息缓存中移除。但是在实际业务处理中，很可能消息接收到，业务处理出现异常，那么该消息就会丢失。如果设置了手动确认方式，则需要在业务处理成功后，调用channel.basicAck()，手动签收，如果出现异常，则调用channel.basicNack()方法，让其自动重新发送消息。</p>
<p>① 创建项目 <code>rabbitmq-consumer-spring</code></p>
<p>② 添加pom文件</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.8.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.7.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</code></pre></div>
<p>③ 在 <code>resource</code> 文件夹下面新建 <code>rabbitmq.properties</code> 文件 和 <code>spring-rabbitmq-consumer.xml</code> 文件</p>
<p><code>rabbitmq.properties</code> 文件</p>
<div class="highlight"><pre><span></span><code><span class="na">rabbitmq.host</span><span class="o">=</span><span class="s">localhost</span><span class="w"></span>
<span class="na">rabbitmq.port</span><span class="o">=</span><span class="s">5672</span><span class="w"></span>
<span class="na">rabbitmq.username</span><span class="o">=</span><span class="s">guest</span><span class="w"></span>
<span class="na">rabbitmq.password</span><span class="o">=</span><span class="s">guest</span><span class="w"></span>
<span class="na">rabbitmq.virtual-host</span><span class="o">=</span><span class="s">/</span><span class="w"></span>
</code></pre></div>
<p><code>spring-rabbitmq-consumer.xml</code> 文件</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:rabbit=</span><span class="s">&quot;http://www.springframework.org/schema/rabbit&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://www.springframework.org/schema/rabbit</span>
<span class="s">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!--加载配置文件--&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&quot;classpath:rabbitmq.properties&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- 定义rabbitmq connectionFactory --&gt;</span>
    <span class="nt">&lt;rabbit:connection-factory</span> <span class="na">id=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">host=</span><span class="s">&quot;${rabbitmq.host}&quot;</span>
                               <span class="na">port=</span><span class="s">&quot;${rabbitmq.port}&quot;</span>
                               <span class="na">username=</span><span class="s">&quot;${rabbitmq.username}&quot;</span>
                               <span class="na">password=</span><span class="s">&quot;${rabbitmq.password}&quot;</span>
                               <span class="na">virtual-host=</span><span class="s">&quot;${rabbitmq.virtual-host}&quot;</span><span class="nt">/&gt;</span>


    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.atguigu.listener&quot;</span> <span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义监听器容器</span>
<span class="cm">    acknowledge=&quot;manual&quot;:手动签收</span>
<span class="cm">    --&gt;</span>
    <span class="nt">&lt;rabbit:listener-container</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">acknowledge=</span><span class="s">&quot;manual&quot;</span><span class="nt">&gt;</span>

        <span class="cm">&lt;!--延迟队列效果实现：  一定要监听的是 死信队列！！！--&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;ackListener&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;test_queue_confirm&quot;</span><span class="nt">&gt;&lt;/rabbit:listener&gt;</span>
    <span class="nt">&lt;/rabbit:listener-container&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<h5 id="7141">7.1.4.1 自动确认<a class="headerlink" href="#7141" title="Permanent link">&para;</a></h5>
<p>④ 添加监听器</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.listener</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.MessageListener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * AckListener</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-05-31</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AckListener</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">()));</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="7142">7.1.4.2 手动确认<a class="headerlink" href="#7142" title="Permanent link">&para;</a></h5>
<p>④ 添加监听器</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.listener</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer ACK机制：</span>
<span class="cm"> *  1. 设置手动签收。acknowledge=&quot;manual&quot;</span>
<span class="cm"> *  2. 让监听器类实现ChannelAwareMessageListener接口</span>
<span class="cm"> *  3. 如果消息成功处理，则调用channel的 basicAck()签收</span>
<span class="cm"> *  4. 如果消息处理失败，则调用channel的basicNack()拒绝签收，broker重新发送给consumer</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AckListener</span> <span class="kd">implements</span> <span class="n">ChannelAwareMessageListener</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">,</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="c1">// 获取消息传递标记</span>
        <span class="kt">long</span> <span class="n">deliveryTag</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getDeliveryTag</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>

            <span class="c1">// ① 接收消息</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">()));</span>
            <span class="c1">// ② 处理业务逻辑</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;处理业务逻辑&quot;</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">0</span><span class="p">;</span><span class="c1">//出现错误</span>
            <span class="c1">// ③ 手动签收</span>
            <span class="cm">/**</span>
<span class="cm">             * 第一个参数：表示收到的标签</span>
<span class="cm">             * 第二个参数：如果为true表示可以签收所有的消息</span>
<span class="cm">             */</span>
            <span class="n">channel</span><span class="p">.</span><span class="na">basicAck</span><span class="p">(</span><span class="n">deliveryTag</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="c1">// ④ 拒绝签收</span>
             <span class="cm">/*</span>
<span class="cm">            第三个参数：requeue：重回队列。</span>
<span class="cm">            设置为true，则消息重新回到queue，broker会重新发送该消息给消费端</span>
<span class="cm">             */</span>
            <span class="n">channel</span><span class="p">.</span><span class="na">basicNack</span><span class="p">(</span><span class="n">deliveryTag</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>⑤ 添加测试类</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>


<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">&quot;classpath:spring-rabbitmq-consumer.xml&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerTest</span> <span class="p">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="p">(){</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">){</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>运行测试类 ，会一直监听消息 ，查看后台 <code>http://localhost:15672/#/queues</code></p>
<p><img alt="1587979025053" src="../imgs/1587979025053.png" /></p>
<p>当程序报错，程序会拒绝签收，直到修改错误，修改上面的监听器，注释 除 0 错误 ，重新运行程序</p>
<p><img alt="1587979311003" src="../imgs/1587979311003.png" /></p>
<p>Consumer Ack 小结</p>
<p>在rabbit:listener-container标签中设置acknowledge属性，设置ack方式 none：自动确认，manual：手动确认</p>
<p>如果在消费端没有出现异常，则调用channel.basicAck(deliveryTag,true);方法确认签收消息</p>
<p>如果出现异常，则在catch中调用 basicNack，拒绝消息，让MQ重新发送消息。</p>
<h3 id="72">7.2 消费端限流<a class="headerlink" href="#72" title="Permanent link">&para;</a></h3>
<p><img alt="1587991021680" src="../imgs/1587991021680.png" /></p>
<p>在项目 <code>rabbitmq-consumer-spring</code>  ,新建 <code>com.atguigu.listener.QosListener</code>  </p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.listener</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Consumer 限流机制</span>
<span class="cm"> *  1. 确保ack机制为手动确认。</span>
<span class="cm"> *  2. listener-container配置属性</span>
<span class="cm"> *      perfetch = 1,表示消费端每次从mq拉去一条消息来消费，直到手动确认消费完毕后，才会继续拉去下一条消息。</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QosListener</span> <span class="kd">implements</span> <span class="n">ChannelAwareMessageListener</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">,</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="c1">//1.获取消息</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">()));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>修改<code>spring-rabbitmq-consumer.xml</code> 配置文件</p>
<p><img alt="1587992089963" src="../imgs/1587992089963.png" /></p>
<p>运行消费者</p>
<p>在项目 <code>spring-rabbitmq-producers</code>  , <code>ProducerTest</code> 测试方法</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.CorrelationData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * ProducerTest</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @CreateTime: 2020-05-31</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ContextConfiguration</span><span class="p">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">&quot;classpath:spring-rabbitmq-producer.xml&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerTest</span> <span class="p">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSend</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;test_exchange_confirm&quot;</span><span class="p">,</span><span class="s">&quot;confirm&quot;</span><span class="p">,</span><span class="s">&quot;message confirm&quot;</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>    
</code></pre></div>
<p>运行提供者</p>
<p><img alt="1587992456849" src="../imgs/1587992456849.png" /></p>
<p>查看后台 ，有 9 条消息待消费 ，有 1 条消息未确认</p>
<p><img alt="1587992524355" src="../imgs/1587992524355.png" /></p>
<p>修改消费者配置文件 ，去掉  <code>prefetch="1"</code>  会发现一次就可以消费所有消息</p>
<p><img alt="1587992658853" src="../imgs/1587992658853.png" /></p>
<p>运行消费者测试类 <code>ConsumerTest</code></p>
<p><img alt="1587992727609" src="../imgs/1587992727609.png" /></p>
<p>修改 <code>QosListener</code>  , 添加手动签收方法 ，这样就可以确认消费限流</p>
<p><img alt="1587992934241" src="../imgs/1587992934241.png" /></p>
<p>运行程序</p>
<p>消费端限流小结</p>
<p>在 <code>&lt;rabbit:listener-container&gt;</code>中配置 <code>prefetch</code> 属性设置消费端一次拉取多少消息</p>
<p>消费端的确认模式一定为手动确认。<code>acknowledge="manual"</code></p>
<h3 id="73-ttl">7.3 TTL<a class="headerlink" href="#73-ttl" title="Permanent link">&para;</a></h3>
<p>TTL 全称 Time To Live（存活时间/过期时间）。</p>
<p>当消息到达存活时间后，还没有被消费，会被自动清除。</p>
<p>RabbitMQ可以对消息设置过期时间，也可以对整个队列（Queue）设置过期时间。</p>
<p><img alt="1588052784545" src="../imgs/1588052784545.png" /></p>
<h4 id="731">7.3.1 控制后台演示<a class="headerlink" href="#731" title="Permanent link">&para;</a></h4>
<p>修改管理后台界面，增加队列</p>
<p>参数：表示过期时间，单位毫秒 ，10000表示10秒</p>
<p><img alt="1588048297616" src="../imgs/1588048297616.png" /></p>
<p>增加交换机</p>
<p><img alt="1588053706920" src="../imgs/1588053706920.png" /></p>
<p>绑定队列</p>
<p><img alt="1588053959201" src="../imgs/1588053959201.png" /></p>
<p>发送消息</p>
<p>Delivery mode：表示需要进行持久化</p>
<p><img alt="1588060174162" src="../imgs/1588060174162.png" /></p>
<p>查看消息，可以看到消息，但十秒之后，消息自动消失，因为我们设置了十秒消息过期</p>
<p><img alt="1588060322965" src="../imgs/1588060322965.png" /></p>
<h4 id="732">7.3.2 代码实现<a class="headerlink" href="#732" title="Permanent link">&para;</a></h4>
<h5 id="7321">7.3.2.1 队列统一过期<a class="headerlink" href="#7321" title="Permanent link">&para;</a></h5>
<p>修改 <code>rabbitmq-producer-spring</code>  项目的 配置文件 <code>spring-rabbitmq-producer.xml</code></p>
<p><img alt="1588063369543" src="../imgs/1588063369543.png" /></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:rabbit=</span><span class="s">&quot;http://www.springframework.org/schema/rabbit&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://www.springframework.org/schema/rabbit</span>
<span class="s">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!--加载配置文件--&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&quot;classpath:rabbitmq.properties&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- 定义rabbitmq connectionFactory --&gt;</span>
    <span class="nt">&lt;rabbit:connection-factory</span> <span class="na">id=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">host=</span><span class="s">&quot;${rabbitmq.host}&quot;</span>
                               <span class="na">port=</span><span class="s">&quot;${rabbitmq.port}&quot;</span>
                               <span class="na">username=</span><span class="s">&quot;${rabbitmq.username}&quot;</span>
                               <span class="na">password=</span><span class="s">&quot;${rabbitmq.password}&quot;</span>
                               <span class="na">virtual-host=</span><span class="s">&quot;${rabbitmq.virtual-host}&quot;</span>
                               <span class="na">publisher-confirms=</span><span class="s">&quot;true&quot;</span>
                               <span class="na">publisher-returns=</span><span class="s">&quot;true&quot;</span>
    <span class="nt">/&gt;</span>
    <span class="cm">&lt;!--定义管理交换机、队列--&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义rabbitTemplate对象操作可以在代码中方便发送消息--&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">&quot;rabbitTemplate&quot;</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span><span class="nt">/&gt;</span>



    <span class="cm">&lt;!--消息可靠性投递（生产端）--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">id=</span><span class="s">&quot;test_queue_confirm&quot;</span> <span class="na">name=</span><span class="s">&quot;test_queue_confirm&quot;</span><span class="nt">&gt;&lt;/rabbit:queue&gt;</span>
    <span class="nt">&lt;rabbit:direct-exchange</span> <span class="na">name=</span><span class="s">&quot;test_exchange_confirm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">queue=</span><span class="s">&quot;test_queue_confirm&quot;</span> <span class="na">key=</span><span class="s">&quot;confirm&quot;</span><span class="nt">&gt;&lt;/rabbit:binding&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:direct-exchange&gt;</span>


    <span class="cm">&lt;!--TTL 队列--&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">&quot;test_queue_ttl&quot;</span> <span class="na">id=</span><span class="s">&quot;test_queue_ttl&quot;</span><span class="nt">&gt;</span>
        <span class="cm">&lt;!--设置queue的参数--&gt;</span>
         <span class="nt">&lt;rabbit:queue-arguments&gt;</span>
             <span class="cm">&lt;!--</span>
<span class="cm">               设置x-message-ttl队列的过期时间</span>
<span class="cm">               默认情况下value-type的类型是String类型，但时间的类型是number类型，所以需要设置成integer类型</span>
<span class="cm">             --&gt;</span>
             <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;x-message-ttl&quot;</span> <span class="na">value=</span><span class="s">&quot;10000&quot;</span> <span class="na">value-type=</span><span class="s">&quot;java.lang.Integer&quot;</span><span class="nt">&gt;&lt;/entry&gt;</span>
         <span class="nt">&lt;/rabbit:queue-arguments&gt;</span>
    <span class="nt">&lt;/rabbit:queue&gt;</span>

    <span class="cm">&lt;!--设置交换机--&gt;</span>
    <span class="nt">&lt;rabbit:topic-exchange</span> <span class="na">name=</span><span class="s">&quot;test_exchange_ttl&quot;</span><span class="nt">&gt;</span>
        <span class="cm">&lt;!--交换机绑定队列--&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">pattern=</span><span class="s">&quot;ttl.#&quot;</span> <span class="na">queue=</span><span class="s">&quot;test_queue_ttl&quot;</span><span class="nt">&gt;&lt;/rabbit:binding&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:topic-exchange&gt;</span>


<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<p>在测试类 <code>ProducerTest</code>  中，添加测试方法，发送消息 ，十秒之后自动过期</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Testpublic</span> <span class="kt">void</span> <span class="nf">testTTL</span><span class="p">()</span> <span class="p">{</span>     <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>       <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;test_exchange_ttl&quot;</span><span class="p">,</span><span class="s">&quot;ttl.hehe&quot;</span><span class="p">,</span><span class="s">&quot;message ttl&quot;</span><span class="p">);</span>     <span class="p">}}</span>
</code></pre></div>
<p>查看控制台，发现有10条消息</p>
<p><img alt="1588064955505" src="../imgs/1588064955505.png" /></p>
<h5 id="7322">7.3.2.2 消息过期<a class="headerlink" href="#7322" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="cm">/**     * TTL:过期时间     *  1. 队列统一过期     *     *  2. 消息单独过期     *     *     * 如果设置了消息的过期时间，也设置了队列的过期时间，它以时间短的为准。     *     */</span>    <span class="nd">@Test</span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testTtl</span><span class="p">()</span> <span class="p">{</span>      <span class="cm">/*  for (int i = 0; i &lt; 10; i++) {            // 发送消息            rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;, &quot;ttl.hehe&quot;, &quot;message ttl....&quot;);        }*/</span>        <span class="c1">// 消息后处理对象，设置一些消息的参数信息        MessagePostProcessor messagePostProcessor = new MessagePostProcessor() {            @Override            public Message postProcessMessage(Message message) throws AmqpException {                //1.设置message的信息                // 第二个方法：消息的过期时间 ，5秒之后过期                message.getMessageProperties().setExpiration(&quot;5000&quot;);                //2.返回该消息                return message;            }        };        //消息单独过期        rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;, &quot;ttl.hehe&quot;, &quot;message ttl....&quot;,messagePostProcessor);    }</span>
</code></pre></div>
<p>运行程序，查看后台管理系统</p>
<p><img alt="1588067998423" src="../imgs/1588067998423.png" /></p>
<h3 id="74">7.4 死信队列<a class="headerlink" href="#74" title="Permanent link">&para;</a></h3>
<p>死信队列，英文缩写：DLX 。DeadLetter Exchange（死信交换机），当消息成为Dead message后，可以被重新发送到另一个交换机，这个交换机就是DLX。</p>
<p><strong>什么是死信队列</strong></p>
<p>先从概念解释上搞清楚这个定义，死信，顾名思义就是无法被消费的消息，字面意思可以这样理解，一般来说，producer将消息投递到broker或者直接到queue里了，consumer从queue取出消息进行消费，但某些时候由于特定的原因导致queue中的某些消息无法被消费，这样的消息如果没有后续的处理，就变成了死信，有死信，自然就有了死信队列；</p>
<p><img alt="1588068368686" src="../imgs/1588068368686.png" /></p>
<p><strong>消息成为死信的三种情况：</strong></p>
<ol>
<li>
<p>队列消息长度到达限制；比如给队列最大只能存储10条消息，当第11条消息进来的时候存不下了，第11条消息就被称为死信</p>
</li>
<li>
<p>消费者拒接消费消息，basicNack/basicReject,并且不把消息重新放入原目标队列,requeue=false；</p>
</li>
<li>
<p>原队列存在消息过期设置，消息到达超时时间未被消费；</p>
</li>
</ol>
<p><strong>死信的处理方式</strong></p>
<p>死信的产生既然不可避免，那么就需要从实际的业务角度和场景出发，对这些死信进行后续的处理，常见的处理方式大致有下面几种，</p>
<p>① 丢弃，如果不是很重要，可以选择丢弃</p>
<p>② 记录死信入库，然后做后续的业务分析或处理</p>
<p>③ 通过死信队列，由负责监听死信的应用程序进行处理</p>
<p>综合来看，更常用的做法是第三种，即通过死信队列，将产生的死信通过程序的配置路由到指定的死信队列，然后应用监听死信队列，对接收到的死信做后续的处理，</p>
<p><strong>队列绑定死信交换机：</strong></p>
<p>给队列设置参数： x-dead-letter-exchange 和 x-dead-letter-routing-key</p>
<p><img alt="1588068792963" src="../imgs/1588068792963.png" /></p>
<h4 id="741">7.4.1 过期时间代码实现<a class="headerlink" href="#741" title="Permanent link">&para;</a></h4>
<p>修改生产者项目的配置文件 <code>spring-rabbitmq-producer.xml</code>   ，增加如下代码</p>
<p><img alt="1588146552830" src="../imgs/1588146552830.png" /></p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--</span>
<span class="cm">       死信队列：</span>
<span class="cm">           1. 声明正常的队列(test_queue_dlx)和交换机(test_exchange_dlx)</span>
<span class="cm">           2. 声明死信队列(queue_dlx)和死信交换机(exchange_dlx)</span>
<span class="cm">           3. 正常队列绑定死信交换机</span>
<span class="cm">               设置两个参数：</span>
<span class="cm">                   * x-dead-letter-exchange：死信交换机名称</span>
<span class="cm">                   * x-dead-letter-routing-key：发送给死信交换机的routingkey</span>
<span class="cm">   --&gt;</span>

    <span class="cm">&lt;!--</span>
<span class="cm">        1. 声明正常的队列(test_queue_dlx)和交换机(test_exchange_dlx)</span>
<span class="cm">    --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">&quot;test_queue_dlx&quot;</span> <span class="na">id=</span><span class="s">&quot;test_queue_dlx&quot;</span><span class="nt">&gt;</span>
        <span class="cm">&lt;!--3. 正常队列绑定死信交换机--&gt;</span>
        <span class="nt">&lt;rabbit:queue-arguments&gt;</span>
            <span class="cm">&lt;!--3.1 x-dead-letter-exchange：死信交换机名称--&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;x-dead-letter-exchange&quot;</span> <span class="na">value=</span><span class="s">&quot;exchange_dlx&quot;</span><span class="nt">/&gt;</span>
            <span class="cm">&lt;!--3.2 x-dead-letter-routing-key：发送给死信交换机的routingkey--&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;x-dead-letter-routing-key&quot;</span> <span class="na">value=</span><span class="s">&quot;dlx.hehe&quot;</span><span class="nt">&gt;&lt;/entry&gt;</span>
            <span class="cm">&lt;!--4.1 设置队列的过期时间 ttl--&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;x-message-ttl&quot;</span> <span class="na">value=</span><span class="s">&quot;10000&quot;</span> <span class="na">value-type=</span><span class="s">&quot;java.lang.Integer&quot;</span><span class="nt">/&gt;</span>
            <span class="cm">&lt;!--4.2 设置队列的长度限制 max-length --&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;x-max-length&quot;</span> <span class="na">value=</span><span class="s">&quot;10&quot;</span> <span class="na">value-type=</span><span class="s">&quot;java.lang.Integer&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/rabbit:queue-arguments&gt;</span>
    <span class="nt">&lt;/rabbit:queue&gt;</span>
    <span class="cm">&lt;!--正常交换机--&gt;</span>
    <span class="nt">&lt;rabbit:topic-exchange</span> <span class="na">name=</span><span class="s">&quot;test_exchange_dlx&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">pattern=</span><span class="s">&quot;test.dlx.#&quot;</span> <span class="na">queue=</span><span class="s">&quot;test_queue_dlx&quot;</span><span class="nt">&gt;</span>                         <span class="nt">&lt;/rabbit:binding&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:topic-exchange&gt;</span>
    <span class="cm">&lt;!--</span>
<span class="cm">       2. 声明死信队列(queue_dlx)和死信交换机(exchange_dlx)</span>
<span class="cm">   --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">&quot;queue_dlx&quot;</span> <span class="na">id=</span><span class="s">&quot;queue_dlx&quot;</span><span class="nt">&gt;&lt;/rabbit:queue&gt;</span>
    <span class="nt">&lt;rabbit:topic-exchange</span> <span class="na">name=</span><span class="s">&quot;exchange_dlx&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;rabbit:bindings&gt;</span>
            <span class="nt">&lt;rabbit:binding</span> <span class="na">pattern=</span><span class="s">&quot;dlx.#&quot;</span> <span class="na">queue=</span><span class="s">&quot;queue_dlx&quot;</span><span class="nt">&gt;&lt;/rabbit:binding&gt;</span>
        <span class="nt">&lt;/rabbit:bindings&gt;</span>
    <span class="nt">&lt;/rabbit:topic-exchange&gt;</span>
</code></pre></div>
<p>在测试类中，添加如下方法，进行测试</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">     * 发送测试死信消息：</span>
<span class="cm">     *  1. 过期时间</span>
<span class="cm">     *  2. 长度限制</span>
<span class="cm">     *  3. 消息拒收</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDlx</span><span class="p">(){</span>
        <span class="c1">//1. 测试过期时间，死信消息</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;test_exchange_dlx&quot;</span><span class="p">,</span><span class="s">&quot;test.dlx.haha&quot;</span><span class="p">,</span><span class="s">&quot;我是一条消息，我会死吗？&quot;</span><span class="p">);</span>


    <span class="p">}</span>
</code></pre></div>
<p>运行测试，查看管理台界面</p>
<p><img alt="1588145682204" src="../imgs/1588145682204.png" /></p>
<h4 id="742">7.4.2 长度限制代码实现<a class="headerlink" href="#742" title="Permanent link">&para;</a></h4>
<p>修改测试类，添加测试方法</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">     * 发送测试死信消息：</span>
<span class="cm">     *  1. 过期时间</span>
<span class="cm">     *  2. 长度限制</span>
<span class="cm">     *  3. 消息拒收</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDlx</span><span class="p">(){</span>
        <span class="c1">//1. 测试过期时间，死信消息</span>
        <span class="c1">//rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.haha&quot;,&quot;我是一条消息，我会死吗？&quot;);</span>

        <span class="c1">//2. 测试长度限制后，消息死信</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="s">&quot;test_exchange_dlx&quot;</span><span class="p">,</span><span class="s">&quot;test.dlx.haha&quot;</span><span class="p">,</span><span class="s">&quot;我是一条消息，我会死吗？&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>运行测试方法，进行测试</p>
<p><img alt="1588148074723" src="../imgs/1588148074723.png" /></p>
<h4 id="743">7.4.3 测试消息拒收<a class="headerlink" href="#743" title="Permanent link">&para;</a></h4>
<p>在消费者工程 创建 <code>com.atguigu.listener.DlxListener</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.listener</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>


<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DlxListener</span> <span class="kd">implements</span> <span class="n">ChannelAwareMessageListener</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">,</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">deliveryTag</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getDeliveryTag</span><span class="p">();</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">//1.接收转换消息</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">()));</span>

            <span class="c1">//2. 处理业务逻辑</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;处理业务逻辑...&quot;</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">0</span><span class="p">;</span><span class="c1">//出现错误</span>
            <span class="c1">//3. 手动签收</span>
            <span class="n">channel</span><span class="p">.</span><span class="na">basicAck</span><span class="p">(</span><span class="n">deliveryTag</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//e.printStackTrace();</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;出现异常，拒绝接受&quot;</span><span class="p">);</span>
            <span class="c1">//4.拒绝签收，不重回队列 requeue=false</span>
            <span class="n">channel</span><span class="p">.</span><span class="na">basicNack</span><span class="p">(</span><span class="n">deliveryTag</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>修改消费者配置文件 <code>spring-rabbitmq-consumer.xml</code></p>
<p><img alt="1588162622798" src="../imgs/1588162622798.png" /></p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;rabbit:listener-container</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">acknowledge=</span><span class="s">&quot;manual&quot;</span><span class="nt">&gt;</span>        <span class="cm">&lt;!--&lt;rabbit:listener ref=&quot;ackListener&quot; queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;</span>        <span class="cm">&lt;!--&lt;rabbit:listener ref=&quot;qosListener&quot; queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;</span>        <span class="cm">&lt;!--定义监听器，监听正常队列--&gt;</span>        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;dlxListener&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;test_queue_dlx&quot;</span><span class="nt">&gt;&lt;/rabbit:listener&gt;</span>    <span class="nt">&lt;/rabbit:listener-container&gt;</span>
</code></pre></div>
<p>运行消费者测试类</p>
<p>修改生产者测试代码</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**     * 发送测试死信消息：     *  1. 过期时间     *  2. 长度限制     *  3. 消息拒收     */</span>    <span class="nd">@Test</span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDlx</span><span class="p">(){</span>        <span class="c1">//1. 测试过期时间，死信消息        //rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.haha&quot;,&quot;我是一条消息，我会死吗？&quot;);        //2. 测试长度限制后，消息死信//        for (int i = 0; i &lt; 20; i++) {//            rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.haha&quot;,&quot;我是一条消息，我会死吗？&quot;);//        }        //3. 测试消息拒收        rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,                                     &quot;test.dlx.haha&quot;,                                         &quot;我是一条消息，我会死吗？&quot;);    }</span>
</code></pre></div>
<p>发送消息，运行程序，查看后台管理界面</p>
<p><strong>死信队列小结</strong></p>
<ol>
<li>
<p>死信交换机和死信队列和普通的没有区别</p>
</li>
<li>
<p>当消息成为死信后，如果该队列绑定了死信交换机，则消息会被死信交换机重新路由到死信队列</p>
</li>
<li>
<p>消息成为死信的三种情况：</p>
</li>
<li>
<p>队列消息长度到达限制；</p>
</li>
<li>
<p>消费者拒接消费消息，并且不重回队列；</p>
</li>
<li>
<p>原队列存在消息过期设置，消息到达超时时间未被消费；</p>
</li>
</ol>
<h3 id="75">7.5 延迟队列<a class="headerlink" href="#75" title="Permanent link">&para;</a></h3>
<p>延迟队列存储的对象肯定是对应的延时消息，所谓”延时消息”是指当消息被发送以后，并不想让消费者立即拿到消息，而是等待指定时间后，消费者才拿到这个消息进行消费。</p>
<p>场景一：在订单系统中，一个用户下单之后通常有30分钟的时间进行支付，如果30分钟之内没有支付成功，那么这个订单将进行一场处理。这是就可以使用延时队列将订单信息发送到延时队列。</p>
<p>场景二：用户希望通过手机远程遥控家里的智能设备在指定的时间进行工作。这时候就可以将用户指令发送到延时队列，当指令设定的时间到了再将指令推送到只能设备。</p>
<p>需求：</p>
<ol>
<li>
<p>下单后，30分钟未支付，取消订单，回滚库存。</p>
</li>
<li>
<p>新用户注册成功30分钟后，发送短信问候。</p>
</li>
</ol>
<p>实现方式：</p>
<ol>
<li>延迟队列</li>
</ol>
<p><img alt="1588215659687" src="../imgs/1588215659687.png" /></p>
<p>很可惜，在RabbitMQ中并未提供延迟队列功能。</p>
<p>但是可以使用：TTL+死信队列 组合实现延迟队列的效果。</p>
<p><img alt="1588215955886" src="../imgs/1588215955886.png" /></p>
<h4 id="751">7.5.1 代码实现<a class="headerlink" href="#751" title="Permanent link">&para;</a></h4>
<h5 id="7511">7.5.1.1 生产者<a class="headerlink" href="#7511" title="Permanent link">&para;</a></h5>
<p>修改生产者代码 ，修改生产者配置文件 <code>spring-rabbitmq-producer.xml</code></p>
<p><img alt="1588237085518" src="../imgs/1588237085518.png" /></p>
<p>修改生产者，添加测试方法</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>    <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">testDelay</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>        <span class="c1">//1.发送订单消息。 将来是在订单系统中，下单成功后，发送消息        rabbitTemplate.convertAndSend(&quot;order_exchange&quot;,                &quot;order.msg&quot;,                &quot;订单信息：id=1,time=2020年4月30日16:41:47&quot;);        //2.打印倒计时10秒        for (int i = 10; i &gt; 0 ; i--) {            System.out.println(i+&quot;...&quot;);            Thread.sleep(1000);        }    }</span>
</code></pre></div>
<p>运行程序创建订单延时队列</p>
<h5 id="7512">7.5.1.2 消费者<a class="headerlink" href="#7512" title="Permanent link">&para;</a></h5>
<p>修改消费者项目，添加 <code>com.atguigu.listener.OrderListener</code></p>
<p>消费者</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.listener</span><span class="p">;</span><span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span><span class="nd">@Componentpublic</span> <span class="kd">class</span> <span class="nc">OrderListener</span> <span class="kd">implements</span> <span class="n">ChannelAwareMessageListener</span> <span class="p">{</span>    <span class="nd">@Override</span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">,</span> <span class="n">Channel</span> <span class="n">channel</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>        <span class="kt">long</span> <span class="n">deliveryTag</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="na">getMessageProperties</span><span class="p">().</span><span class="na">getDeliveryTag</span><span class="p">();</span>        <span class="k">try</span> <span class="p">{</span>            <span class="c1">//1.接收转换消息            System.out.println(new String(message.getBody()));            //2. 处理业务逻辑            System.out.println(&quot;处理业务逻辑...&quot;);            System.out.println(&quot;根据订单id查询其状态...&quot;);            System.out.println(&quot;判断状态是否为支付成功&quot;);            System.out.println(&quot;取消订单，回滚库存....&quot;);            //3. 手动签收            channel.basicAck(deliveryTag,true);        } catch (Exception e) {            //e.printStackTrace();            System.out.println(&quot;出现异常，拒绝接受&quot;);            //4.拒绝签收，不重回队列 requeue=false            channel.basicNack(deliveryTag,true,false);        }    }}</span>
</code></pre></div>
<p>修改消费者配置文件 <code>spring-rabbitmq-consumer.xml</code></p>
<p><img alt="1588237013690" src="../imgs/1588237013690.png" /></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xmlns:rabbit=</span><span class="s">&quot;http://www.springframework.org/schema/rabbit&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">       http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">       http://www.springframework.org/schema/context</span>
<span class="s">       https://www.springframework.org/schema/context/spring-context.xsd</span>
<span class="s">       http://www.springframework.org/schema/rabbit</span>
<span class="s">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="cm">&lt;!--加载配置文件--&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&quot;classpath:rabbitmq.properties&quot;</span><span class="nt">/&gt;</span>

    <span class="cm">&lt;!-- 定义rabbitmq connectionFactory --&gt;</span>
    <span class="nt">&lt;rabbit:connection-factory</span> <span class="na">id=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">host=</span><span class="s">&quot;${rabbitmq.host}&quot;</span>
                               <span class="na">port=</span><span class="s">&quot;${rabbitmq.port}&quot;</span>
                               <span class="na">username=</span><span class="s">&quot;${rabbitmq.username}&quot;</span>
                               <span class="na">password=</span><span class="s">&quot;${rabbitmq.password}&quot;</span>
                               <span class="na">virtual-host=</span><span class="s">&quot;${rabbitmq.virtual-host}&quot;</span><span class="nt">/&gt;</span>


    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.atguigu.listener&quot;</span> <span class="nt">/&gt;</span>

    <span class="cm">&lt;!--定义监听器容器</span>
<span class="cm">    acknowledge=&quot;manual&quot;:手动签收</span>
<span class="cm">    acknowledge=&quot;auto&quot; 自动签收</span>
<span class="cm">    --&gt;</span>
    <span class="nt">&lt;rabbit:listener-container</span> <span class="na">connection-factory=</span><span class="s">&quot;connectionFactory&quot;</span> <span class="na">acknowledge=</span><span class="s">&quot;manual&quot;</span><span class="nt">&gt;</span>

        <span class="cm">&lt;!--&lt;rabbit:listener ref=&quot;ackListener&quot; queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;</span>
        <span class="cm">&lt;!--&lt;rabbit:listener ref=&quot;qosListener&quot; queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;</span>
        <span class="cm">&lt;!--定义监听器，监听正常队列--&gt;</span>
        <span class="cm">&lt;!--&lt;rabbit:listener ref=&quot;dlxListener&quot; queue-names=&quot;test_queue_dlx&quot;&gt;&lt;/rabbit:listener&gt;--&gt;</span>
        <span class="cm">&lt;!--延迟队列效果实现：  一定要监听的是 死信队列！！！--&gt;</span>
        <span class="nt">&lt;rabbit:listener</span> <span class="na">ref=</span><span class="s">&quot;orderListener&quot;</span> <span class="na">queue-names=</span><span class="s">&quot;order_queue_dlx&quot;</span><span class="nt">&gt;&lt;/rabbit:listener&gt;</span>
    <span class="nt">&lt;/rabbit:listener-container&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<p>运行消费者测试类</p>
<h2 id="8-rabbitmq">8 RabbitMQ集成微服务<a class="headerlink" href="#8-rabbitmq" title="Permanent link">&para;</a></h2>
<h3 id="81-rabbitadmin">8.1 RabbitAdmin应用<a class="headerlink" href="#81-rabbitadmin" title="Permanent link">&para;</a></h3>
<p>RabbitAdmin的作用：
       ① 底层实现就是从Spring容器中获取Exchange，Bingding，Routingkey以及Queue的@bean声明
       ② 使用RabbitAdmin的execute方法执行对应的声明，修改和删除等一系列MQ的操作者
       比如：添加一个交换机，删除一个绑定， 清空一个队列里面的消息等等</p>
<p>① 新建项目 <code>rabbitmq-spring-rabbitadmin</code></p>
<p>② 添加pom文件</p>
<div class="highlight"><pre><span></span><code>  <span class="nt">&lt;parent&gt;</span>        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>        <span class="nt">&lt;version&gt;</span>2.1.6.RELEASE<span class="nt">&lt;/version&gt;</span>        <span class="nt">&lt;relativePath/&gt;</span> <span class="cm">&lt;!-- lookup parent from repository --&gt;</span>    <span class="nt">&lt;/parent&gt;</span>    <span class="nt">&lt;properties&gt;</span>        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>        <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>    <span class="nt">&lt;/properties&gt;</span>    <span class="nt">&lt;dependencies&gt;</span>        <span class="nt">&lt;dependency&gt;</span>            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>        <span class="nt">&lt;/dependency&gt;</span>        <span class="nt">&lt;dependency&gt;</span>            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>                  <span class="nt">&lt;/dependency&gt;</span>        <span class="nt">&lt;dependency&gt;</span>            <span class="nt">&lt;groupId&gt;</span>com.rabbitmq<span class="nt">&lt;/groupId&gt;</span>            <span class="nt">&lt;artifactId&gt;</span>amqp-client<span class="nt">&lt;/artifactId&gt;</span>                  <span class="nt">&lt;/dependency&gt;</span>        <span class="nt">&lt;dependency&gt;</span>            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-amqp<span class="nt">&lt;/artifactId&gt;</span>        <span class="nt">&lt;/dependency&gt;</span>    <span class="nt">&lt;/dependencies&gt;</span>    <span class="nt">&lt;build&gt;</span>        <span class="nt">&lt;plugins&gt;</span>            <span class="nt">&lt;plugin&gt;</span>                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>            <span class="nt">&lt;/plugin&gt;</span>        <span class="nt">&lt;/plugins&gt;</span>    <span class="nt">&lt;/build&gt;</span>
</code></pre></div>
<p>③ 添加程序入口类</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span><span class="cm">/** * Application * * @Author: 马伟奇 * @CreateTime: 2020-05-24 * @Description: */</span><span class="nd">@SpringBootApplicationpublic</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="p">{</span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>    <span class="p">}}</span>
</code></pre></div>
<p>④ 添加配置类</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.config</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AcknowledgeMode</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Binding</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.BindingBuilder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Queue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.TopicExchange</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.CachingConnectionFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.ConnectionFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitAdmin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.ConsumerTagStrategy</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.converter.ContentTypeDelegatingMessageConverter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.converter.Jackson2JsonMessageConverter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="p">({</span><span class="s">&quot;com.atguigu.*&quot;</span><span class="p">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RabbitMQConfig</span> <span class="p">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">ConnectionFactory</span> <span class="nf">connectionFactory</span><span class="p">(){</span>
        <span class="n">CachingConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CachingConnectionFactory</span><span class="p">();</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setAddresses</span><span class="p">(</span><span class="s">&quot;localhost:5672&quot;</span><span class="p">);</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">connectionFactory</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/**</span>
<span class="cm">     * RabbitAdmin:</span>
<span class="cm">       ① 底层实现就是从Spring容器中获取Exchange，Bingding，Routingkey以及Queue的@bean声明</span>
<span class="cm">       ② 使用RabbitAdmin的execute方法执行对应的声明，修改和删除等一系列MQ的操作者</span>
<span class="cm">       比如：添加一个交换机，删除一个绑定， 清空一个队列里面的消息等等</span>
<span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">RabbitAdmin</span> <span class="nf">rabbitAdmin</span><span class="p">(</span><span class="n">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">RabbitAdmin</span> <span class="n">rabbitAdmin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RabbitAdmin</span><span class="p">(</span><span class="n">connectionFactory</span><span class="p">);</span>
        <span class="c1">// 必须要设置为true，否则Spring容器不会加载RabbitAdmin类</span>
        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">setAutoStartup</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">rabbitAdmin</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>    
</code></pre></div>
<p>⑤ 在 test文件夹下面添加测试类</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.amqp.core.*</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitAdmin</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="p">;</span><span class="cm">/** * ApplicationTests * * @Author: 马伟奇 * @CreateTime: 2020-06-04 * @Description: */</span><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="nd">@SpringBootTestpublic</span> <span class="kd">class</span> <span class="nc">ApplicationTests</span> <span class="p">{</span>    <span class="nd">@Autowired</span>    <span class="kd">private</span> <span class="n">RabbitAdmin</span> <span class="n">rabbitAdmin</span><span class="p">;</span>    <span class="nd">@Test</span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAdmin</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>        <span class="cm">/**         * 声明交换机         * 声明一个定向交换机，通配符模式，广播模式         * 第一个参数：交换机的名字         * 第二个参数：是否需要进行持久化         * 第三个参数：是否需要自动删除         */</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareExchange</span><span class="p">(</span><span class="k">new</span> <span class="n">DirectExchange</span><span class="p">(</span><span class="s">&quot;test.direct&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">));</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareExchange</span><span class="p">(</span><span class="k">new</span> <span class="n">TopicExchange</span><span class="p">(</span><span class="s">&quot;test.topic&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">));</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareExchange</span><span class="p">(</span><span class="k">new</span> <span class="n">FanoutExchange</span><span class="p">(</span><span class="s">&quot;test.fanout&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">));</span>        <span class="cm">/**         * 声明队列         * 第一个参数：表示队列的名字         * 第二个参数：表示是否需要进行持久化         */</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareQueue</span><span class="p">(</span><span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;test.direct.queue&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">));</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareQueue</span><span class="p">(</span><span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;test.topic.queue&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">));</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareQueue</span><span class="p">(</span><span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;test.fanout.queue&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">));</span>        <span class="cm">/**         * 交换机和队列进行绑定         */</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareBinding</span><span class="p">(</span>                <span class="n">BindingBuilder</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;test.direct.queue&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">))</span>                        <span class="p">.</span><span class="na">to</span><span class="p">(</span><span class="k">new</span> <span class="n">DirectExchange</span><span class="p">(</span><span class="s">&quot;test.direct&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">,</span><span class="kc">false</span><span class="p">))</span>                        <span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;direct&quot;</span><span class="p">));</span>        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">declareBinding</span><span class="p">(</span>                <span class="c1">//直接创建队列                BindingBuilder.bind(new Queue(&quot;test.topic.queue&quot;,true))                //直接创建交换机 建立关联关系                        .to(new TopicExchange(&quot;test.topic&quot;,true,false))                //指定路由Key                        .with(&quot;user.#&quot;));        // 广播模式是没有路由key        rabbitAdmin.declareBinding(                BindingBuilder.bind(new Queue(&quot;test.topic.queue&quot;,true))                        .to(new FanoutExchange(&quot;test.topic&quot;,true,false))                        );        //清空队列数据        rabbitAdmin.purgeQueue(&quot;test.topic.queue&quot;, false);    }}</span>
</code></pre></div>
<p>运行程序测试，进入后台管理系统</p>
<h3 id="82-rabbitadmin">8.2 RabbitAdmin源码分析<a class="headerlink" href="#82-rabbitadmin" title="Permanent link">&para;</a></h3>
<p>① 注意：autoStartup必须要设置为true ，否则Spring 容器不会加载 RabbitAdmin 类</p>
<p>② RabbitAdmin 底层实现就是从Spring 容器中获取 Exchange ，bingding ，RoutingKey 以及 Queue的 @Bean声明</p>
<p>③ 然后使用RabbitTemplate 的 execute 方法执行对应的声明，修改，删除等一系列RabbitMQ基础功能操作</p>
<p>① 点击RabbitAdmin 实现初始化bean</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RabbitAdmin</span> <span class="kd">implements</span> <span class="n">InitializingBean</span><span class="p">{</span>

<span class="p">}</span>
</code></pre></div>
<p>② 进入InitializingBean 接口 ，在bean加载之后，可以加载一些设置</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">InitializingBean</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">afterPropertiesSet</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>③ 查看RabbitAdmin 里面的 afterPropertiesSet 源码，发现如果autoStartup 不设置为true，直接return</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterPropertiesSet</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">synchronized</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">lifecycleMonitor</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// autoStartup设置为true</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">running</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">autoStartup</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// 做一些配置</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">retryTemplate</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">retryDisabled</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="na">retryTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RetryTemplate</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="na">retryTemplate</span><span class="p">.</span><span class="na">setRetryPolicy</span><span class="p">(</span><span class="k">new</span> <span class="n">SimpleRetryPolicy</span><span class="p">(</span><span class="n">DECLARE_MAX_ATTEMPTS</span><span class="p">));</span>
                <span class="n">ExponentialBackOffPolicy</span> <span class="n">backOffPolicy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExponentialBackOffPolicy</span><span class="p">();</span>
                <span class="n">backOffPolicy</span><span class="p">.</span><span class="na">setInitialInterval</span><span class="p">(</span><span class="n">DECLARE_INITIAL_RETRY_INTERVAL</span><span class="p">);</span>
                <span class="n">backOffPolicy</span><span class="p">.</span><span class="na">setMultiplier</span><span class="p">(</span><span class="n">DECLARE_RETRY_MULTIPLIER</span><span class="p">);</span>
                <span class="n">backOffPolicy</span><span class="p">.</span><span class="na">setMaxInterval</span><span class="p">(</span><span class="n">DECLARE_MAX_RETRY_INTERVAL</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="na">retryTemplate</span><span class="p">.</span><span class="na">setBackOffPolicy</span><span class="p">(</span><span class="n">backOffPolicy</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="c1">// 添加监听器，最核心的方法是添加一个initialize方法</span>
        <span class="k">this</span><span class="p">.</span><span class="na">connectionFactory</span><span class="p">.</span><span class="na">addConnectionListener</span><span class="p">(</span><span class="n">connection</span> <span class="o">-&gt;</span> <span class="p">{</span>

                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">retryTemplate</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="na">retryTemplate</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">c</span> <span class="o">-&gt;</span> <span class="p">{</span>
                            <span class="c1">// 点击进源码</span>
                            <span class="n">initialize</span><span class="p">();</span>
                            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="n">initialize</span><span class="p">();</span>
                    <span class="p">}</span>
            <span class="p">});</span>
</code></pre></div>
<p>④ 点击 initialize() 源码</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span> <span class="c1">// NOSONAR complexitypublic void initialize() {    //  根据获取bean的类型，判断是交换机，队列和绑定    Collection&lt;Exchange&gt; contextExchanges = new LinkedList&lt;Exchange&gt;(              this.applicationContext.getBeansOfType(Exchange.class).values());       Collection&lt;Queue&gt; contextQueues = new LinkedList&lt;Queue&gt;(                this.applicationContext.getBeansOfType(Queue.class).values());      Collection&lt;Binding&gt; contextBindings = new LinkedList&lt;Binding&gt;(              this.applicationContext.getBeansOfType(Binding.class).values());        // 定义交换机，队列和绑定集合        final Collection&lt;Exchange&gt; exchanges = filterDeclarables(contextExchanges);     final Collection&lt;Queue&gt; queues = filterDeclarables(contextQueues);      final Collection&lt;Binding&gt; bindings = filterDeclarables(contextBindings);    // 执行rabbitmq    this.rabbitTemplate.execute(channel -&gt; {           declareExchanges(channel, exchanges.toArray(new Exchange[exchanges.size()]));           declareQueues(channel, queues.toArray(new Queue[queues.size()]));           declareBindings(channel, bindings.toArray(new Binding[bindings.size()]));           return null;        });}    </span>
</code></pre></div>
<h3 id="83-rabbitmq">8.3 RabbitMQ声明式配置使用<a class="headerlink" href="#83-rabbitmq" title="Permanent link">&para;</a></h3>
<p>在 <code>Rabbit</code> 基础 <code>API</code> 里面声明一个 <code>Exchange</code> ，声明一个绑定，一个队列</p>
<p><img alt="1590303087971" src="../imgs/1590303087971.png" /></p>
<p>使用 <code>SpringAMQP</code> 去声明，就需要使用<code>SpringAMQP</code> 的如下模式，即声明 <code>Bean</code> 方式</p>
<p><img alt="1590303160087" src="../imgs/1590303160087.png" /></p>
<p>在 RabbitMQConfig 类里面添加交换机，队列和绑定代码</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.config</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AcknowledgeMode</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Binding</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.BindingBuilder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Queue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.TopicExchange</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.CachingConnectionFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.ConnectionFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitAdmin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.ConsumerTagStrategy</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.converter.ContentTypeDelegatingMessageConverter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.converter.Jackson2JsonMessageConverter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="p">({</span><span class="s">&quot;com.atguigu.*&quot;</span><span class="p">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RabbitMQConfig</span> <span class="p">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">ConnectionFactory</span> <span class="nf">connectionFactory</span><span class="p">(){</span>
        <span class="n">CachingConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CachingConnectionFactory</span><span class="p">();</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setAddresses</span><span class="p">(</span><span class="s">&quot;localhost:5672&quot;</span><span class="p">);</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;guest&quot;</span><span class="p">);</span>
        <span class="n">connectionFactory</span><span class="p">.</span><span class="na">setVirtualHost</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">connectionFactory</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">RabbitAdmin</span> <span class="nf">rabbitAdmin</span><span class="p">(</span><span class="n">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">RabbitAdmin</span> <span class="n">rabbitAdmin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RabbitAdmin</span><span class="p">(</span><span class="n">connectionFactory</span><span class="p">);</span>
        <span class="c1">// 必须要设置为true，否则Spring容器不会加载RabbitAdmin类</span>
        <span class="n">rabbitAdmin</span><span class="p">.</span><span class="na">setAutoStartup</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">rabbitAdmin</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**  </span>
<span class="cm">     * 针对消费者配置  </span>
<span class="cm">     * 1. 设置交换机类型  </span>
<span class="cm">     * 2. 将队列绑定到交换机  </span>
<span class="cm">        FanoutExchange: 将消息分发到所有的绑定队列，无routingkey的概念  </span>
<span class="cm">        HeadersExchange ：通过添加属性key-value匹配  </span>
<span class="cm">        DirectExchange:按照routingkey分发到指定队列  </span>
<span class="cm">        TopicExchange:多关键字匹配  </span>
<span class="cm">     */</span>  
    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">TopicExchange</span> <span class="nf">exchange001</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">TopicExchange</span><span class="p">(</span><span class="s">&quot;topic001&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>  
    <span class="p">}</span>  

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue001</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;queue001&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">//队列持久  </span>
    <span class="p">}</span>  

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Binding</span> <span class="nf">binding001</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="n">BindingBuilder</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="n">queue001</span><span class="p">()).</span><span class="na">to</span><span class="p">(</span><span class="n">exchange001</span><span class="p">()).</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;spring.*&quot;</span><span class="p">);</span>  
    <span class="p">}</span>  

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">TopicExchange</span> <span class="nf">exchange002</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">TopicExchange</span><span class="p">(</span><span class="s">&quot;topic002&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>  
    <span class="p">}</span>  

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue002</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;queue002&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">//队列持久  </span>
    <span class="p">}</span>

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Binding</span> <span class="nf">binding002</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="n">BindingBuilder</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="n">queue002</span><span class="p">()).</span><span class="na">to</span><span class="p">(</span><span class="n">exchange002</span><span class="p">()).</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;rabbit.*&quot;</span><span class="p">);</span>  
    <span class="p">}</span> 

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue003</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;queue003&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">//队列持久  </span>
    <span class="p">}</span>

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Binding</span> <span class="nf">binding003</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="n">BindingBuilder</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="n">queue003</span><span class="p">()).</span><span class="na">to</span><span class="p">(</span><span class="n">exchange001</span><span class="p">()).</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;mq.*&quot;</span><span class="p">);</span>  
    <span class="p">}</span> 

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue_image</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;image_queue&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">//队列持久  </span>
    <span class="p">}</span>

    <span class="nd">@Bean</span>  
    <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue_pdf</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">(</span><span class="s">&quot;pdf_queue&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">//队列持久  </span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>运行程序，查看后台系统</p>
<h3 id="84-rabbitmqspringboot">8.4 RabbitMQ与SpringBoot整合<a class="headerlink" href="#84-rabbitmqspringboot" title="Permanent link">&para;</a></h3>
<h4 id="841">8.4.1 搭建生产者工程<a class="headerlink" href="#841" title="Permanent link">&para;</a></h4>
<p>实现步骤：</p>
<ol>
<li>创建生产者SpringBoot工程</li>
<li>引入依赖坐标</li>
<li>编写yml配置，基本信息配置</li>
<li>定义交换机，队列以及绑定关系的配置类</li>
<li>注入RabbitTemplate，调用方法，完成消息发送</li>
</ol>
<h5 id="8411">8.4.1.1 创建工程<a class="headerlink" href="#8411" title="Permanent link">&para;</a></h5>
<p>项目名字 ：<code>producer-springboot</code></p>
<p><img alt="1590311830019" src="../imgs/1590311830019.png" /></p>
<h5 id="8412">8.4.1.2 添加依赖<a class="headerlink" href="#8412" title="Permanent link">&para;</a></h5>
<p>修改pom.xml文件内容为如下：</p>
<div class="highlight"><pre><span></span><code>  <span class="cm">&lt;!--</span>
<span class="cm">        1. 父工程依赖</span>
<span class="cm">    --&gt;</span>
<span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.1.6.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/parent&gt;</span>

<span class="nt">&lt;dependencies&gt;</span>
    <span class="cm">&lt;!--2. rabbitmq--&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-amqp<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
<h5 id="8413">8.4.1.3 配置整合<a class="headerlink" href="#8413" title="Permanent link">&para;</a></h5>
<ol>
<li>创建<code>application.yml</code>连接参数等配置文件；</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c"># 配置RabbitMQ的基本信息  ip 端口 username  password..</span><span class="w"></span>
<span class="na">spring</span><span class="o">:</span><span class="w"></span>
<span class="na">  rabbitmq</span><span class="o">:</span><span class="w"></span>
<span class="na">    host</span><span class="o">:</span><span class="w"> </span><span class="s">localhost # ip</span><span class="w"></span>
<span class="na">    port</span><span class="o">:</span><span class="w"> </span><span class="s">5672</span><span class="w"></span>
<span class="na">    username</span><span class="o">:</span><span class="w"> </span><span class="s">guest</span><span class="w"></span>
<span class="na">    password</span><span class="o">:</span><span class="w"> </span><span class="s">guest</span><span class="w"></span>
<span class="na">    virtual-host</span><span class="o">:</span><span class="w"> </span><span class="s">/</span><span class="w"></span>
</code></pre></div>
<h5 id="8414">8.4.1.4 创建配置类<a class="headerlink" href="#8414" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.config</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * RabbitMQConfig</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RabbitMQConfig</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&quot;boot_topic_exchange&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s">&quot;boot_queue&quot;</span><span class="p">;</span>

    <span class="c1">// 1 交换机</span>
    <span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;bootExchange&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">Exchange</span> <span class="nf">bootExchange</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">ExchangeBuilder</span><span class="p">.</span><span class="na">topicExchange</span><span class="p">(</span><span class="n">EXCHANGE_NAME</span><span class="p">).</span><span class="na">durable</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">//2.Queue 队列</span>
    <span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;bootQueue&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">bootQueue</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">QueueBuilder</span><span class="p">.</span><span class="na">durable</span><span class="p">(</span><span class="n">QUEUE_NAME</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">//3. 队列和交互机绑定关系 Binding</span>
    <span class="cm">/*</span>
<span class="cm">        1. 知道哪个队列</span>
<span class="cm">        2. 知道哪个交换机</span>
<span class="cm">        3. routing key</span>
<span class="cm">        noargs():表示不指定参数</span>
<span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Binding</span> <span class="nf">bindQueueExchange</span><span class="p">(</span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;bootQueue&quot;</span><span class="p">)</span><span class="n">Queue</span> <span class="n">queue</span><span class="p">,</span>
                                     <span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;bootExchange&quot;</span><span class="p">)</span> <span class="n">Exchange</span> <span class="n">exchange</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">BindingBuilder</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="n">queue</span><span class="p">).</span><span class="na">to</span><span class="p">(</span><span class="n">exchange</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;boot.#&quot;</span><span class="p">).</span><span class="na">noargs</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="8415">8.4.1.5 创建入口类<a class="headerlink" href="#8415" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * ProducerApplication</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerApplication</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">ProducerApplication</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="8416">8.4.1.6 发送消息<a class="headerlink" href="#8416" title="Permanent link">&para;</a></h5>
<p>创建测试文件 <code>com.atguigu.ProducerTest.java</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.atguigu.config.RabbitMQConfig</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.core.RabbitTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * ProducerTest</span>
<span class="cm"> *</span>
<span class="cm"> * @Author: 马伟奇</span>
<span class="cm"> * @Description:</span>
<span class="cm"> */</span>
<span class="nd">@SpringBootTest</span>
<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerTest</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RabbitTemplate</span> <span class="n">rabbitTemplate</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * 第一个参数：交换机名字</span>
<span class="cm">     * 第二个参数：routingKey</span>
<span class="cm">     * 第三个参数：发送的消息</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSend</span><span class="p">(){</span>
        <span class="n">rabbitTemplate</span><span class="p">.</span><span class="na">convertAndSend</span><span class="p">(</span><span class="n">RabbitMQConfig</span><span class="p">.</span><span class="na">EXCHANGE_NAME</span><span class="p">,</span><span class="s">&quot;boot.haha&quot;</span><span class="p">,</span><span class="s">&quot;mq hello&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>运行测试类，发送消息</p>
<p><img alt="1590311872903" src="../imgs/1590311872903.png" /></p>
<h4 id="842">8.4.2 搭建消费者工程<a class="headerlink" href="#842" title="Permanent link">&para;</a></h4>
<p>实现步骤</p>
<ol>
<li>创建消费者SpringBoot工程</li>
<li>引入start，依赖坐标</li>
<li>编写yml配置，基本信息配置</li>
<li>定义监听类，使用@RabbitListener注解完成队列监听。</li>
</ol>
<h5 id="8421">8.4.2.1 创建工程<a class="headerlink" href="#8421" title="Permanent link">&para;</a></h5>
<p>创建项目 <code>consumber-springboot</code></p>
<p><img alt="1590311938809" src="../imgs/1590311938809.png" /></p>
<h5 id="8422">8.4.2.2 添加依赖<a class="headerlink" href="#8422" title="Permanent link">&para;</a></h5>
<p>修改pom.xml文件内容为如下：</p>
<div class="highlight"><pre><span></span><code>  <span class="nt">&lt;parent&gt;</span>        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>        <span class="nt">&lt;version&gt;</span>2.1.6.RELEASE<span class="nt">&lt;/version&gt;</span>    <span class="nt">&lt;/parent&gt;</span>    <span class="nt">&lt;dependencies&gt;</span>        <span class="cm">&lt;!--RabbitMQ 启动依赖--&gt;</span>        <span class="nt">&lt;dependency&gt;</span>            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-amqp<span class="nt">&lt;/artifactId&gt;</span>        <span class="nt">&lt;/dependency&gt;</span>    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
<h5 id="8423">8.4.2.3 配置整合<a class="headerlink" href="#8423" title="Permanent link">&para;</a></h5>
<ol>
<li>创建<code>application.yml</code>连接参数等配置文件；</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="na">spring</span><span class="o">:</span><span class="w">  </span><span class="s">rabbitmq:    host: localhost #主机ip    port: 5672 #端口    username: guest    password: guest    virtual-host: /</span><span class="w"></span>
</code></pre></div>
<h5 id="8424">8.4.2.4 消息监听器<a class="headerlink" href="#8424" title="Permanent link">&para;</a></h5>
<p>队列监听器</p>
<p>创建 <code>com.atguigu.listener.RabbimtMQListener</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu.listener</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Message</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.annotation.RabbitListener</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span><span class="cm">/** * RabbimtMQListener * * @Author: 马伟奇 * @CreateTime: 2020-04-16 * @Description: */</span><span class="nd">@Componentpublic</span> <span class="kd">class</span> <span class="nc">RabbimtMQListener</span> <span class="p">{</span>    <span class="nd">@RabbitListener</span><span class="p">(</span><span class="n">queues</span> <span class="o">=</span> <span class="s">&quot;boot_queue&quot;</span><span class="p">)</span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">listenerQueue</span><span class="p">(</span><span class="n">Message</span> <span class="n">message</span><span class="p">){</span>        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getBody</span><span class="p">()));</span>    <span class="p">}}</span>
</code></pre></div>
<p>创建入口类</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.atguigu</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span><span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span><span class="nd">@SpringBootApplicationpublic</span> <span class="kd">class</span> <span class="nc">ConsumerSpringbootApplication</span> <span class="p">{</span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">ConsumerSpringbootApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>    <span class="p">}}</span>
</code></pre></div>
<p>运行applicaion：</p>
<p><img alt="1590311986839" src="../imgs/1590311986839.png" /></p>
<p>小结：</p>
<p>SpringBoot提供了快速整合RabbitMQ的方式</p>
<p>基本信息再yml中配置，队列交互机以及绑定关系在配置类中使用Bean的方式配置</p>
<p>生产端直接注入RabbitTemplate完成消息发送</p>
<p>消费端直接使用@RabbitListener完成消息接收</p>
<h2 id="9">9 消息百分百成功投递<a class="headerlink" href="#9" title="Permanent link">&para;</a></h2>
<p>参考资料代码</p>
<p>谈到消息的可靠性投递，无法避免的，在实际的工作中会经常碰到，比如一些核心业务需要保障消息不丢失，接下来我们看一个可靠性投递的流程图，说明可靠性投递的概念：</p>
<p><img alt="1590312233269" src="../imgs/1590312233269.png" /></p>
<p>Step 1： 首先把消息信息(业务数据）存储到数据库中，紧接着，我们再把这个消息记录也存储到一张消息记录表里（或者另外一个同源数据库的消息记录表）</p>
<p>Step 2：发送消息到MQ Broker节点（采用confirm方式发送，会有异步的返回结果）</p>
<p>Step 3、4：生产者端接受MQ Broker节点返回的Confirm确认消息结果，然后进行更新消息记录表里的消息状态。比如默认Status = 0 当收到消息确认成功后，更新为1即可！</p>
<p>Step 5：但是在消息确认这个过程中可能由于网络闪断、MQ Broker端异常等原因导致 回送消息失败或者异常。这个时候就需要发送方（生产者）对消息进行可靠性投递了，保障消息不丢失，100%的投递成功！（有一种极限情况是闪断，Broker返回的成功确认消息，但是生产端由于网络闪断没收到，这个时候重新投递可能会造成消息重复，需要消费端去做幂等处理）所以我们需要有一个定时任务，（比如每5分钟拉取一下处于中间状态的消息，当然这个消息可以设置一个超时时间，比如超过1分钟 Status = 0 ，也就说明了1分钟这个时间窗口内，我们的消息没有被确认，那么会被定时任务拉取出来）</p>
<p>Step 6：接下来我们把中间状态的消息进行重新投递 retry send，继续发送消息到MQ ，当然也可能有多种原因导致发送失败</p>
<p>Step 7：我们可以采用设置最大努力尝试次数，比如投递了3次，还是失败，那么我们可以将最终状态设置为Status = 2 ，最后 交由人工解决处理此类问题（或者把消息转储到失败表中）。</p>
<h3 id="91">9.1 数据库文件<a class="headerlink" href="#91" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- ------------------------------ Table structure for broker_message_log-- ----------------------------DROP TABLE IF EXISTS `broker_message_log`;CREATE TABLE `broker_message_log` (  `message_id` varchar(255) NOT NULL COMMENT &#39;消息唯一ID&#39;,  `message` varchar(4000) NOT NULL COMMENT &#39;消息内容&#39;,  `try_count` int(4) DEFAULT &#39;0&#39; COMMENT &#39;重试次数&#39;,  `status` varchar(10) DEFAULT &#39;&#39; COMMENT &#39;消息投递状态 0投递中，1投递成功，2投递失败&#39;,  `next_retry` timestamp NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39; ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;下一次重试时间&#39;,  `create_time` timestamp NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39; ON UPDATE CURRENT_TIMESTAMP,  `update_time` timestamp NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39; ON UPDATE CURRENT_TIMESTAMP,  PRIMARY KEY (`message_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;-- ------------------------------ Table structure for t_order-- ----------------------------DROP TABLE IF EXISTS `t_order`;CREATE TABLE `t_order` (  `id` int(11) NOT NULL AUTO_INCREMENT,  `name` varchar(255) DEFAULT NULL,  `message_id` varchar(255) DEFAULT NULL,  PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=2018091102 DEFAULT CHARSET=utf8;</span><span class="w"></span>
</code></pre></div>
<h2 id="10">10 <strong>消息幂等性保障</strong><a class="headerlink" href="#10" title="Permanent link">&para;</a></h2>
<p>幂等性指一次和多次请求某一个资源，对于资源本身应该具有同样的结果。也就是说，其任意多次执行对资源本身所产生的影响均与一次执行的影响相同。</p>
<p><img alt="1591279269020" src="../imgs/1591279269020.png" /></p>
<p>在MQ中指，消费多条相同的消息，得到与消费该消息一次相同的结果。</p>
<p><strong>消息幂等性保障 乐观锁机制</strong></p>
<p>生产者发送消息：</p>
<div class="highlight"><pre><span></span><code><span class="na">id</span><span class="o">=</span><span class="s">1,money=500,version=1</span><span class="w"></span>
</code></pre></div>
<p>消费者接收消息</p>
<div class="highlight"><pre><span></span><code><span class="na">id</span><span class="o">=</span><span class="s">1,money=500,version=1id=1,money=500,version=1</span><span class="w"></span>
</code></pre></div>
<p>消费者需要保证幂等性：第一次执行SQL语句</p>
<div class="highlight"><pre><span></span><code><span class="na">第一次执行：version</span><span class="o">=</span><span class="s">1update account set money = money - 500 , version = version + 1where id = 1 and version = 1</span><span class="w"></span>
</code></pre></div>
<p>消费者需要保证幂等性：第一次执行SQL语句</p>
<div class="highlight"><pre><span></span><code><span class="na">第二次执行：version</span><span class="o">=</span><span class="s">2update account set money = money - 500 , version = version + 1where id = 1 and version = 1</span><span class="w"></span>
</code></pre></div>
<h2 id="11-mq">11 MQ高级集群操作<a class="headerlink" href="#11-mq" title="Permanent link">&para;</a></h2>
<h3 id="linuxmq">安装Linux版本MQ<a class="headerlink" href="#linuxmq" title="Permanent link">&para;</a></h3>
<p>参考linux安装讲义</p>
<h3 id="_6">日志<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>RabbitMQ默认日志存放路径： <code>/var/log/rabbitmq/rabbit@xxx.log</code></p>
<p>查看日志信息</p>
<p><img alt="1600570546569" src="../imgs/1600570546569.png" /></p>
<p>日志包含了RabbitMQ的版本号、Erlang的版本号、RabbitMQ服务节点名称、cookie的hash值、RabbitMQ配置文件地址、内存限制、磁盘限制、默认账户guest的创建以及权限配置等等。</p>
<p>rabbitmqctl管理和监控</p>
<div class="highlight"><pre><span></span><code><span class="err">查看队列#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_queues查看exchanges#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_exchanges查看用户#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_users查看连接#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_connections查看消费者信息#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_consumers查看环境变量#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">environment查看未被确认的队列#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_queues</span><span class="w">  </span><span class="err">name</span><span class="w"> </span><span class="err">messages_unacknowledged查看单个队列的内存使用#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_queues</span><span class="w"> </span><span class="err">name</span><span class="w"> </span><span class="err">memory查看准备就绪的队列#</span><span class="w"> </span><span class="err">rabbitmqctl</span><span class="w"> </span><span class="err">list_queues</span><span class="w"> </span><span class="err">name</span><span class="w"> </span><span class="err">messages_ready</span><span class="w"></span>
</code></pre></div>
<p>例如：</p>
<p><img alt="1600571209285" src="../imgs/1600571209285.png" /></p>
<h3 id="_7">集群和负载均衡操作<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>参考集群讲义</p>

              
			  <hr><span id="busuanzi_container_page_pv"><font size="3" color="grey">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</font></span><br/>
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../ElasticSearch/ElasticSearch/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ElasticSearch" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ElasticSearch
            </div>
          </div>
        </a>
      
      
        
        <a href="../../SpringBoot/SpringBoot/" class="md-footer__link md-footer__link--next" aria-label="Next: SpringBoot" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              SpringBoot
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 尚硅谷
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>