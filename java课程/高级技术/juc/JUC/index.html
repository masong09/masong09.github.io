
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>JUC - 我的文档</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#juc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="我的文档" class="md-header__button md-logo" aria-label="我的文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            我的文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JUC
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/01%20Java%E6%A6%82%E8%BF%B0/01%20-%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/" class="md-tabs__link md-tabs__link--active">
        Java课程
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC1%E7%AB%A0%20%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/" class="md-tabs__link">
        Java就业面试
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      学习文档
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="我的文档" class="md-nav__button md-logo" aria-label="我的文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    我的文档
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Java课程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java课程" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Java课程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Java基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java基础" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Java基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_1" type="checkbox" id="__nav_1_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1_1">
          基础部分
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="基础部分" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_1">
          <span class="md-nav__icon md-icon"></span>
          基础部分
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/01%20Java%E6%A6%82%E8%BF%B0/01%20-%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        Java概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/02%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/02%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        基本语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/03%20%E6%95%B0%E7%BB%84/03%20%E6%95%B0%E7%BB%84/" class="md-nav__link">
        数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/04%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/04%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        面向对象
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/05%20%E5%BC%82%E5%B8%B8/05%20%E5%BC%82%E5%B8%B8/" class="md-nav__link">
        异常
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_2" type="checkbox" id="__nav_1_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1_2">
          高级部分
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="高级部分" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          高级部分
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/06%20%E5%B8%B8%E7%94%A8%E7%B1%BBAPI/06%20%E5%B8%B8%E7%94%A8%E7%B1%BBAPI/" class="md-nav__link">
        常用类API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/07%20%E9%9B%86%E5%90%88/07%20%E9%9B%86%E5%90%88/" class="md-nav__link">
        集合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/08%20%E6%B3%9B%E5%9E%8B/08%20%E6%B3%9B%E5%9E%8B/" class="md-nav__link">
        泛型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/09%20File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/09%20File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" class="md-nav__link">
        File类与IO流
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/10%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/10%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        网络编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/11%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/11%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/12%20%E5%8F%8D%E5%B0%84/12%20%E5%8F%8D%E5%B0%84/" class="md-nav__link">
        反射
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/13%20Java8%E6%96%B0%E7%89%B9%E6%80%A7/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" class="md-nav__link">
        Java8新特性
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          MySQL数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MySQL数据库" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          MySQL数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/MySQL5.7%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3/" class="md-nav__link">
        MySQL5.7安装文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/MySQL%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        MySQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/JDBC%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        JDBC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          JavaWeb阶段
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="JavaWeb阶段" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          JavaWeb阶段
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day01/day01_HTML%26CSS/" class="md-nav__link">
        HTML&CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day02/day02_JS%26%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="md-nav__link">
        JS&正则表达式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day03/day03_VUE%26%E4%B9%A6%E5%9F%8E%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        VUE&书城第一阶段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day04/day04_XML%26Tomcat%26Http%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        XML&Tomcat&Http协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day05/day05_Servlet/" class="md-nav__link">
        Servlet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day06/day06_Request%26Response/" class="md-nav__link">
        Request&Response
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day07/day07_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第二阶
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day08/day08_Thymeleaf/" class="md-nav__link">
        Thymeleaf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day09/day09_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第三阶段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day10/day10_%E4%BC%9A%E8%AF%9D%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%281%29/" class="md-nav__link">
        会话&书城项目第四阶段1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day11/day11_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第四阶段2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day12/day12_Filter%26Listener%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        Filter&Listener&书城项目第五阶段1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day13/day13_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第五阶段2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../JavaWeb%E9%98%B6%E6%AE%B5/day14/day14_Ajax%26Axios%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%85%AD%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        Ajax&Axios&书城项目第六阶段
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          经典框架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="经典框架" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          经典框架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Spring%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Spring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/SpringMVC%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        SpringMVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/MyBatis%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        MyBatis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/SSM%20%E6%95%B4%E5%90%88%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        SSM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Maven%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Maven
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/%E6%A1%86%E6%9E%B6%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%B3%BB%E5%88%97%E4%B9%8BLinuxCentOS7/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Redis/" class="md-nav__link">
        Redis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" type="checkbox" id="__nav_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_5">
          微服务相关
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="微服务相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          微服务相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/Docker/Docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/ElasticSearch/ElasticSearch/" class="md-nav__link">
        ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/RabbitMQ/RabbitMQ/" class="md-nav__link">
        RabbitMQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/SpringBoot/SpringBoot/" class="md-nav__link">
        SpringBoot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/SpringCloud/SpringCloud/" class="md-nav__link">
        SpringCloud
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6">
          高级技术
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="高级技术" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          高级技术
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../git/Git%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        git
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          JUC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        JUC
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1juc" class="md-nav__link">
    第1章JUC概述及回顾
  </a>
  
    <nav class="md-nav" aria-label="第1章JUC概述及回顾">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-juc" class="md-nav__link">
    1.1 JUC是什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 进程和线程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-waitsleep" class="md-nav__link">
    1.4 wait/sleep的区别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    1.5 创建线程回顾
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-lambda" class="md-nav__link">
    1.6 lambda表达式
  </a>
  
    <nav class="md-nav" aria-label="1.6 lambda表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161-lambda" class="md-nav__link">
    1.6.1 什么是lambda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#163" class="md-nav__link">
    1.6.3 函数式接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#164" class="md-nav__link">
    1.6.4 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-synchronized" class="md-nav__link">
    1.7 synchronized回顾
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-synchronized8" class="md-nav__link">
    1.8 synchronized的8锁问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-lock" class="md-nav__link">
    第2章 Lock锁
  </a>
  
    <nav class="md-nav" aria-label="第2章 Lock锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-reentrantlock" class="md-nav__link">
    2.1 ReentrantLock可重入锁
  </a>
  
    <nav class="md-nav" aria-label="2.1 ReentrantLock可重入锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.1.1 测试可重入性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.1.3 限时等待
  </a>
  
    <nav class="md-nav" aria-label="2.1.3 限时等待">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#214-reentrantlocksynchronized" class="md-nav__link">
    2.1.4 ReentrantLock和synchronized区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-reentrantreadwritelock" class="md-nav__link">
    2.2 ReentrantReadWriteLock读写锁
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    第3章 线程间通信
  </a>
  
    <nav class="md-nav" aria-label="第3章 线程间通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 回顾线程通信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 虚假唤醒
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 定制化调用通信
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    第4章 并发容器类
  </a>
  
    <nav class="md-nav" aria-label="第4章 并发容器类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#43-setmap" class="md-nav__link">
    4.3 扩展类比：Set和Map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-juc" class="md-nav__link">
    第5章 JUC强大的辅助类
  </a>
  
    <nav class="md-nav" aria-label="第5章 JUC强大的辅助类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#52-cyclicbarrier" class="md-nav__link">
    5.2 CyclicBarrier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-semaphore" class="md-nav__link">
    5.3 Semaphore
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-callable" class="md-nav__link">
    第6章 Callable接口
  </a>
  
    <nav class="md-nav" aria-label="第6章 Callable接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-callablerunable" class="md-nav__link">
    6.1 Callable和Runable对比
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-callable" class="md-nav__link">
    6.2 Callable的使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    6.3 面试题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-blockingqueue" class="md-nav__link">
    第7章 阻塞队列（BlockingQueue）
  </a>
  
    <nav class="md-nav" aria-label="第7章 阻塞队列（BlockingQueue）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-blockingqueue" class="md-nav__link">
    7.1 什么是BlockingQueue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-blockingqueue" class="md-nav__link">
    7.2 认识BlockingQueue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3 代码演示
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-threadpool" class="md-nav__link">
    第8章 ThreadPool线程池
  </a>
  
    <nav class="md-nav" aria-label="第8章 ThreadPool线程池">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81" class="md-nav__link">
    8.1 架构说明
  </a>
  
    <nav class="md-nav" aria-label="8.1 架构说明">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#831-7" class="md-nav__link">
    8.3.1 线程池的7个重要参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#833" class="md-nav__link">
    8.3.3 拒绝策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84" class="md-nav__link">
    8.4 自定义线程池
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    第9章 多线程高并发底层原理
  </a>
  
    <nav class="md-nav" aria-label="第9章 多线程高并发底层原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-javajmm" class="md-nav__link">
    9.1 java内存模型（JMM）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-volatile" class="md-nav__link">
    9.2 volatile关键字
  </a>
  
    <nav class="md-nav" aria-label="9.2 volatile关键字">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#921" class="md-nav__link">
    9.2.1 验证可见性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#922" class="md-nav__link">
    9.2.2 验证有序性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#923" class="md-nav__link">
    9.2.3 验证不具备原子性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#924-volatile" class="md-nav__link">
    9.2.4 volatile原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#925-happen-before" class="md-nav__link">
    9.2.5 Happen-Before（了解）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-cas" class="md-nav__link">
    9.3 CAS
  </a>
  
    <nav class="md-nav" aria-label="9.3 CAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    9.3.1 基本代码演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932" class="md-nav__link">
    9.3.2 验证原子性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933" class="md-nav__link">
    9.3.3 缺点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-aqs" class="md-nav__link">
    9.4 AQS
  </a>
  
    <nav class="md-nav" aria-label="9.4 AQS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#942-aqs" class="md-nav__link">
    9.4.2 基于AQS实现锁的思路
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#943-aqs" class="md-nav__link">
    9.4.3 基于AQS实现独占锁
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#944-reentrantlock" class="md-nav__link">
    9.4.4 ReentrantLock底层原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9441-sync" class="md-nav__link">
    9.4.4.1 Sync抽象类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9442-nonfairsync" class="md-nav__link">
    9.4.4.2 NonfairSync
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9443-fairsync" class="md-nav__link">
    9.4.4.3 FairSync
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#95" class="md-nav__link">
    9.5 各种锁
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jvm/jvm/" class="md-nav__link">
        jvm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql%E9%AB%98%E7%BA%A7/MySQL%E9%AB%98%E7%BA%A7/" class="md-nav__link">
        mysql高级
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql%E9%AB%98%E7%BA%A7/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="md-nav__link">
        MySQL主从复制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MyCat/Mycat/" class="md-nav__link">
        MyCat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../nginx/Nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7" type="checkbox" id="__nav_1_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7">
          项目文档
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="项目文档" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_7">
          <span class="md-nav__icon md-icon"></span>
          项目文档
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_1" type="checkbox" id="__nav_1_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_1">
          美年旅游
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="美年旅游" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_1">
          <span class="md-nav__icon md-icon"></span>
          美年旅游
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day01/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC1%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游01
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day02/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC2%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游02
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day03/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC3%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游03
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day04/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC4%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day05/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC5%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游05
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day06/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC6%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游06
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day07/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC7%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游07
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day08/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC8%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游08
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day09/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC9%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游09
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day10/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC10%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%BE%8E%E5%B9%B4/day11/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC11%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游11
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_2" type="checkbox" id="__nav_1_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_2">
          尚邻网
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚邻网" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_2">
          <span class="md-nav__icon md-icon"></span>
          尚邻网
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/1.%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/" class="md-nav__link">
        搭建环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/2.%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86/" class="md-nav__link">
        用户角色管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/3.Apache%20Dubbo/" class="md-nav__link">
        Apache Dubbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/4.%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/" class="md-nav__link">
        服务拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/5.%E4%BA%8C%E6%89%8B%E6%88%BF%E7%AE%A1%E7%90%86/" class="md-nav__link">
        二手房管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/6.%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/" class="md-nav__link">
        图片上传
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/7.%E5%89%8D%E7%AB%AF%E6%88%BF%E6%BA%90%E5%B1%95%E7%A4%BA/" class="md-nav__link">
        前端房源展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/8.%E5%89%8D%E7%AB%AF%E7%99%BB%E5%BD%95%E4%B8%8E%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%85%B3%E6%B3%A8/" class="md-nav__link">
        前端登录与注册与关注
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/9.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" class="md-nav__link">
        权限管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/10.spring%20security/" class="md-nav__link">
        spring security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E9%82%BB%E7%BD%91/11.session%E5%85%B1%E4%BA%AB/" class="md-nav__link">
        session共享
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_3" type="checkbox" id="__nav_1_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_3">
          谷粒商城
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="谷粒商城" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_3">
          <span class="md-nav__icon md-icon"></span>
          谷粒商城
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/1.%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88nginx%E3%80%81cors%E3%80%81oss%EF%BC%89/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        谷粒商城01
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/2.%E5%88%86%E7%B1%BB%E3%80%81%E8%A7%84%E6%A0%BC%E3%80%81%E5%95%86%E5%93%81%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/" class="md-nav__link">
        谷粒商城02
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/3.%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8F%8Aseata/%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8F%8Aseata/" class="md-nav__link">
        谷粒商城03
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/4.elasticsearch%28DSL%E5%8F%8ASpringData-Elasticsearch%29/elasticsearch/" class="md-nav__link">
        谷粒商城04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/5.%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2/%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2/" class="md-nav__link">
        谷粒商城05
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/6.%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%EF%BC%88Thymeleaf%EF%BC%89%E5%8F%8A%E6%90%9C%E7%B4%A2%E9%A1%B5%E6%B8%B2%E6%9F%93/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf/" class="md-nav__link">
        谷粒商城06
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/7.%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%EF%BC%88RabbitMQ%EF%BC%89/%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" class="md-nav__link">
        谷粒商城07
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/8.%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%28%E7%BC%93%E5%AD%98%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E3%80%81Redisson%E3%80%81%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%29/%E9%A6%96%E9%A1%B5%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB/" class="md-nav__link">
        谷粒商城08
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/9.%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E5%8F%8A%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92%EF%BC%88CompletableFuture%EF%BC%89/%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5/" class="md-nav__link">
        谷粒商城09
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/10.%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/" class="md-nav__link">
        谷粒商城10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/11.%E8%B4%AD%E7%89%A9%E8%BD%A6%EF%BC%88SpringTask%EF%BC%89/%E8%B4%AD%E7%89%A9%E8%BD%A6/" class="md-nav__link">
        谷粒商城11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/12.%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88xxl-job%EF%BC%89/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88xxl-job%EF%BC%89/" class="md-nav__link">
        谷粒商城12
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/13.%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/" class="md-nav__link">
        谷粒商城13
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E7%94%B5%E5%95%86/14.%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/" class="md-nav__link">
        谷粒商城14
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_4" type="checkbox" id="__nav_1_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_4">
          尚融宝
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚融宝" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_4">
          <span class="md-nav__icon md-icon"></span>
          尚融宝
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part01-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/Part01-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
        项目介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part02-MyBatis-Plus/Part02-MyBatis-Plus/" class="md-nav__link">
        MyBatis-Plus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part03-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/Part03-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        后端接口工程搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part04-%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/Part04-%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        前端知识
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part05-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/Part05-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        管理平台前端搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part06-Alibaba%20EasyExcel/Part06-Alibaba%20EasyExcel/" class="md-nav__link">
        Alibaba EasyExcel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part07-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/Part07-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/" class="md-nav__link">
        数据字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part08-Redis%E7%BC%93%E5%AD%98/Part08-Redis%E7%BC%93%E5%AD%98/" class="md-nav__link">
        Redis缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part09-NuxtJS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93/Part09-NuxtJS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93/" class="md-nav__link">
        NuxtJS服务器端渲染
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part10-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1/Part10-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1/" class="md-nav__link">
        阿里云短信
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java课程/项目文档/尚融宝/Part11-分布式文件系统-阿里云OSS/分布式文件系统-阿里云OSS" class="md-nav__link">
        阿里云OSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C/Part12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C/" class="md-nav__link">
        用户注册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part13-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C/Part13-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C/" class="md-nav__link">
        访问令牌
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part14-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/Part14-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/" class="md-nav__link">
        用户认证
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part15-%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86/Part15-%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86/" class="md-nav__link">
        会员管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part16-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-OAuth2/Part16-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-OAuth2/" class="md-nav__link">
        OAuth2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part17-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/Part17-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="md-nav__link">
        内网穿透
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part18-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/Part18-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" class="md-nav__link">
        微信登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part19-%20SpringCloud/Part19-%20SpringCloud/" class="md-nav__link">
        SpringCloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part20-%E8%B4%A6%E6%88%B7%E7%BB%91%E5%AE%9A/Part20-%E8%B4%A6%E6%88%B7%E7%BB%91%E5%AE%9A/" class="md-nav__link">
        账户绑定
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part21-%E7%94%B3%E8%AF%B7%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6/Part21-%E7%94%B3%E8%AF%B7%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6/" class="md-nav__link">
        申请借款额度
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part22-%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6%E5%AE%A1%E6%A0%B8/Part22-%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6%E5%AE%A1%E6%A0%B8/" class="md-nav__link">
        借款额度审核
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part23-%E5%80%9F%E6%AC%BE%E7%94%B3%E8%AF%B7/Part23-%E5%80%9F%E6%AC%BE%E7%94%B3%E8%AF%B7/" class="md-nav__link">
        借款申请
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part24-%E5%80%9F%E6%AC%BE%E5%AE%A1%E6%A0%B8/Part24-%E5%80%9F%E6%AC%BE%E5%AE%A1%E6%A0%B8/" class="md-nav__link">
        借款审核
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part25-%E6%A0%87%E7%9A%84%E7%AE%A1%E7%90%86/Part25-%E6%A0%87%E7%9A%84%E7%AE%A1%E7%90%86/" class="md-nav__link">
        标的管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part26-%E6%88%91%E8%A6%81%E6%8A%95%E8%B5%84/Part26-%E6%88%91%E8%A6%81%E6%8A%95%E8%B5%84/" class="md-nav__link">
        我要投资
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part27-%E5%85%85%E5%80%BC/Part27-%E5%85%85%E5%80%BC/" class="md-nav__link">
        充值
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part28-%E6%8A%95%E6%A0%87/Part28-%E6%8A%95%E6%A0%87/" class="md-nav__link">
        投标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part29-%E6%94%BE%E6%AC%BE/Part29-%E6%94%BE%E6%AC%BE/" class="md-nav__link">
        放款
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part30-%E6%8A%95%E8%B5%84%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA/Part30-%E6%8A%95%E8%B5%84%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA/" class="md-nav__link">
        投资列表展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part31-%E6%8F%90%E7%8E%B0%E5%92%8C%E8%BF%98%E6%AC%BE/Part31-%E6%8F%90%E7%8E%B0%E5%92%8C%E8%BF%98%E6%AC%BE/" class="md-nav__link">
        提现和还款
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part32-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83/Part32-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83/" class="md-nav__link">
        个人中心
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part33-%E7%BD%91%E5%85%B3/Part33-%E7%BD%91%E5%85%B3/" class="md-nav__link">
        网关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part34-%E8%A1%A5%E5%85%85/Part34-%E8%A1%A5%E5%85%85/" class="md-nav__link">
        补充
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part35-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/Part35-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/" class="md-nav__link">
        微信支付
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_5" type="checkbox" id="__nav_1_7_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_5">
          尚医通
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚医通" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_5">
          <span class="md-nav__icon md-icon"></span>
          尚医通
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day01%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8EMyBatis%20Plus/day01%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%20Mybatis%20Plus/" class="md-nav__link">
        项目介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day02%20%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E5%8C%BB%E9%99%A2%E8%AE%BE%E7%BD%AE/day02%20%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E5%8C%BB%E9%99%A2%E8%AE%BE%E7%BD%AE/" class="md-nav__link">
        搭建环境和医院设置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day03%20%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/day03%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/" class="md-nav__link">
        前端基础知识（一）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day04%20%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%BA%8C%EF%BC%89/day04%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        前端基础知识（二）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day05%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/day05%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        平台管理前端搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day06%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/day06%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/" class="md-nav__link">
        数据字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day07mongodb/day07mongodb/" class="md-nav__link">
        mongodb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day08%E5%8C%BB%E9%99%A2%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3/day08%E5%8C%BB%E9%99%A2%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3/" class="md-nav__link">
        医院上传接口
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day09%E5%8C%BB%E9%99%A2%E7%AE%A1%E7%90%86/day09%E5%8C%BB%E9%99%A2%E7%AE%A1%E7%90%86/" class="md-nav__link">
        医院管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day10%E6%8E%92%E7%8F%AD%E7%AE%A1%E7%90%86%E5%92%8C%E7%BD%91%E5%85%B3/day10%E6%8E%92%E7%8F%AD%E7%AE%A1%E7%90%86%E5%92%8C%E7%BD%91%E5%85%B3/" class="md-nav__link">
        排班管理和网关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day11%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%A6%96%E9%A1%B5/day11%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%A6%96%E9%A1%B5/" class="md-nav__link">
        平台前端搭建与首页
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day12%E6%89%8B%E6%9C%BA%E7%99%BB%E5%BD%95/day12%E6%89%8B%E6%9C%BA%E7%99%BB%E5%BD%95/" class="md-nav__link">
        手机登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day13%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/day13%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" class="md-nav__link">
        微信登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day14%E9%98%BF%E9%87%8C%E4%BA%91OSS%E3%80%81%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%B0%B1%E8%AF%8A%E4%BA%BA/day14%E9%98%BF%E9%87%8C%E4%BA%91OSS%E3%80%81%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%B0%B1%E8%AF%8A%E4%BA%BA/" class="md-nav__link">
        阿里云OSS、用户认证与就诊人
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day15%E9%A2%84%E7%BA%A6%E6%8C%82%E5%8F%B7/day15%E9%A2%84%E7%BA%A6%E6%8C%82%E5%8F%B7/" class="md-nav__link">
        预约挂号
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day16%E9%A2%84%E7%BA%A6%E4%B8%8B%E5%8D%95/day16%E9%A2%84%E7%BA%A6%E4%B8%8B%E5%8D%95/" class="md-nav__link">
        预约下单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day17%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/day17%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/" class="md-nav__link">
        微信支付
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/%E5%B0%9A%E5%8C%BB%E9%80%9A/day18%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E7%BB%9F%E8%AE%A1/day18%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E7%BB%9F%E8%AE%A1/" class="md-nav__link">
        定时任务与统计
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Java就业面试
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java就业面试" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Java就业面试
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC1%E7%AB%A0%20%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        第1章 面试说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC2%E7%AB%A0%20%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/" class="md-nav__link">
        第2章 手写代码
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC3%E7%AB%A0%20JavaSE/" class="md-nav__link">
        第3章 JavaSE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC4%E7%AB%A0%20JVM/" class="md-nav__link">
        第4章 JVM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC5%E7%AB%A0%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        第5章 设计模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC6%E7%AB%A0%20MySql/" class="md-nav__link">
        第6章 MySql
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC7%E7%AB%A0%20Java%20Web/" class="md-nav__link">
        第7章 Java Web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC8%E7%AB%A0%20SSM%E6%A1%86%E6%9E%B6/" class="md-nav__link">
        第8章 SSM框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC9%E7%AB%A0%20SpringBoot/" class="md-nav__link">
        第9章 SpringBoot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC10%E7%AB%A0%20SpringCloud/" class="md-nav__link">
        第10章 SpringCloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC11%E7%AB%A0%20Redis/" class="md-nav__link">
        第11章 Redis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC12%E7%AB%A0%20MQ/" class="md-nav__link">
        第12章 MQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC13%E7%AB%A0%20ElasticSearch/" class="md-nav__link">
        第13章 ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC14%E7%AB%A0%20Dubbo/" class="md-nav__link">
        第14章 Dubbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC15%E7%AB%A0%20Zookeeper/" class="md-nav__link">
        第15章 Zookeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC16%E7%AB%A0%20Git/" class="md-nav__link">
        第16章 Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC17%E7%AB%A0%20Linux/" class="md-nav__link">
        第17章 Linux
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        学习文档
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1juc" class="md-nav__link">
    第1章JUC概述及回顾
  </a>
  
    <nav class="md-nav" aria-label="第1章JUC概述及回顾">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-juc" class="md-nav__link">
    1.1 JUC是什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 进程和线程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-waitsleep" class="md-nav__link">
    1.4 wait/sleep的区别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    1.5 创建线程回顾
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-lambda" class="md-nav__link">
    1.6 lambda表达式
  </a>
  
    <nav class="md-nav" aria-label="1.6 lambda表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161-lambda" class="md-nav__link">
    1.6.1 什么是lambda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#163" class="md-nav__link">
    1.6.3 函数式接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#164" class="md-nav__link">
    1.6.4 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-synchronized" class="md-nav__link">
    1.7 synchronized回顾
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-synchronized8" class="md-nav__link">
    1.8 synchronized的8锁问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-lock" class="md-nav__link">
    第2章 Lock锁
  </a>
  
    <nav class="md-nav" aria-label="第2章 Lock锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-reentrantlock" class="md-nav__link">
    2.1 ReentrantLock可重入锁
  </a>
  
    <nav class="md-nav" aria-label="2.1 ReentrantLock可重入锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.1.1 测试可重入性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.1.3 限时等待
  </a>
  
    <nav class="md-nav" aria-label="2.1.3 限时等待">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#214-reentrantlocksynchronized" class="md-nav__link">
    2.1.4 ReentrantLock和synchronized区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-reentrantreadwritelock" class="md-nav__link">
    2.2 ReentrantReadWriteLock读写锁
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    第3章 线程间通信
  </a>
  
    <nav class="md-nav" aria-label="第3章 线程间通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 回顾线程通信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 虚假唤醒
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 定制化调用通信
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    第4章 并发容器类
  </a>
  
    <nav class="md-nav" aria-label="第4章 并发容器类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#43-setmap" class="md-nav__link">
    4.3 扩展类比：Set和Map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-juc" class="md-nav__link">
    第5章 JUC强大的辅助类
  </a>
  
    <nav class="md-nav" aria-label="第5章 JUC强大的辅助类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#52-cyclicbarrier" class="md-nav__link">
    5.2 CyclicBarrier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-semaphore" class="md-nav__link">
    5.3 Semaphore
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-callable" class="md-nav__link">
    第6章 Callable接口
  </a>
  
    <nav class="md-nav" aria-label="第6章 Callable接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-callablerunable" class="md-nav__link">
    6.1 Callable和Runable对比
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-callable" class="md-nav__link">
    6.2 Callable的使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    6.3 面试题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-blockingqueue" class="md-nav__link">
    第7章 阻塞队列（BlockingQueue）
  </a>
  
    <nav class="md-nav" aria-label="第7章 阻塞队列（BlockingQueue）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-blockingqueue" class="md-nav__link">
    7.1 什么是BlockingQueue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-blockingqueue" class="md-nav__link">
    7.2 认识BlockingQueue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3 代码演示
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-threadpool" class="md-nav__link">
    第8章 ThreadPool线程池
  </a>
  
    <nav class="md-nav" aria-label="第8章 ThreadPool线程池">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81" class="md-nav__link">
    8.1 架构说明
  </a>
  
    <nav class="md-nav" aria-label="8.1 架构说明">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#831-7" class="md-nav__link">
    8.3.1 线程池的7个重要参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#833" class="md-nav__link">
    8.3.3 拒绝策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84" class="md-nav__link">
    8.4 自定义线程池
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    第9章 多线程高并发底层原理
  </a>
  
    <nav class="md-nav" aria-label="第9章 多线程高并发底层原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-javajmm" class="md-nav__link">
    9.1 java内存模型（JMM）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-volatile" class="md-nav__link">
    9.2 volatile关键字
  </a>
  
    <nav class="md-nav" aria-label="9.2 volatile关键字">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#921" class="md-nav__link">
    9.2.1 验证可见性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#922" class="md-nav__link">
    9.2.2 验证有序性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#923" class="md-nav__link">
    9.2.3 验证不具备原子性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#924-volatile" class="md-nav__link">
    9.2.4 volatile原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#925-happen-before" class="md-nav__link">
    9.2.5 Happen-Before（了解）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-cas" class="md-nav__link">
    9.3 CAS
  </a>
  
    <nav class="md-nav" aria-label="9.3 CAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    9.3.1 基本代码演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932" class="md-nav__link">
    9.3.2 验证原子性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933" class="md-nav__link">
    9.3.3 缺点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-aqs" class="md-nav__link">
    9.4 AQS
  </a>
  
    <nav class="md-nav" aria-label="9.4 AQS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#942-aqs" class="md-nav__link">
    9.4.2 基于AQS实现锁的思路
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#943-aqs" class="md-nav__link">
    9.4.3 基于AQS实现独占锁
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#944-reentrantlock" class="md-nav__link">
    9.4.4 ReentrantLock底层原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9441-sync" class="md-nav__link">
    9.4.4.1 Sync抽象类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9442-nonfairsync" class="md-nav__link">
    9.4.4.2 NonfairSync
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9443-fairsync" class="md-nav__link">
    9.4.4.3 FairSync
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#95" class="md-nav__link">
    9.5 各种锁
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="juc">JUC高级<a class="headerlink" href="#juc" title="Permanent link">&para;</a></h1>
<h2 id="1juc">第1章JUC概述及回顾<a class="headerlink" href="#1juc" title="Permanent link">&para;</a></h2>
<h3 id="11-juc">1.1 JUC是什么？<a class="headerlink" href="#11-juc" title="Permanent link">&para;</a></h3>
<p>在 Java 5.0 提供了 <code>java.util.concurrent</code>(简称JUC)包，在此包中增加了在并发编程中很常用的工具类。此包包括了几个小的、已标准化的可扩展框架，并提供一些功能实用的类，没有这些类，一些功能会很难实现或实现起来冗长乏味。</p>
<p>参照JDK文档：</p>
<p><img alt="1562743378734" src="../assets/1562743378734.png" /></p>
<h3 id="12">1.2 进程和线程<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<p>进程：进程是一个具有一定<strong>独立功能的程序</strong>关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。</p>
<p>线程：通常在<strong>一个进程中可以包含若干个线程</strong>，当然一个进程中至少有一个线程，不然没有存在的意义。线程可以利用进程所拥有的资源，在引入线程的操作系统中，通常都是把进程作为分配资源的基本单位，而把线程作为独立运行和独立调度的基本单位，由于线程比进程更小，基本上不拥有系统资源，故对它的调度所付出的开销就会小得多，能更高效的提高系统多个程序间并发执行的程度。</p>
<p>生活实例：</p>
<p>​       使用QQ，查看进程一定有一个QQ.exe的进程，我可以用qq和A文字聊天，和B视频聊天，给C传文件，给D发一段语言，QQ支持录入信息的搜索。</p>
<p>​       大四的时候写论文，用word写论文，同时用QQ音乐放音乐，同时用QQ聊天，多个进程。</p>
<p>​       word如没有保存，停电关机，再通电后打开word可以恢复之前未保存的文档，word也会检查你的拼写，两个线程：容灾备份，语法检查</p>
<p>1.3 并行和并发</p>
<p>并发：同一时刻多个线程在访问同一个资源，多个线程对一个点</p>
<p>​      例子：小米9今天上午10点，限量抢购</p>
<p>​            春运抢票</p>
<p>​            电商秒杀...</p>
<p>并行：多项工作一起执行，之后再汇总</p>
<p>​      例子：泡方便面，电水壶烧水，一边撕调料倒入桶中</p>
<h3 id="14-waitsleep">1.4 wait/sleep的区别<a class="headerlink" href="#14-waitsleep" title="Permanent link">&para;</a></h3>
<p>功能都是当前线程暂停，有什么区别？</p>
<p>wait：<strong>放开手去睡</strong>，放开手里的锁</p>
<p>sleep：<strong>握紧手去睡</strong>，醒了手里还有锁</p>
<p>wait是Object的方法，sleep是thread的方法</p>
<h3 id="15">1.5 创建线程回顾<a class="headerlink" href="#15" title="Permanent link">&para;</a></h3>
<p><strong>创建线程常用两种方式</strong>：</p>
<ol>
<li>继承Thread：java是单继承，资源宝贵，要用接口方式，如果继承了Thread类，那么你的类就不能再继承其他类了。</li>
<li>实现Runable接口</li>
</ol>
<p><strong>继承Thread抽象类</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="n">Thread</span>
<span class="k">new</span> <span class="nf">MyThread</span><span class="p">().</span><span class="na">start</span><span class="p">();</span>
</code></pre></div>
<p><strong>实现Runnable接口</strong>的方式：</p>
<ol>
<li>新建类实现runnable接口。这种方法会新增类，有更好的方法</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyRunnable</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="c1">//新建类实现runnable接口</span>
<span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="k">new</span> <span class="n">MyRunnable</span><span class="p">(),</span> <span class="n">name</span><span class="p">).</span><span class="na">start</span> <span class="c1">// 使用Rannable实现类创建进程，name是线程名</span>
</code></pre></div>
<ol>
<li>匿名内部类。</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 调用资源方法，完成业务逻辑</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="s">&quot;your thread name&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
</code></pre></div>
<h3 id="16-lambda">1.6 lambda表达式<a class="headerlink" href="#16-lambda" title="Permanent link">&para;</a></h3>
<p>之前说了Runnable接口的两种实现方式，其实还有第三种：</p>
<ol>
<li>创建类实现Runnable接口</li>
<li>编写匿名内部类实现Runnable接口</li>
<li><strong>lambda表达式</strong>：这种方法代码更简洁精炼</li>
</ol>
<div class="highlight"><pre><span></span><code>new Thread(() -&gt; {

}, &quot;your thread name&quot;).start();
</code></pre></div>
<h4 id="161-lambda">1.6.1 什么是lambda<a class="headerlink" href="#161-lambda" title="Permanent link">&para;</a></h4>
<p>Lambda 是一个匿名函数，我们可以把 Lambda表达式理解为是一段可以传递的代码（将代码像数据一样进行传递）。可以写出更简洁、更灵活的代码。作为一种更紧凑的代码风格，使Java的语言表达能力得到了提升。</p>
<p>Lambda 表达式在Java 语言中引入了一个新的语法元素和操作符。这个操作符为 “-&gt;” ， 该操作符被称为 Lambda 操作符或剪头操作符。它将 Lambda 分为两个部分：</p>
<ul>
<li>左侧：指定了 Lambda 表达式需要的所有参数</li>
<li>右侧：指定了 Lambda 体，即 Lambda 表达式要执行的功能</li>
</ul>
<p>1.6.2 案例</p>
<p>在一个方法中调用接口中的方法：传统写法</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">Foo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LambdaDemo</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>接下来，要用lambda表达式改造。其实是改造main方法</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span><span class="o">-&gt;</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>改造口诀：<font color="red">拷贝小括号()，写死右箭头-&gt;，落地大括号{...}</font></p>
<p>思考：如果Foo接口有多个方法，还能使用lambda表达式吗？</p>
<h4 id="163">1.6.3 函数式接口<a class="headerlink" href="#163" title="Permanent link">&para;</a></h4>
<p>lambda表达式，<strong>必须是函数式接口，必须只有一个方法</strong>，如果<strong>接口只有一个方法</strong>java默认它为函数式接口。
为了正确使用Lambda表达式，需要给接口加个注解：@FunctionalInterface。如有两个方法，立刻报错。</p>
<p>Runnable接口为什么可以用lambda表达式？</p>
<div class="highlight"><pre><span></span><code><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Runnable</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * When an object implementing interface &lt;code&gt;Runnable&lt;/code&gt; is used</span>
<span class="cm">     * to create a thread, starting the thread causes the object&#39;s</span>
<span class="cm">     * &lt;code&gt;run&lt;/code&gt; method to be called in that separately executing</span>
<span class="cm">     * thread.</span>
<span class="cm">     * &lt;p&gt;</span>
<span class="cm">     * The general contract of the method &lt;code&gt;run&lt;/code&gt; is that it may</span>
<span class="cm">     * take any action whatsoever.</span>
<span class="cm">     *</span>
<span class="cm">     * @see     java.lang.Thread#run()</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>发现Runnable接口上有一个注解：@FunctionalInterface</p>
<p>并且该接口只有一个方法：run()方法</p>
<p>其实，函数式接口必须只有一个方法，这个描述并不准确，它还允许有default方法和静态方法。</p>
<p>例如，在Foo接口中，又添加了sub方法和mul方法：</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span> <span class="nc">Foo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span> <span class="c1">// 抽象方法</span>

    <span class="k">default</span> <span class="kt">int</span> <span class="nf">sub</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span> <span class="c1">// default方法</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">mul</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span> <span class="c1">// 静态方法</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LambdaDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span><span class="o">-&gt;</span><span class="p">{</span>  <span class="c1">// lambda表达式实现抽象方法</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span> <span class="c1">// 调用抽象方法</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="na">sub</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">));</span> <span class="c1">// 调用default方法</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="na">mul</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">));</span> <span class="c1">// 通过Foo调用静态方法</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="164">1.6.4 小结<a class="headerlink" href="#164" title="Permanent link">&para;</a></h4>
<p>lambda表达式实现接口的前提是</p>
<p>​       <strong>有且只有一个抽象方法，可以选择@FunctionalInterface注解增强函数式接口定义</strong></p>
<p>改造口诀</p>
<p>​       <strong>拷贝小括号(形参列表)，写死右箭头 -&gt;，落地大括号 {方法实现}</strong></p>
<h3 id="17-synchronized">1.7 synchronized回顾<a class="headerlink" href="#17-synchronized" title="Permanent link">&para;</a></h3>
<p><font color="red">多线程编程模板上</font>：</p>
<ol>
<li>线程 操作 资源类</li>
<li>高内聚低耦合</li>
</ol>
<p>实现步骤：</p>
<ol>
<li>创建资源类</li>
<li>资源类里创建同步方法、同步代码块</li>
<li>多线程调用</li>
</ol>
<p>例子：<strong>卖票程序</strong></p>
<p>创建工程，并添加了一个SaleTicket.java</p>
<p><img alt="1562747700613" src="../assets/1562747700613.png" /></p>
<p>内容如下：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">Ticket</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">sale</span><span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;票已售罄！！！&quot;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;开始买票，当前票数：&quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;买票结束，剩余票数：&quot;</span> <span class="o">+</span> <span class="o">--</span><span class="n">number</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 在main方法中创建多线程方法，测试卖票业务</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SaleTicket</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Ticket</span> <span class="n">ticket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ticket</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ticket</span><span class="p">.</span><span class="na">sale</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;AAA&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ticket</span><span class="p">.</span><span class="na">sale</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;BBB&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ticket</span><span class="p">.</span><span class="na">sale</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;CCC&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="18-synchronized8">1.8 synchronized的8锁问题<a class="headerlink" href="#18-synchronized8" title="Permanent link">&para;</a></h3>
<p>看下面这段儿代码，回答后面的8个问题：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">Phone</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">sendSMS</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="c1">//TimeUnit.SECONDS.sleep(4);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;------sendSMS&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">sendEmail</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;------sendEmail&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getHello</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;------getHello&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lock_8</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="n">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Phone</span><span class="p">();</span>
        <span class="n">Phone</span> <span class="n">phone2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Phone</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="n">phone</span><span class="p">.</span><span class="na">sendSMS</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;AA&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>

        <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="n">phone</span><span class="p">.</span><span class="na">sendEmail</span><span class="p">();</span>
                <span class="c1">//phone.getHello();</span>
                <span class="c1">//phone2.sendEmail();</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;BB&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>多线程的8个问题：</p>
<ol>
<li>标准访问，先打印短信还是邮件</li>
<li>停4秒在短信方法内，先打印短信还是邮件</li>
<li>普通的hello方法，是先打短信还是hello</li>
<li>现在有两部手机，先打印短信还是邮件</li>
<li>两个静态同步方法，1部手机，先打印短信还是邮件</li>
<li>两个静态同步方法，2部手机，先打印短信还是邮件</li>
<li>1个静态同步方法，1个普通同步方法，1部手机，先打印短信还是邮件</li>
<li>1个静态同步方法，1个普通同步方法，2部手机，先打印短信还是邮件</li>
</ol>
<p>总结：</p>
<p>synchronized实现同步的基础：Java中的每一个对象都可以作为锁。具体表现为以下3种形式：</p>
<ol>
<li>对于普通同步方法，锁是当前实例对象。</li>
<li>对于静态同步方法，锁是当前类的Class对象。</li>
<li>对于同步方法块，锁是Synchonized括号里配置的对象</li>
</ol>
<p>当一个线程试图访问同步代码块时，它首先必须得到锁，退出或抛出异常时必须释放锁。</p>
<p>也就是说：</p>
<p>​       如果一个实例对象的非静态同步方法获取锁后，该实例对象的其他非静态同步方法必须等待获取锁的方法释放锁后才能获取锁；可是不同实例对象的非静态同步方法因为用的是不同对象的锁，所以毋须等待其他实例对象的非静态同步方法释放锁，就可以获取自己的锁。</p>
<p>​       <strong>所有的静态同步方法用的是同一把锁——类对象本身</strong>。不管是不是同一个实例对象，只要是一个类的对象，一旦一个静态同步方法获取锁之后，其他对象的静态同步方法，都必须等待该方法释放锁之后，才能获取锁。</p>
<p>​       而静态同步方法（Class对象锁）与非静态同步方法（实例对象锁）之间是不会有竞态条件的。</p>
<h2 id="2-lock">第2章 Lock锁<a class="headerlink" href="#2-lock" title="Permanent link">&para;</a></h2>
<p>首先看一下JUC的重磅武器——锁（Lock）</p>
<p>相比同步锁，JUC包中的Lock锁的功能更加强大，它提供了各种各样的锁（公平锁，非公平锁，共享锁，独占锁……），所以使用起来很灵活。</p>
<p><img alt="1562748499107" src="../assets/1562748499107.png" /></p>
<p>翻译过来就是：</p>
<blockquote>
<p>锁实现提供了比使用同步方法和语句可以获得的更广泛的锁操作。它们允许更灵活的结构，可能具有非常不同的属性，并且可能支持多个关联的条件对象。</p>
</blockquote>
<p>Lock是一个接口，这里主要有三个实现：ReentrantLock、ReentrantReadWriteLock.ReadLock、ReentrantReadWriteLock.WriteLock</p>
<h3 id="21-reentrantlock">2.1 ReentrantLock可重入锁<a class="headerlink" href="#21-reentrantlock" title="Permanent link">&para;</a></h3>
<p>ReentrantLock使用方式参照官方文档：</p>
<p><img alt="1562757277239" src="../assets/1562757277239.png" /></p>
<p>使用ReentrantLock改造卖票程序：只需改造sale()方法</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">Ticket</span><span class="p">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sale</span><span class="p">(){</span>

        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;票已售罄！&quot;</span><span class="p">);</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
            <span class="n">number</span><span class="o">--</span><span class="p">;</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;买票成功，当前剩余：&quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="211">2.1.1 测试可重入性<a class="headerlink" href="#211" title="Permanent link">&para;</a></h4>
<p>可重入锁又名递归锁，是指在同一个线程在外层方法获取锁的时候，再进入该线程的内层方法会自动获取锁。Java中ReentrantLock和synchronized都是可重入锁，可重入锁的一个优点是<strong>可一定程度避免死锁</strong>。</p>
<p>例如下列伪代码：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">A</span><span class="p">{</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="n">aa</span><span class="p">{</span>
        <span class="p">......</span>
        <span class="n">bb</span><span class="p">();</span>
        <span class="p">......</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="n">bb</span><span class="p">{</span>
        <span class="p">......</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="p">();</span>
<span class="n">a</span><span class="p">.</span><span class="na">aa</span><span class="p">();</span>
</code></pre></div>
<p>A类中有两个普通同步方法，都需要对象a的锁。如果是不可重入锁的话，aa方法首先获取到锁，aa方法在执行的过程中需要调用bb方法，此时锁被aa方法占有，bb方法无法获取到锁，这样就会导致bb方法无法执行，aa方法也无法执行，出现了死锁情况。可重入锁可避免这种死锁的发生。</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">Ticket</span><span class="p">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sale</span><span class="p">(){</span>

        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;票已售罄！&quot;</span><span class="p">);</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
            <span class="n">number</span><span class="o">--</span><span class="p">;</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;买票成功，当前剩余：&quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>
            <span class="c1">// 调用check方法测试锁的可重入性</span>
            <span class="k">this</span><span class="p">.</span><span class="na">check</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 为了测试可重入锁，添加检查余票方法</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">check</span><span class="p">(){</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;检查余票。。。。&quot;</span><span class="p">);</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>可以发现程序可以正常执行。。。说明该锁确实可重入。</p>
<div class="highlight"><pre><span></span><code>AAA买票成功，当前剩余：19
检查余票。。。。
AAA买票成功，当前剩余：18
检查余票。。。。
AAA买票成功，当前剩余：17
检查余票。。。。
AAA买票成功，当前剩余：16
检查余票。。。。
AAA买票成功，当前剩余：15
检查余票。。。。
AAA买票成功，当前剩余：14
检查余票。。。。
AAA买票成功，当前剩余：13
检查余票。。。。
BBB买票成功，当前剩余：12
检查余票。。。。
BBB买票成功，当前剩余：11
检查余票。。。。
BBB买票成功，当前剩余：10
。。。。。。
</code></pre></div>
<p>2.1.2 测试公平锁</p>
<p>ReentrantLock还可以实现公平锁。所谓公平锁，也就是在锁上等待时间最长的线程将获得锁的使用权。通俗的理解就是谁排队时间最长谁先执行获取锁。</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p>测试结果：</p>
<div class="highlight"><pre><span></span><code>AAA买票成功，当前剩余：19
检查余票。。。。
BBB买票成功，当前剩余：18
检查余票。。。。
CCC买票成功，当前剩余：17
检查余票。。。。
AAA买票成功，当前剩余：16
检查余票。。。。
BBB买票成功，当前剩余：15
检查余票。。。。
CCC买票成功，当前剩余：14
。。。。。。
</code></pre></div>
<p>可以看到ABC三个线程是按顺序买票成功的。</p>
<h3 id="213">2.1.3 限时等待<a class="headerlink" href="#213" title="Permanent link">&para;</a></h3>
<p>这个是什么意思呢？也就是通过我们的tryLock方法来实现，可以选择传入时间参数，表示等待指定的时间，无参则表示立即返回锁申请的结果：true表示获取锁成功，false表示获取锁失败。我们可以将这种方法用来解决死锁问题。</p>
<p><img alt="1595084697591" src="../assets/1595084697591.png" /></p>
<h4 id="214-reentrantlocksynchronized">2.1.4 ReentrantLock和synchronized区别<a class="headerlink" href="#214-reentrantlocksynchronized" title="Permanent link">&para;</a></h4>
<p>（1）synchronized是独占锁，加锁和解锁的过程自动进行，易于操作，但不够灵活。ReentrantLock也是独占锁，加锁和解锁的过程需要手动进行，不易操作，但非常灵活。</p>
<p>（2）synchronized可重入，因为加锁和解锁自动进行，不必担心最后是否释放锁；ReentrantLock也可重入，但加锁和解锁需要手动进行，且次数需一样，否则其他线程无法获得锁。</p>
<p>（3）synchronized不可响应中断，一个线程获取不到锁就一直等着；ReentrantLock可以响应中断，具体体现在tryLock（）。</p>
<h3 id="22-reentrantreadwritelock">2.2 ReentrantReadWriteLock读写锁<a class="headerlink" href="#22-reentrantreadwritelock" title="Permanent link">&para;</a></h3>
<p>​       在并发场景中用于解决线程安全的问题，我们几乎会高频率的使用到独占式锁，通常使用java提供的关键字synchronized或者concurrents包中实现了Lock接口的ReentrantLock。它们都是独占式获取锁，也就是在同一时刻只有一个线程能够获取锁。而在一些业务场景中，大部分只是读数据，写数据很少，如果仅仅是读数据的话并不会影响数据正确性（出现脏读），而如果在这种业务场景下，依然使用独占锁的话，很显然这将是出现性能瓶颈的地方。针对这种读多写少的情况，java还提供了另外一个实现Lock接口的<strong>ReentrantReadWriteLock</strong>(读写锁)。<strong>读写锁允许同一时刻被多个读线程访问，但是在写线程访问时，所有的读线程和其他的写线程都会被阻塞</strong>。</p>
<p>接下来以缓存为例用代码演示读写锁，重现问题：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyCache</span><span class="p">{</span>

    <span class="kd">private</span> <span class="kd">volatile</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cache</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">){</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始写入！&quot;</span><span class="p">);</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
            <span class="n">cache</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 写入成功！&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">get</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">){</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始读出！&quot;</span><span class="p">);</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 读出成功！&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReentrantReadWriteLockDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">MyCache</span> <span class="n">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyCache</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">num</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="c1">// 开启5个写线程</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">cache</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">num</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">num</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="c1">// 开启5个读线程</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">num</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>打印结果：多执行几次，有很大概率不会出现问题</p>
<p><img alt="1562978827184" src="../assets/1562978827184.png" /></p>
<p>改造MyCache，加入读写锁：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyCache</span><span class="p">{</span>
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cache</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
    <span class="c1">// 加入读写锁</span>
    <span class="n">ReentrantReadWriteLock</span> <span class="n">rwl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantReadWriteLock</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">){</span>
        <span class="c1">// 加写锁</span>
        <span class="n">rwl</span><span class="p">.</span><span class="na">writeLock</span><span class="p">().</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始写入！&quot;</span><span class="p">);</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
            <span class="n">cache</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 写入成功！&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="c1">// 释放写锁</span>
            <span class="n">rwl</span><span class="p">.</span><span class="na">writeLock</span><span class="p">().</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">get</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">){</span>
        <span class="c1">// 加入读锁</span>
        <span class="n">rwl</span><span class="p">.</span><span class="na">readLock</span><span class="p">().</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始读出！&quot;</span><span class="p">);</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">cache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 读出成功！&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="c1">// 释放读锁</span>
            <span class="n">rwl</span><span class="p">.</span><span class="na">readLock</span><span class="p">().</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="3">第3章 线程间通信<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>面试题：两个线程打印</p>
<p>​   两个线程，一个线程打印1-52，另一个打印字母A-Z打印顺序为12A34B...5152Z，要求用线程间通信</p>
<h3 id="31">3.1 回顾线程通信<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>先来简单案例：</p>
<p>​   两个线程操作一个初始值为0的变量，实现一个线程对变量增加1，一个线程对变量减少1，交替10轮。</p>
<p>线程间通信模型：</p>
<ol>
<li>生产者+消费者</li>
<li>通知等待唤醒机制</li>
</ol>
<p>多线程编程模板中：</p>
<ol>
<li>
<p>判断</p>
</li>
<li>
<p>干活</p>
</li>
<li>通知</li>
</ol>
<p>代码实现：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ShareDataOne</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     *  增加1</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="c1">// 1. 判断</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">wait</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 2. 干活</span>
        <span class="n">number</span><span class="o">++</span><span class="p">;</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>

        <span class="c1">// 3. 通知</span>
        <span class="k">this</span><span class="p">.</span><span class="na">notifyAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 减少1</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">decrement</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="c1">// 1. 判断</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">wait</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 2. 干活</span>
        <span class="n">number</span><span class="o">--</span><span class="p">;</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>

        <span class="c1">// 3. 通知</span>
        <span class="k">this</span><span class="p">.</span><span class="na">notifyAll</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * 现在两个线程，</span>
<span class="cm"> * 可以操作初始值为零的一个变量，</span>
<span class="cm"> * 实现一个线程对该变量加1，一个线程对该变量减1，</span>
<span class="cm"> * 交替，来10轮。</span>
<span class="cm"> *</span>
<span class="cm"> * 笔记：Java里面如何进行工程级别的多线程编写</span>
<span class="cm"> * 1 多线程变成模板（套路）-----上</span>
<span class="cm"> *    1.1  线程    操作    资源类</span>
<span class="cm"> *    1.2  高内聚  低耦合</span>
<span class="cm"> * 2 多线程变成模板（套路）-----中</span>
<span class="cm"> *    2.1  判断</span>
<span class="cm"> *    2.2  干活</span>
<span class="cm"> *    2.3  通知</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotifyWaitDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ShareDataOne</span> <span class="n">shareDataOne</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShareDataOne</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">increment</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;AAA&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">decrement</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;BBB&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>部分打印结果：AAA和BBB交互执行，执行结果是1 0 1 0... 一共10轮</p>
<div class="highlight"><pre><span></span><code>AAA: 1
BBB: 0
AAA: 1
BBB: 0
AAA: 1
BBB: 0
AAA: 1
BBB: 0
。。。。
</code></pre></div>
<p><strong>如果换成4个线程会怎样？</strong></p>
<p>改造mian方法，加入CCC和DDD两个线程：</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ShareDataOne</span> <span class="n">shareDataOne</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShareDataOne</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">increment</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;AAA&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">decrement</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;BBB&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">increment</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;CCC&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">decrement</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;DDD&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div>
<p>打印结果，依然会有概率是，10101010...。</p>
<p>但是，多执行几次，也会出现错乱的现象：</p>
<div class="highlight"><pre><span></span><code>AAA: 1
BBB: 0
CCC: 1
AAA: 2
CCC: 3
BBB: 2
CCC: 3
DDD: 2
AAA: 3
DDD: 2
CCC: 3
BBB: 2
</code></pre></div>
<h3 id="32">3.2 虚假唤醒<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>换成4个线程会导致错误，<strong>虚假唤醒</strong></p>
<p>原因：在java多线程判断时，不能用if，程序出事出在了判断上面。</p>
<p><strong>注意，消费者被唤醒后是从wait()方法（被阻塞的地方）后面执行，而不是重新从同步块开头。</strong></p>
<p>如下图：</p>
<p><img alt="1562811518605" src="../assets/1562811518605.png" /></p>
<p>解决虚假唤醒：查看API，java.lang.Object的wait方法</p>
<p><img alt="1562810523532" src="../assets/1562810523532.png" /></p>
<p>中断和虚假唤醒是可能产生的，所以要用loop循环，if只判断一次，while是只要唤醒就要拉回来再判断一次。</p>
<p>if换成while</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ShareDataOne</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     *  增加1</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="c1">// 1. 判断</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">wait</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 2. 干活</span>
        <span class="n">number</span><span class="o">++</span><span class="p">;</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>

        <span class="c1">// 3. 通知</span>
        <span class="k">this</span><span class="p">.</span><span class="na">notifyAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 减少1</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">decrement</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="c1">// 1. 判断</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">wait</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 2. 干活</span>
        <span class="n">number</span><span class="o">--</span><span class="p">;</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>

        <span class="c1">// 3. 通知</span>
        <span class="k">this</span><span class="p">.</span><span class="na">notifyAll</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * 现在两个线程，</span>
<span class="cm"> * 可以操作初始值为零的一个变量，</span>
<span class="cm"> * 实现一个线程对该变量加1，一个线程对该变量减1，</span>
<span class="cm"> * 交替，来10轮。</span>
<span class="cm"> *</span>
<span class="cm"> * 笔记：Java里面如何进行工程级别的多线程编写</span>
<span class="cm"> * 1 多线程变成模板（套路）-----上</span>
<span class="cm"> *    1.1  线程    操作    资源类</span>
<span class="cm"> *    1.2  高内聚  低耦合</span>
<span class="cm"> * 2 多线程变成模板（套路）-----中</span>
<span class="cm"> *    2.1  判断</span>
<span class="cm"> *    2.2  干活</span>
<span class="cm"> *    2.3  通知</span>
<span class="cm"> * 3 多线程编程模板（套路）-----下</span>
<span class="cm"> *    防止虚假唤醒（while）</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotifyWaitDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ShareDataOne</span> <span class="n">shareDataOne</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShareDataOne</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">increment</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;AAA&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">decrement</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;BBB&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">increment</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;CCC&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">shareDataOne</span><span class="p">.</span><span class="na">decrement</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;DDD&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>再次测试，完美解决</p>
<p>3.3 线程通信（Condition）</p>
<p>对标synchronized：</p>
<p><img alt="1562812279119" src="../assets/1562812279119.png" /></p>
<p>Condition：查看API，java.util.concurrent.locks</p>
<p><img alt="1562812425080" src="../assets/1562812425080.png" /></p>
<p>并提供了实现案例：</p>
<p><img alt="1562812570735" src="../assets/1562812570735.png" /></p>
<p>使用Condition实现线程通信，改造之前的代码（只需要改造ShareDataOne）：<strong>删掉increment和decrement方法的synchronized</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ShareDataOne</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">final</span> <span class="n">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="p">();</span> <span class="c1">// 初始化lock锁</span>
    <span class="kd">final</span> <span class="n">Condition</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">lock</span><span class="p">.</span><span class="na">newCondition</span><span class="p">();</span> <span class="c1">// 初始化condition对象</span>

    <span class="cm">/**</span>
<span class="cm">     *  增加1</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span> <span class="c1">// 加锁</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// 1. 判断</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// this.wait();</span>
                <span class="n">condition</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// 2. 干活</span>
            <span class="n">number</span><span class="o">++</span><span class="p">;</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>

            <span class="c1">// 3. 通知</span>
            <span class="c1">// this.notifyAll();</span>
            <span class="n">condition</span><span class="p">.</span><span class="na">signalAll</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 减少1</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">decrement</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// 1. 判断</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// this.wait();</span>
                <span class="n">condition</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// 2. 干活</span>
            <span class="n">number</span><span class="o">--</span><span class="p">;</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">number</span><span class="p">);</span>

            <span class="c1">// 3. 通知</span>
            <span class="c1">//this.notifyAll();</span>
            <span class="n">condition</span><span class="p">.</span><span class="na">signalAll</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="34">3.4 定制化调用通信<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>案例：</p>
<p>​       多线程之间按顺序调用，实现A-&gt;B-&gt;C。三个线程启动，要求如下：</p>
<p>​       AA打印5次，BB打印10次，CC打印15次</p>
<p>​       接着</p>
<p>​       AA打印5次，BB打印10次，CC打印15次</p>
<p>​       。。。打印10轮</p>
<p>分析实现方式：</p>
<ol>
<li>有一个锁Lock，3把钥匙Condition</li>
<li>有顺序通知（切换线程），需要有标识位</li>
<li>判断标志位</li>
<li>输出线程名 + 内容</li>
<li>修改标识符，通知下一个</li>
</ol>
<p>具体实现：</p>
<p><img alt="1562813671321" src="../assets/1562813671321.png" /></p>
<p>内容：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ShareDataTwo</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 线程标识位，通过它区分线程切换</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="p">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Condition</span> <span class="n">condition1</span> <span class="o">=</span> <span class="n">lock</span><span class="p">.</span><span class="na">newCondition</span><span class="p">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Condition</span> <span class="n">condition2</span> <span class="o">=</span> <span class="n">lock</span><span class="p">.</span><span class="na">newCondition</span><span class="p">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Condition</span> <span class="n">condition3</span> <span class="o">=</span> <span class="n">lock</span><span class="p">.</span><span class="na">newCondition</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print5</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">flag</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">condition1</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\t&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">condition2</span><span class="p">.</span><span class="na">signal</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print10</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">flag</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">condition2</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\t&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">condition3</span><span class="p">.</span><span class="na">signal</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print15</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">flag</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">condition3</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\t&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">condition1</span><span class="p">.</span><span class="na">signal</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * 多线程之间按顺序调用，实现A-&gt;B-&gt;C</span>
<span class="cm"> * 三个线程启动，要求如下：</span>
<span class="cm"> * AA打印5次，BB打印10次，CC打印15次</span>
<span class="cm"> * 接着</span>
<span class="cm"> * AA打印5次，BB打印10次，CC打印15次</span>
<span class="cm"> * ......来10轮</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadOrderAccess</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">ShareDataTwo</span> <span class="n">sdt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShareDataTwo</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sdt</span><span class="p">.</span><span class="na">print5</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;AAA&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sdt</span><span class="p">.</span><span class="na">print10</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;BBB&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sdt</span><span class="p">.</span><span class="na">print15</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="s">&quot;CCC&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="4">第4章 并发容器类<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<p>面试题：</p>
<p>​       请举例说明集合类是不安全的。</p>
<p>4.1 重现线程不安全：List</p>
<p>首先以List作为演示对象，创建多个线程对List接口的常用实现类ArrayList进行add操作。</p>
<p><img alt="1562825303228" src="../assets/1562825303228.png" /></p>
<p>内容：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotSafeDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>测试结果：</p>
<p><img alt="1562825565718" src="../assets/1562825565718.png" /></p>
<p><strong>出现了线程不安全错误</strong></p>
<p>ArrayList在多个线程同时对其进行修改的时候，就会抛出<strong>java.util.ConcurrentModificationException异常（并发修改异常）</strong>，因为ArrayList的add及其他方法都是线程不安全的，有源码佐证：</p>
<p><img alt="1562826214175" src="../assets/1562826214175.png" /></p>
<p>解决方案：</p>
<p>​       List接口有很多实现类，除了常用的ArrayList之外，还有Vector和SynchronizedList。</p>
<p><img alt="1562826331284" src="../assets/1562826331284.png" /></p>
<p>他们都有synchronized关键字，说明都是线程安全的。</p>
<p><img alt="1562826499790" src="../assets/1562826499790.png" /></p>
<p>改用Vector或者synchronizedList试试：</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">//List&lt;String&gt; list = new Vector&lt;&gt;();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Collections</span><span class="p">.</span><span class="na">synchronizedList</span><span class="p">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>即可解决！</p>
<p>Vector和Synchronized的缺点：</p>
<p>​       vector：<strong>内存消耗比较大</strong>，适合一次增量比较大的情况</p>
<p>​       SynchronizedList：<strong>迭代器涉及的代码没有加上线程同步代码</strong></p>
<p>4.2 CopyOnWrite容器</p>
<p>什么是CopyOnWrite容器</p>
<p>​       <strong>CopyOnWrite容器</strong>（简称COW容器）即写时复制的容器。通俗的理解是当我们往一个容器添加元素的时候，不直接往当前容器添加，而是先将当前容器进行Copy，复制出一个新的容器，然后新的容器里添加元素，添加完元素之后，再将原容器的引用指向新的容器。这样做的好处是我们可以对CopyOnWrite容器进行并发的读，而不需要加锁，因为当前容器不会添加任何元素。所以<strong>CopyOnWrite容器也是一种读写分离的思想，读和写不同的容器</strong>。</p>
<p>​       从JDK1.5开始Java并发包里提供了两个使用CopyOnWrite机制实现的并发容器,它们是CopyOnWriteArrayList和CopyOnWriteArraySet。</p>
<p>先看看CopyOnWriteArrayList类：发现它的本质就是数组</p>
<p><img alt="1562830411166" src="../assets/1562830411166.png" /></p>
<p>再来看看CopyOnWriteArrayList的add方法：发现该方法是线程安全的</p>
<p><img alt="1562829359583" src="../assets/1562829359583.png" /></p>
<p>使用CopyOnWriteArrayList改造main方法：</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">//List&lt;String&gt; list = new Vector&lt;&gt;();</span>
        <span class="c1">//List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p><strong>CopyOnWrite并发容器用于读多写少的并发场景</strong>。比如：白名单，黑名单。假如我们有一个搜索网站，用户在这个网站的搜索框中，输入关键字搜索内容，但是某些关键字不允许被搜索。这些不能被搜索的关键字会被放在一个黑名单当中，黑名单一定周期才会更新一次。</p>
<p>缺点：</p>
<ol>
<li><strong>内存占用问题。</strong>写的时候会创建新对象添加到新容器里，而旧容器的对象还在使用，所以有两份对象内存。通过压缩容器中的元素的方法来减少大对象的内存消耗，比如，如果元素全是10进制的数字，可以考虑把它压缩成36进制或64进制。或者不使用CopyOnWrite容器，而使用其他的并发容器，如ConcurrentHashMap。</li>
<li><strong>数据一致性问题。</strong>CopyOnWrite容器只能保证数据的最终一致性，不能保证数据的实时一致性。所以如果你希望写入的的数据，马上能读到，请不要使用CopyOnWrite容器。</li>
</ol>
<h3 id="43-setmap">4.3 扩展类比：Set和Map<a class="headerlink" href="#43-setmap" title="Permanent link">&para;</a></h3>
<p>HashSet和HashMap也都是线程不安全的，类似于ArrayList，也可以通过代码证明。</p>
<div class="highlight"><pre><span></span><code>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">notSafeMap</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()),</span> <span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">notSafeSet</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">set</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">set</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>都会报：ConcurrentModificationException异常信息。</p>
<p>Collections提供了方法synchronizedList保证list是同步线程安全的，Set和Map呢？</p>
<p><img alt="1562828426062" src="../assets/1562828426062.png" /></p>
<p>JUC提供的CopyOnWrite容器实现类有：CopyOnWriteArrayList和CopyOnWriteArraySet。</p>
<p>有没有Map的实现：</p>
<p><img alt="1562831562414" src="../assets/1562831562414.png" /></p>
<p>最终实现：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotSafeDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">notSafeList</span><span class="p">();</span>
        <span class="n">notSafeSet</span><span class="p">();</span>
        <span class="n">notSafeMap</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">notSafeMap</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span>
        <span class="c1">//Map&lt;String, String&gt; map = Collections.synchronizedMap(new HashMap&lt;&gt;());</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()),</span> <span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">notSafeSet</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//Set&lt;String&gt; set = new HashSet&lt;&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArraySet</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">set</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">set</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">notSafeList</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//List&lt;String&gt; list = new Vector&lt;&gt;();</span>
        <span class="c1">//List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>扩展：HashSet底层数据结构是什么？HashMap  ?</p>
<p>​           但HashSet的add是放一个值，而HashMap是放K、V键值对</p>
<p><img alt="1562830638509" src="../assets/1562830638509.png" /></p>
<p><img alt="1562830863791" src="../assets/1562830863791.png" /></p>
<h2 id="5-juc">第5章 JUC强大的辅助类<a class="headerlink" href="#5-juc" title="Permanent link">&para;</a></h2>
<p>JUC的多线程辅助类非常多，这里我们介绍三个：</p>
<ol>
<li>CountDownLatch（倒计数器）</li>
<li>CyclicBarrier（循环栅栏）</li>
<li>Semaphore（信号量）</li>
</ol>
<p><img alt="1562913111979" src="../assets/1562913111979.png" /></p>
<p>5.1 CountDownLatch</p>
<p>CountDownLatch是一个非常实用的多线程控制工具类，应用非常广泛。</p>
<p>例如：在手机上安装一个应用程序，假如需要5个子进程检查服务授权，那么主进程会维护一个计数器，初始计数就是5。用户每同意一个授权该计数器减1，当计数减为0时，主进程才启动，否则就只有阻塞等待了。</p>
<p>CountDownLatch中count down是倒数的意思，latch则是门闩的含义。整体含义可以理解为倒数的门栓，似乎有一点“三二一，芝麻开门”的感觉。CountDownLatch的作用也是如此。</p>
<p>常用的就下面几个方法：</p>
<div class="highlight"><pre><span></span><code><span class="k">new</span> <span class="n">CountDownLatch</span><span class="p">(</span><span class="kt">int</span> <span class="n">count</span><span class="p">)</span> <span class="c1">//实例化一个倒计数器，count指定初始计数</span>
<span class="n">countDown</span><span class="p">()</span> <span class="c1">// 每调用一次，计数减一</span>
<span class="n">await</span><span class="p">()</span> <span class="c1">//等待，当计数减到0时，阻塞线程（可以是一个，也可以是多个）并行执行</span>
</code></pre></div>
<p>案例：6个同学陆续离开教室后值班同学才可以关门。</p>
<p><img alt="1562920244806" src="../assets/1562920244806.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountDownLatchDemo</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * main方法也是一个进程，在这里是主进程，即上锁的同学</span>
<span class="cm">     *</span>
<span class="cm">     * @param args</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>

        <span class="c1">// 初始化计数器，初始计数为6</span>
        <span class="n">CountDownLatch</span> <span class="n">countDownLatch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="c1">// 每个同学墨迹几秒钟</span>
                    <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="k">new</span> <span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 同学出门了&quot;</span><span class="p">);</span>
                    <span class="c1">// 调用countDown()计算减1</span>
                    <span class="n">countDownLatch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// 调用计算器的await方法，等待6位同学都出来</span>
        <span class="n">countDownLatch</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;值班同学锁门了&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>打印结果：</p>
<div class="highlight"><pre><span></span><code>同学3 出来了
同学1 出来了
同学0 出来了
同学2 出来了
同学5 出来了
同学4 出来了
值班同学锁门了
</code></pre></div>
<p>面试：CountDownLatch 与 join 方法的区别</p>
<p>​       调用一个子线程的 join()方法后，该线程会一直被阻塞直到该线程运行完毕。而 CountDownLatch 则使用计数器允许子线程运行完毕或者运行中时候递减计数，也就是 CountDownLatch 可以在子线程运行任何时候让 await 方法返回而不一定必须等到线程结束；另外使用线程池来管理线程时候一般都是直接添加 Runnable 到线程池这时候就没有办法在调用线程的 join 方法了，countDownLatch 相比 Join 方法让我们对线程同步有更灵活的控制。</p>
<p>练习：秦灭六国，一统华夏。（模仿课堂案例，练习枚举类的使用）</p>
<h3 id="52-cyclicbarrier">5.2 CyclicBarrier<a class="headerlink" href="#52-cyclicbarrier" title="Permanent link">&para;</a></h3>
<p>从字面上的意思可以知道，这个类的中文意思是“循环栅栏”。大概的意思就是一个可循环利用的屏障。该命令只在每个屏障点运行一次。若在所有参与线程之前更新共享状态，此屏障操作很有用</p>
<p>常用方法：</p>
<ol>
<li>CyclicBarrier(int parties, Runnable barrierAction) 创建一个CyclicBarrier实例，parties指定参与相互等待的线程数，<strong>barrierAction一个可选的Runnable命令，该命令只在每个屏障点运行一次，可以在执行后续业务之前共享状态。该操作由最后一个进入屏障点的线程执行。</strong></li>
<li>CyclicBarrier(int parties) 创建一个CyclicBarrier实例，parties指定参与相互等待的线程数。</li>
<li>await() 该方法被调用时表示当前线程已经到达屏障点，当前线程阻塞进入休眠状态，<strong>直到所有线程都到达屏障点</strong>，当前线程才会被唤醒。</li>
</ol>
<p>案例：组队打boss过关卡游戏。</p>
<p><img alt="1562925365024" src="../assets/1562925365024.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CyclicBarrierDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">CyclicBarrier</span> <span class="n">cyclicBarrier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CyclicBarrier</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="p">{</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 过关了&quot;</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始第一关&quot;</span><span class="p">);</span>
                    <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="k">new</span> <span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始打boss&quot;</span><span class="p">);</span>
                    <span class="n">cyclicBarrier</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>

                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始第二关&quot;</span><span class="p">);</span>
                    <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="k">new</span> <span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始打boss&quot;</span><span class="p">);</span>
                    <span class="n">cyclicBarrier</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>

                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始第三关&quot;</span><span class="p">);</span>
                    <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="k">new</span> <span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 开始打boss&quot;</span><span class="p">);</span>
                    <span class="n">cyclicBarrier</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>

                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>输出：</p>
<div class="highlight"><pre><span></span><code>1 开始第一关
2 开始第一关
0 开始第一关
0 开始打boss
2 开始打boss
1 开始打boss
1 过关了
0 开始第二关
2 开始第二关
1 开始第二关
1 开始打boss
0 开始打boss
2 开始打boss
2 过关了
1 开始第三关
2 开始第三关
0 开始第三关
1 开始打boss
0 开始打boss
2 开始打boss
2 过关了
</code></pre></div>
<p><strong>注意：所有的"过关了"都是由最后到达await方法的线程执行打印的</strong></p>
<p>面试：CyclicBarrier和CountDownLatch的区别？</p>
<p>​       CountDownLatch的计数器只能使用一次，而CyclicBarrier的计数器可以使用reset()方法重置，可以使用多次，所以CyclicBarrier能够处理更为复杂的场景；CountDownLatch允许一个或多个线程*<strong>等待一组事件的产生</strong>，而CyclicBarrier用于等待其他线程<strong>运行到栅栏位置</strong>。</p>
<h3 id="53-semaphore">5.3 Semaphore<a class="headerlink" href="#53-semaphore" title="Permanent link">&para;</a></h3>
<p>Semaphore翻译成字面意思为 信号量，Semaphore可以控制同时访问的线程个数。非常适合需求量大，而资源又很紧张的情况。比如给定一个资源数目有限的资源池，假设资源数目为N，每一个线程均可获取一个资源，但是当资源分配完毕时，后来线程需要阻塞等待，直到前面已持有资源的线程释放资源之后才能继续。</p>
<p>常用方法：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="nf">Semaphore</span><span class="p">(</span><span class="kt">int</span> <span class="n">permits</span><span class="p">)</span> <span class="c1">// 构造方法，permits指资源数目（信号量）</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">acquire</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="c1">// 占用资源，当一个线程调用acquire操作时，它要么通过成功获取信号量（信号量减1），要么一直等下去，直到有线程释放信号量，或超时。</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">release</span><span class="p">()</span> <span class="c1">// （释放）实际上会将信号量的值加1，然后唤醒等待的线程。</span>
</code></pre></div>
<p>信号量主要用于两个目的：</p>
<ol>
<li>多个共享资源的互斥使用。</li>
<li>用于并发线程数的控制。保护一个关键部分不要一次输入超过N个线程。</li>
</ol>
<p>案例：6辆车抢占3个车位</p>
<p><img alt="1562925723418" src="../assets/1562925723418.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SemaphoreDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 初始化信号量，3个车位</span>
        <span class="n">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

        <span class="c1">// 6个线程，模拟6辆车</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="c1">// 抢占一个停车位</span>
                    <span class="n">semaphore</span><span class="p">.</span><span class="na">acquire</span><span class="p">();</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 抢到了一个停车位！！&quot;</span><span class="p">);</span>
                    <span class="c1">// 停一会儿车</span>
                    <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="k">new</span> <span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; 离开停车位！！&quot;</span><span class="p">);</span>
                    <span class="c1">// 开走，释放一个停车位</span>
                    <span class="n">semaphore</span><span class="p">.</span><span class="na">release</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>打印结果：</p>
<div class="highlight"><pre><span></span><code>0 抢到了一个停车位！！
1 抢到了一个停车位！！
2 抢到了一个停车位！！
1 离开停车位！！
3 抢到了一个停车位！！
2 离开停车位！！
4 抢到了一个停车位！！
0 离开停车位！！
5 抢到了一个停车位！！
5 离开停车位！！
3 离开停车位！！
4 离开停车位！！
</code></pre></div>
<h2 id="6-callable">第6章 Callable接口<a class="headerlink" href="#6-callable" title="Permanent link">&para;</a></h2>
<p><strong>Thread</strong>类、<strong>Runnable</strong>接口使得多线程编程简单直接。</p>
<p>​       但Thread类和Runnable接口都不允许声明检查型异常，也不能定义返回值。没有返回值这点稍微有点麻烦。不能声明抛出检查型异常则更麻烦一些。</p>
<p>​       <strong>public void run()</strong>方法规范意味着你必须捕获并处理检查型异常。即使你小心捕获异常，也不能保证这个类（Runnable对象）的所有使用者都读取异常信息。</p>
<p>​       以上两个问题现在都得到了解决。从java5开始，提供了Callable接口，是Runable接口的增强版。用Call()方法作为线程的执行体，增强了之前的run()方法。因为call方法可以有返回值，也可以声明抛出异常。</p>
<h3 id="61-callablerunable">6.1 Callable和Runable对比<a class="headerlink" href="#61-callablerunable" title="Permanent link">&para;</a></h3>
<p>先初步认识一下Callable接口：</p>
<p><img alt="1562859167203" src="../assets/1562859167203.png" /></p>
<p>这是一个函数式接口，因此可以用作lambda表达式或方法引用的赋值对象。</p>
<p>具体代码实现对比：创建一个CallableDemo.java</p>
<p><img alt="1562859974320" src="../assets/1562859974320.png" /></p>
<p>内容：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyRunnableThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">MyCallableThread</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">call</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallableDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 创建多线程</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>该如何使用Callable创建Thread对象，如果使用Runnable是：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallableDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 创建多线程</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="k">new</span> <span class="n">MyRunnableThread</span><span class="p">(),</span> <span class="s">&quot;threadName&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>现在能不能直接把MyRunnableThread换成MyCallableThread。当然不行，thread的构造方法参数需要Runnable类型的数据模型，而MyCallableThread属于Callable类型的。</p>
<p>那么到底怎么使用Callable创建thread对象呢？</p>
<h3 id="62-callable">6.2 Callable的使用<a class="headerlink" href="#62-callable" title="Permanent link">&para;</a></h3>
<p>使用步骤：  </p>
<ol>
<li>
<p><strong>创建Callable的实现类</strong>，并重写call()方法，该方法为线程执行体，并且该方法有返回值</p>
</li>
<li>
<p><strong>创建Callable的实例。</strong></p>
</li>
<li>
<p><strong>实例化FutureTask类</strong>，参数为Callable接口实现类的对象，FutureTask封装了Callable对象call()方法的返回值</p>
</li>
<li><strong>创建多线程Thread对象</strong>来启动线程，参数为FutureTask对象。</li>
<li><strong>通过FutureTask类的对象的get()方法来获取线程结束后的返回值</strong></li>
</ol>
<p>这里出现了一个FutureTask，先认识该类，上源码：</p>
<p><img alt="1562861615527" src="../assets/1562861615527.png" /></p>
<p>发现：FutureTask其实充当了一个中间人的角色</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * 1. 创建Callable的实现类，并重写call()方法，该方法为线程执行体，并且该方法有返回值</span>
<span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">MyCallableThread</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">call</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;执行了！&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">200</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallableDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="p">,</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="c1">// 2. 创建Callable的实例，并用FutureTask类来包装Callable对象</span>
        <span class="c1">// 3. 创建FutureTask对象，需要一个Callable类型的参数</span>
        <span class="n">FutureTask</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FutureTask</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MyCallableThread</span><span class="p">());</span>
        <span class="c1">// 4. 创建多线程，由于FutureTask的本质是Runnable的实现类，所以第一个参数可以直接使用task</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="s">&quot;threadName&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="c1">//new Thread(task, &quot;threadName2&quot;).start();</span>

        <span class="cm">/*while (!task.isDone()) {</span>
<span class="cm">            System.out.println(&quot;wait...&quot;);</span>
<span class="cm">        }*/</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; over!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>FutureTask：未来的任务，用它就干一件事，<strong>异步调用。通常用它解决耗时任务，挂起堵塞问题。</strong></p>
<p>在主线程中需要执行比较耗时的操作时，但又不想阻塞主线程时，可以把这些作业交给Future对象在后台完成，当主线程将来需要时，就可以通过Future对象获得后台作业的计算结果或者执行状态。</p>
<p>一般FutureTask多用于耗时的计算，主线程可以在完成自己的任务后，再去获取结果。</p>
<p>FutureTask仅在call方法完成时才能get结果；如果计算尚未完成，则阻塞 get 方法。</p>
<p>一旦计算完成，就不能再重新开始或取消计算。get方法获取结果只有在计算完成时获取，否则会一直阻塞直到任务转入完成状态，然后会返回结果或者抛出异常。 </p>
<p><strong>注意：</strong></p>
<ol>
<li>
<p><strong>为了防止主线程阻塞，建议get方法放到最后</strong></p>
</li>
<li>
<p><strong>只计算一次</strong>，FutureTask会复用之前计算过得结果</p>
</li>
</ol>
<p>创建多个线程，会怎样？</p>
<p><img alt="1562862680071" src="../assets/1562862680071.png" /></p>
<p>运行结果：依然只有一个就是threadName。</p>
<p>如果想打印threadName2的结果，即不想复用之前的计算结果。怎么办？再创建一个FutureTask对象即可。</p>
<h3 id="63">6.3 面试题<a class="headerlink" href="#63" title="Permanent link">&para;</a></h3>
<p><strong>面试题：callable接口与runnable接口的区别？</strong></p>
<p>相同点：<strong>都是接口，都可以编写多线程程序，都采用Thread.start()启动线程</strong></p>
<p>不同点：</p>
<ol>
<li>具体方法不同：一个是run，一个是call</li>
<li>Runnable没有返回值；Callable可以返回执行结果，是个泛型</li>
<li>Callable接口的call()方法允许抛出异常；Runnable的run()方法异常只能在内部消化，不能往上继续抛</li>
<li>它提供了检查计算是否完成的方法，以等待计算的完成，并检索计算的结果。 </li>
</ol>
<p>面试题：获得多线程的方法几种？</p>
<p>​       （1）继承thread类（2）runnable接口</p>
<p>​       如果只回答这两个你连被问到juc的机会都没有 </p>
<p>正确答案如下：</p>
<p>​       传统的是继承thread类和实现runnable接口</p>
<p>​       java5以后又有实现callable接口和java的线程池获得</p>
<h2 id="7-blockingqueue">第7章 阻塞队列（BlockingQueue）<a class="headerlink" href="#7-blockingqueue" title="Permanent link">&para;</a></h2>
<p>栈与队列简单回顾：</p>
<p>栈：先进后出，后进先出</p>
<p>队列：先进先出</p>
<h3 id="71-blockingqueue">7.1 什么是BlockingQueue<a class="headerlink" href="#71-blockingqueue" title="Permanent link">&para;</a></h3>
<p>在多线程领域：所谓<strong>阻塞</strong>，在某些情况下会<strong>挂起线程</strong>（即阻塞），一旦条件满足，被挂起的线程又会自动被唤起</p>
<p>BlockingQueue即阻塞队列，是java.util.concurrent下的一个接口，因此不难理解，BlockingQueue是为了解决多线程中数据高效安全传输而提出的。从阻塞这个词可以看出，在某些情况下对阻塞队列的访问可能会造成阻塞。被阻塞的情况主要有如下两种：</p>
<ol>
<li>
<p><strong>当队列满了的时候进行入队列操作</strong></p>
</li>
<li>
<p><strong>当队列空了的时候进行出队列操作</strong></p>
</li>
</ol>
<p>因此，当一个线程试图对一个已经满了的队列进行入队列操作时，它将会被阻塞，除非有另一个线程做了出队列操作；同样，当一个线程试图对一个空队列进行出队列操作时，它将会被阻塞，除非有另一个线程进行了入队列操作。</p>
<p><strong>阻塞队列主要用在生产者/消费者的场景</strong>，下面这幅图展示了一个线程生产、一个线程消费的场景：</p>
<p><img alt="1562942021825" src="../assets/1562942021825.png" /></p>
<p><strong>为什么需要BlockingQueue</strong>
        好处是我们不需要关心什么时候需要阻塞线程，什么时候需要唤醒线程，因为这一切BlockingQueue都给你一手包办了。在concurrent包发布以前，在多线程环境下，我们每个程序员都必须去自己控制这些细节，尤其还要兼顾效率和线程安全，而这会给我们的程序带来不小的复杂度。</p>
<h3 id="72-blockingqueue">7.2 认识BlockingQueue<a class="headerlink" href="#72-blockingqueue" title="Permanent link">&para;</a></h3>
<p>java.util.concurrent 包里的 BlockingQueue是一个接口，继承Queue接口，Queue接口继承 Collection。</p>
<p><img alt="1562943086619" src="../assets/1562943086619.png" /></p>
<p>BlockingQueue接口主要有以下7个实现类：</p>
<ol>
<li><font color="red">ArrayBlockingQueue：由数组结构组成的有界阻塞队列。</font></li>
<li><font color="red">LinkedBlockingQueue：由链表结构组成的有界（但大小默认值为integer.MAX_VALUE）阻塞队列。</font></li>
<li>PriorityBlockingQueue：支持优先级排序的无界阻塞队列。</li>
<li>DelayQueue：使用优先级队列实现的延迟无界阻塞队列。</li>
<li><font color="red">SynchronousQueue：不存储元素的阻塞队列，也即单个元素的队列。</font></li>
<li>LinkedTransferQueue：由链表组成的无界阻塞队列。</li>
<li>LinkedBlockingDeque：由链表组成的双向阻塞队列。</li>
</ol>
<p>BlockingQueue接口有以下几个方法：</p>
<p><img alt="1562943531362" src="../assets/1562943531362.png" /></p>
<p>它的方法可以分成以下4类：</p>
<table>
<thead>
<tr>
<th></th>
<th>抛出异常</th>
<th>特殊值</th>
<th>阻塞</th>
<th>超时</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>插入</strong></td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e, time, unit)</td>
</tr>
<tr>
<td><strong>移除</strong></td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td><strong>检查</strong></td>
<td>element()</td>
<td>peek()</td>
<td>不可用</td>
<td>不可用</td>
</tr>
</tbody>
</table>
<p><strong>抛出异常</strong></p>
<p>​       add正常执行返回true，element（不删除）和remove返回阻塞队列中的第一个元素
​       当阻塞队列满时，再往队列里add插入元素会抛IllegalStateException:Queue full
​       当阻塞队列空时，再往队列里remove移除元素会抛NoSuchElementException
​       当阻塞队列空时，再调用element检查元素会抛出NoSuchElementException</p>
<p><strong>特定值</strong>
        插入方法，成功ture失败false
        移除方法，成功返回出队列的元素，队列里没有就返回null
        检查方法，成功返回队列中的元素，没有返回null</p>
<p><strong>一直阻塞</strong></p>
<p>​       如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行。
​       当阻塞队列满时，再往队列里put元素，队列会一直阻塞生产者线程直到put数据or响应中断退出
​       当阻塞队列空时，再从队列里take元素，队列会一直阻塞消费者线程直到队列可用</p>
<p><strong>超时退出</strong></p>
<p>​       如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行，但等待时间不会超过给定值。
​       返回一个特定值以告知该操作是否成功(典型的是 true / false)。</p>
<h3 id="73">7.3 代码演示<a class="headerlink" href="#73" title="Permanent link">&para;</a></h3>
<p>创建BlockingQueueDemo类：</p>
<p><img alt="1562944351608" src="../assets/1562944351608.png" /></p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockingQueueDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="c1">// 第一组方法：add remove element</span>
<span class="c1">//        System.out.println(queue.add(&quot;a&quot;));</span>
<span class="c1">//        System.out.println(queue.add(&quot;b&quot;));</span>
<span class="c1">//        System.out.println(queue.add(&quot;c&quot;));</span>
<span class="c1">//        // System.out.println(queue.add(&quot;d&quot;));</span>
<span class="c1">//        // System.out.println(queue.element());</span>
<span class="c1">//        System.out.println(queue.remove());</span>
<span class="c1">//        System.out.println(queue.remove());</span>
<span class="c1">//        System.out.println(queue.remove());</span>
<span class="c1">//        //System.out.println(queue.remove());</span>
<span class="c1">//        //System.out.println(queue.element());</span>
        <span class="c1">// 第二组：offer poll peek</span>
<span class="c1">//        System.out.println(queue.offer(&quot;a&quot;));</span>
<span class="c1">//        System.out.println(queue.offer(&quot;b&quot;));</span>
<span class="c1">//        System.out.println(queue.offer(&quot;c&quot;));</span>
<span class="c1">//        System.out.println(queue.offer(&quot;d&quot;));</span>
<span class="c1">//        System.out.println(queue.peek());</span>
<span class="c1">//        System.out.println(queue.poll());</span>
<span class="c1">//        System.out.println(queue.poll());</span>
<span class="c1">//        System.out.println(queue.poll());</span>
<span class="c1">//        System.out.println(queue.poll());</span>
<span class="c1">//        System.out.println(queue.peek());</span>
        <span class="c1">// 第三组：put take</span>
<span class="c1">//        queue.put(&quot;a&quot;);</span>
<span class="c1">//        queue.put(&quot;b&quot;);</span>
<span class="c1">//        queue.put(&quot;c&quot;);</span>
<span class="c1">//        System.out.println(queue.take());</span>
<span class="c1">//        queue.put(&quot;d&quot;);</span>
<span class="c1">//        System.out.println(queue.take());</span>
<span class="c1">//        System.out.println(queue.take());</span>
<span class="c1">//        System.out.println(queue.take());</span>
        <span class="c1">// 第四组：offer poll</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="8-threadpool">第8章 ThreadPool线程池<a class="headerlink" href="#8-threadpool" title="Permanent link">&para;</a></h2>
<p>例子：
        10年前单核CPU电脑，假的多线程，像马戏团小丑玩多个球，CPU需要来回切换。
        现在是多核电脑，多个线程各自跑在独立的CPU上，不用切换效率高。</p>
<p><strong>线程池的优势：
        线程池做的工作主要是<font color="red">控制运行的线程数量，如果线程数量超过了最大数量，超出数量的线程排队等候</font>，等线程任务执行完毕，再从队列中取出任务来执行。</strong></p>
<p>它的主要特点为：<font color="red">线程复用；控制最大并发数；管理线程。</font></p>
<ol>
<li>降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的销耗。​​</li>
<li>提高响应速度。当任务到达时，任务可以不需要等待线程创建就能立即执行。</li>
<li>提高线程的可管理性。线程是稀缺资源，如果无限制的创建，不仅会销耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。</li>
</ol>
<h3 id="81">8.1 架构说明<a class="headerlink" href="#81" title="Permanent link">&para;</a></h3>
<p>Java中的线程池是通过Executor框架实现的，该框架中用到了Executor，ExecutorService，ThreadPoolExecutor这几个类。</p>
<p><img alt="1562997049227" src="../assets/1562997049227.png" /></p>
<p>Executor接口是顶层接口，只有一个execute方法，过于简单。通常不使用它，而是使用ExecutorService接口：</p>
<p><img alt="1562998979772" src="../assets/1562998979772.png" /></p>
<p>那么问题来了，怎么创建一个连接池对象呢？通常使用Executors工具类</p>
<p>8.2 Executors工具类</p>
<p>架构图可以看到Executors工具类，有没有联想到Collections，Arrays等。没错，可以用它快速创建线程池。</p>
<div class="highlight"><pre><span></span><code><span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="n">ExecutorService</span> <span class="n">threadPool</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newCachedThreadPool</span><span class="p">();</span>
</code></pre></div>
<p><img alt="1562997592723" src="../assets/1562997592723.png" /></p>
<p>直接编码演示：每种连接池的效果</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPoolDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 创建单一线程的连接池</span>
        <span class="c1">// ExecutorService threadPool = Executors.newSingleThreadExecutor();</span>
        <span class="c1">// ExecutorService threadPool = Executors.newFixedThreadPool(3);</span>
        <span class="n">ExecutorService</span> <span class="n">threadPool</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newCachedThreadPool</span><span class="p">();</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">threadPool</span><span class="p">.</span><span class="na">execute</span><span class="p">(()</span><span class="o">-&gt;</span><span class="p">{</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;执行了业务逻辑&quot;</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">threadPool</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>8.3 底层原理</p>
<p>上述案例中的三个方法的本质都是ThreadPoolExecutor的实例化对象，只是具体参数值不同。</p>
<p><img alt="1562999783113" src="../assets/1562999783113.png" /></p>
<h4 id="831-7">8.3.1 线程池的7个重要参数<a class="headerlink" href="#831-7" title="Permanent link">&para;</a></h4>
<p><img alt="1563002258102" src="../assets/1563002258102.png" /></p>
<ol>
<li>corePoolSize：线程池中的常驻核心线程数</li>
<li>maximumPoolSize：线程池中能够容纳同时 执行的最大线程数，此值必须大于等于1</li>
<li>keepAliveTime：多余的空闲线程的存活时间 当前池中线程数量超过corePoolSize时，当空闲时间达到keepAliveTime时，多余线程会被销毁直到 只剩下corePoolSize个线程为止</li>
<li>unit：keepAliveTime的单位 </li>
<li>workQueue：任务队列，被提交但尚未被执行的任务</li>
<li>threadFactory：表示生成线程池中工作线程的线程工厂， 用于创建线程，<strong>一般默认的即可</strong></li>
<li>handler：拒绝策略，表示当队列满了，并且工作线程大于 等于线程池的最大线程数（maximumPoolSize）时，如何来拒绝 请求执行的runnable的策略</li>
</ol>
<p>8.3.2 线程池底层工作原理</p>
<p>具体流程：</p>
<p><img alt="img" src="../assets/2599999-81ce63806c457a4c.png" /></p>
<p>重要的事情说三遍：<font color="red">以下重要：以下重要：以下重要：</font></p>
<ol>
<li>
<p>在创建了线程池后，线程池中的<strong>线程数为零</strong>。</p>
</li>
<li>
<p>当调用execute()方法添加一个请求任务时，线程池会做出如下判断：</p>
</li>
<li>
<p>如果正在运行的线程数量<strong>小于corePoolSize</strong>，那么马上<strong>创建线程</strong>运行这个任务；</p>
</li>
<li>如果正在运行的线程数量<strong>大于或等于corePoolSize</strong>，那么<strong>将这个任务放入队列</strong>；</li>
<li>如果这个时候队列满了且正在运行的线程数量还<strong>小于maximumPoolSize</strong>，那么还是要<strong>创建非核心线程</strong>立刻运行这个任务；</li>
<li>
<p>如果队列满了且正在运行的线程数量<strong>大于或等于maximumPoolSize</strong>，那么线程池会<strong>启动饱和拒绝策略</strong>来执行。</p>
</li>
<li>
<p>当一个线程完成任务时，它会从队列中取下一个任务来执行。</p>
</li>
<li>
<p>当一个线程无事可做超过一定的时间（keepAliveTime）时，线程会判断：</p>
</li>
</ol>
<p>如果当前运行的线程数大于corePoolSize，那么这个线程就被停掉。</p>
<p>所以线程池的所有任务完成后，它最终会收缩到corePoolSize的大小。</p>
<h4 id="833">8.3.3 拒绝策略<a class="headerlink" href="#833" title="Permanent link">&para;</a></h4>
<p>一般我们创建线程池时，为防止资源被耗尽，任务队列都会选择创建有界任务队列，但种模式下如果出现**任务队列已满且线程池创建的线程数达到你设置的最大线程数时**，这时就需要你指定ThreadPoolExecutor的RejectedExecutionHandler参数即合理的拒绝策略，来处理线程池"超载"的情况。</p>
<p>ThreadPoolExecutor自带的拒绝策略如下：</p>
<ol>
<li>AbortPolicy(默认)：直接抛出RejectedExecutionException异常阻止系统正常运行</li>
<li>CallerRunsPolicy：“调用者运行”一种调节机制，该策略既不会抛弃任务，也不会抛出异常，而是将某些任务回退到调用者，从而降低新任务的流量。</li>
<li>DiscardOldestPolicy：抛弃队列中等待最久的任务，然后把当前任务加人队列中 尝试再次提交当前任务。</li>
<li>DiscardPolicy：该策略默默地丢弃无法处理的任务，不予任何处理也不抛出异常。 如果允许任务丢失，这是最好的一种策略。</li>
</ol>
<p><strong>以上内置的策略均实现了RejectedExecutionHandler接口，也可以自己扩展RejectedExecutionHandler接口，定义自己的拒绝策略</strong></p>
<h3 id="84">8.4 自定义线程池<a class="headerlink" href="#84" title="Permanent link">&para;</a></h3>
<p>​       在《阿里巴巴java开发手册》中指出了线程资源必须通过线程池提供，不允许在应用中自行显示的创建线程，这样一方面是线程的创建更加规范，可以合理控制开辟线程的数量；另一方面线程的细节管理交给线程池处理，优化了资源的开销。而线程池不允许使用Executors去创建，而要通过ThreadPoolExecutor方式，这一方面是由于jdk中Executor框架虽然提供了如newFixedThreadPool()、newSingleThreadExecutor()、newCachedThreadPool()等创建线程池的方法，但都有其局限性，不够灵活；使用ThreadPoolExecutor有助于大家明确线程池的运行规则，创建符合自己的业务场景需要的线程池，避免资源耗尽的风险。</p>
<p><img alt="1563004545584" src="../assets/1563004545584.png" /></p>
<p>自定义线程池：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPoolDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 创建单一线程的连接池</span>
        <span class="c1">// ExecutorService threadPool = Executors.newSingleThreadExecutor();</span>
        <span class="c1">// 创建固定数线程的连接池</span>
        <span class="c1">// ExecutorService threadPool = Executors.newFixedThreadPool(3);</span>
        <span class="c1">// 可扩容连接池</span>
        <span class="c1">// ExecutorService threadPool = Executors.newCachedThreadPool();</span>

        <span class="c1">// 自定义连接池</span>
        <span class="n">ExecutorService</span> <span class="n">threadPool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                <span class="n">Executors</span><span class="p">.</span><span class="na">defaultThreadFactory</span><span class="p">(),</span>
                <span class="c1">//new ThreadPoolExecutor.AbortPolicy()</span>
                <span class="c1">//new ThreadPoolExecutor.CallerRunsPolicy()</span>
                <span class="c1">//new ThreadPoolExecutor.DiscardOldestPolicy()</span>
                <span class="c1">//new ThreadPoolExecutor.DiscardPolicy()</span>
                <span class="k">new</span> <span class="n">RejectedExecutionHandler</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rejectedExecution</span><span class="p">(</span><span class="n">Runnable</span> <span class="n">r</span><span class="p">,</span> <span class="n">ThreadPoolExecutor</span> <span class="n">executor</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;自定义拒绝策略&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">threadPool</span><span class="p">.</span><span class="na">execute</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
                    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;执行了业务逻辑&quot;</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">threadPool</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="9">第9章 多线程高并发底层原理<a class="headerlink" href="#9" title="Permanent link">&para;</a></h2>
<p>计算机运行架构图，如下：</p>
<p><img alt="" src="../assets/12353432421345.jpg" /></p>
<p>由于cpu的运行程序速度远大于主存储的速度，所以会在主存RAM和CPU之间加多级高速缓存，缓存的速度接近cpu的运行速度，这样会大大提高计算机的运行速度。</p>
<h3 id="91-javajmm">9.1 java内存模型（JMM）<a class="headerlink" href="#91-javajmm" title="Permanent link">&para;</a></h3>
<p>JMM即为JAVA 内存模型（java memory model）。因为在不同的硬件生产商和不同的操作系统下，内存的访问逻辑有一定的差异，结果就是当你的代码在某个系统环境下运行良好，并且线程安全，但是换了个系统就出现各种问题。Java内存模型，就是为了屏蔽系统和硬件的差异，让一套代码在不同平台下能到达相同的访问结果。JMM从java 5开始的JSR-133发布后，已经成熟和完善起来。</p>
<p><img alt="img" src="../assets/37d3d539b6003af3cf5723e0922230591138b654.png" /></p>
<p>JMM规定了内存主要划分为<strong>主内存</strong>和<strong>工作内存</strong>两种。</p>
<blockquote>
<p><strong>主内存</strong>：保存了所有的变量。
<strong>共享变量</strong>：如果一个变量被多个线程使用，那么这个变量会在每个线程的工作内存中保有一个副本，这种变量就是共享变量。
<strong>工作内存</strong>：每个线程都有自己的工作内存，线程独享，保存了线程用到的变量副本（主内存共享变量的一份拷贝）。工作内存负责与线程交互，也负责与主内存交互。</p>
</blockquote>
<p>此处的主内存和工作内存跟JVM内存划分（堆、栈、方法区）是在不同的维度上进行的，如果非要对应起来，主内存对应的是Java堆中的对象实例部分，工作内存对应的是栈中的部分区域，从更底层的来说，<strong>主内存对应的是硬件的物理内存，工作内存对应的是寄存器和高速缓存</strong>。</p>
<p>JMM对共享内存的操作做出了如下两条规定：</p>
<blockquote>
<ul>
<li>线程对共享内存的所有操作都必须在自己的工作内存中进行，不能直接从主内存中读写；</li>
<li>不同线程无法直接访问其他线程工作内存中的变量，因此共享变量的值传递需要通过主内存完成。</li>
</ul>
</blockquote>
<p>内存模型的三大特性：</p>
<ul>
<li>
<p><strong>原子性：</strong>即不可分割性。比如 a=0；（a非long和double类型） 这个操作是不可分割的，那么我们说这个操作是原子操作。再比如：a++； 这个操作实际是a = a + 1；是可分割的，所以他不是一个原子操作。非原子操作都会存在线程安全问题，需要使用同步技术（sychronized）或者锁（Lock）来让它变成一个原子操作。一个操作是原子操作，那么我们称它具有原子性。java的concurrent包下提供了一些原子类，我们可以通过阅读API来了解这些原子类的用法。比如：AtomicInteger、AtomicLong、AtomicReference等。</p>
</li>
<li>
<p><strong>可见性：</strong>每个线程都有自己的工作内存，所以当某个线程修改完某个变量之后，在其他的线程中，未必能观察到该变量已经被修改。在 Java 中 volatile、synchronized 和 final 实现可见性。volatile只能让被他修饰内容具有可见性，但不能保证它具有原子性。</p>
</li>
<li>
<p><strong>有序性：</strong>java的有序性跟线程相关。一个线程内部所有操作都是有序的，如果是多个线程所有操作都是无序的。因为JMM的工作内存和主内存之间存在延迟，而且java会对一些指令进行重新排序。volatile和synchronized可以保证程序的有序性，很多程序员只理解这两个关键字的执行互斥，而没有很好的理解到volatile和synchronized也能保证指令不进行重排序。</p>
</li>
</ul>
<h3 id="92-volatile">9.2 volatile关键字<a class="headerlink" href="#92-volatile" title="Permanent link">&para;</a></h3>
<h4 id="921">9.2.1 验证可见性<a class="headerlink" href="#921" title="Permanent link">&para;</a></h4>
<p>验证volatile关键字保证内存可见性：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VolatileDemo</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Integer</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>  <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;我是子线程工作内存flag的值：&quot;</span> <span class="o">+</span> <span class="n">flag</span><span class="p">);</span>
                <span class="k">while</span><span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
                <span class="p">}</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;子线程操作结束...&quot;</span> <span class="o">+</span> <span class="n">flag</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="na">start</span><span class="p">();</span>
        <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;我是主线程工作内存flag的值：&quot;</span> <span class="o">+</span> <span class="n">flag</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>这是没有添加volatile关键字，打印效果如下：</p>
<p><img alt="1595131719599" src="../assets/1595131719599.png" /></p>
<p>子线程读取不到主线程修改后的flag值，陷入死循环程序无法结束。</p>
<p>接下来添加volatile关键字再试试：</p>
<p><img alt="1595131854559" src="../assets/1595131854559.png" /></p>
<p>打印结果如下：子线程可以读取的新值并结束子线程</p>
<p><img alt="1595132060909" src="../assets/1595132060909.png" /></p>
<h4 id="922">9.2.2 验证有序性<a class="headerlink" href="#922" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VolatileOrderDemo</span> <span class="p">{</span>

    <span class="kd">static</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
    <span class="kd">static</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>

        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">){</span>
            <span class="n">i</span><span class="o">++</span><span class="p">;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
            <span class="p">},</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
            <span class="n">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
                <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="p">},</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

            <span class="n">thread1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
            <span class="n">thread2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>

            <span class="n">thread1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
            <span class="n">thread2</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;次打印：x=&quot;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot;, y=&quot;</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>正常情况下：如果thread1先执行，xy的值是[0, 1]；如果thread2先执行是[1, 0]。</p>
<p>如果出现[0, 0]，则说明进行了指令重排。</p>
<p><img alt="1597722920432" src="../assets/1597722920432.png" /></p>
<p>给a, b添加volatile关键字</p>
<p><img alt="1597722989205" src="../assets/1597722989205.png" /></p>
<h4 id="923">9.2.3 验证不具备原子性<a class="headerlink" href="#923" title="Permanent link">&para;</a></h4>
<p>编写如下程序：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">DataOne</span><span class="p">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">incr</span><span class="p">(){</span>
        <span class="k">return</span> <span class="o">++</span><span class="n">number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VolatileAtomicDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">DataOne</span> <span class="n">dataOne</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOne</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dataOne</span><span class="p">.</span><span class="na">incr</span><span class="p">());</span>
            <span class="p">}).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>执行效果如下：</p>
<p><img alt="1595139693744" src="../assets/1595139693744.png" /></p>
<p>1000个线程执行++number操作，如果++number操作具备原子性，最后的值应该是1000。说明++number<strong>不具备原子性</strong>。</p>
<p>接下来，给number添加volatile关键字：</p>
<p><img alt="1595139881680" src="../assets/1595139881680.png" /></p>
<p>测试结果依然不是1000，如下：</p>
<p><img alt="1595139950199" src="../assets/1595139950199.png" /></p>
<p>说明volatile关键字不能保证原子性。</p>
<p>给incr方法添加同步锁试试：</p>
<p><img alt="1595140034590" src="../assets/1595140034590.png" /></p>
<p>测试：</p>
<p><img alt="1595140073777" src="../assets/1595140073777.png" /></p>
<p>效果完美！</p>
<h4 id="924-volatile">9.2.4 volatile原理<a class="headerlink" href="#924-volatile" title="Permanent link">&para;</a></h4>
<p>Java语言提供了一种稍弱的同步机制，即volatile变量，用来确保将变量的更新操作通知到其他线程。当把变量声明为volatile类型后，编译器与运行时都会注意到这个变量是共享的，因此不会将该变量上的操作与其他内存操作一起重排序。</p>
<p><strong>在访问volatile变量时不会执行加锁操作，因此也就不会使执行线程阻塞，因此volatile变量是一种比sychronized关键字更轻量级的同步机制。</strong></p>
<p>当一个变量定义为 volatile 之后，将具备两种特性：</p>
<ul>
<li>
<p>保证此变量对所有的线程的可见性。</p>
</li>
<li>
<p>禁止指令重排序优化。有volatile修饰的变量，赋值后多执行了一个“load addl $0x0, (%esp)”操作，这个操作相当于一个<strong>内存屏障</strong>（指令重排序时不能把后面的指令重排序到内存屏障之前的位置），只有一个CPU访问内存时，并不需要内存屏障。</p>
</li>
<li>不保证变量的原子性</li>
</ul>
<p>volatile 性能：volatile 的读性能消耗与普通变量几乎相同，但是写操作稍慢，因为它需要在本地代码中插入许多内存屏障指令来保证处理器不发生乱序执行。</p>
<h4 id="925-happen-before">9.2.5 Happen-Before（了解）<a class="headerlink" href="#925-happen-before" title="Permanent link">&para;</a></h4>
<p>在常规的开发中，如果我们通过上述规则来分析一个并发程序是否安全，估计脑壳会很疼。因为更多时候，我们是分析一个并发程序是否安全，其实都依赖Happen-Before原则进行分析。Happen-Before被翻译成<strong>先行发生原则</strong>，意思就是当A操作先行发生于B操作，则在发生B操作的时候，操作A产生的影响能被B观察到，“影响”包括修改了内存中的共享变量的值、发送了消息、调用了方法等。</p>
<p>Happen-Before的规则有以下几条：</p>
<ol>
<li>程序次序规则（Program Order Rule）：在一个线程内，程序的执行规则跟程序的书写规则是一致的，从上往下执行。</li>
<li>管程锁定规则（Monitor Lock Rule）：一个Unlock的操作肯定先于下一次Lock的操作。这里必须是同一个锁。同理我们可以认为在synchronized同步同一个锁的时候，锁内先行执行的代码，对后续同步该锁的线程来说是完全可见的。</li>
<li>volatile变量规则（volatile Variable Rule）：<strong>对同一个volatile的变量，先行发生的写操作，肯定早于后续发生的读操作</strong></li>
<li>线程启动规则（Thread Start Rule）：Thread对象的start()方法先行发生于此线程的没一个动作</li>
<li>线程中止规则（Thread Termination Rule）：Thread对象的中止检测（如：Thread.join()，Thread.isAlive()等）操作，必行晚于线程中所有操作</li>
<li>线程中断规则（Thread Interruption Rule）：对线程的interruption（）调用，先于被调用的线程检测中断事件(Thread.interrupted())的发生</li>
<li>对象中止规则（Finalizer Rule）：一个对象的初始化方法先于一个方法执行Finalizer()方法</li>
<li>传递性（Transitivity）：如果操作A先于操作B、操作B先于操作C,则操作A先于操作C</li>
</ol>
<p>以上这些规则保障了happen-before的顺序，如果不符合以上规则，那么在多线程环境下就不能保证执行顺序等同于代码顺序。通过这些条件的判定，仍然很难判断一个线程是否能安全执行，线程安全多数依赖于工具类的安全性来保证。想提高自己对线程是否安全的判断能力，必然需要理解所使用的框架或者工具的实现，并积累线程安全的经验。</p>
<h3 id="93-cas">9.3 CAS<a class="headerlink" href="#93-cas" title="Permanent link">&para;</a></h3>
<p>CAS：Compare and Swap。比较并交换的意思。CAS操作有3个基本参数：内存地址A，旧值B，新值C。它的作用是将指定内存地址A的内容与所给的旧值B相比，如果相等，则将其内容替换为指令中提供的新值C；如果不等，则更新失败。类似于修改登陆密码的过程。当用户输入的原密码和数据库中存储的原密码相同，才可以将原密码更新为新密码，否则就不能更新。</p>
<p><strong>CAS是解决多线程并发安全问题的一种乐观锁算法。</strong>因为它在对共享变量更新之前，会先比较当前值是否与更新前的值一致，如果一致则更新，如果不一致则循环执行（称为自旋锁），直到当前值与更新前的值一致为止，才执行更新。</p>
<p>Unsafe类是CAS的核心类，提供<strong>硬件级别的原子操作</strong>（目前所有CPU基本都支持硬件级别的CAS操作）。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 对象、对象的属性地址偏移量、预期值、修改值</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">compareAndSwapInt</span><span class="p">(</span><span class="n">Object</span> <span class="n">var1</span><span class="p">,</span> <span class="kt">long</span> <span class="n">var2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">var4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">var5</span><span class="p">);</span>
</code></pre></div>
<p>Unsafe简单demo：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnsafeDemo</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">NoSuchFieldException</span><span class="p">,</span> <span class="n">IllegalAccessException</span> <span class="p">{</span>
        <span class="n">UnsafeDemo</span> <span class="n">unsafeDemo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UnsafeDemo</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">unsafeDemo</span><span class="p">.</span><span class="na">number</span><span class="p">);</span><span class="c1">// 修改前</span>
        <span class="n">unsafeDemo</span><span class="p">.</span><span class="na">compareAndSwap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">unsafeDemo</span><span class="p">.</span><span class="na">number</span><span class="p">);</span><span class="c1">// 修改后</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">compareAndSwap</span><span class="p">(</span><span class="kt">int</span> <span class="n">oldValue</span><span class="p">,</span> <span class="kt">int</span> <span class="n">newValue</span><span class="p">){</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// 通过反射获取Unsafe类中的theUnsafe对象</span>
            <span class="n">Field</span> <span class="n">theUnsafe</span> <span class="o">=</span> <span class="n">Unsafe</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&quot;theUnsafe&quot;</span><span class="p">);</span>
            <span class="n">theUnsafe</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// 设置为可见</span>
            <span class="n">Unsafe</span> <span class="n">unsafe</span> <span class="o">=</span> <span class="p">(</span><span class="n">Unsafe</span><span class="p">)</span> <span class="n">theUnsafe</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> <span class="c1">// 获取Unsafe对象</span>
            <span class="c1">// 获取number的偏移量</span>
            <span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">unsafe</span><span class="p">.</span><span class="na">objectFieldOffset</span><span class="p">(</span><span class="n">UnsafeDemo</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">));</span>
            <span class="c1">// cas操作</span>
            <span class="n">unsafe</span><span class="p">.</span><span class="na">compareAndSwapInt</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">oldValue</span><span class="p">,</span> <span class="n">newValue</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">NoSuchFieldException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IllegalAccessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="931">9.3.1 基本代码演示<a class="headerlink" href="#931" title="Permanent link">&para;</a></h4>
<p>在JUC下有个atomic包，有很多原子操作的包装类：</p>
<p><img alt="1595168900123" src="../assets/1595168900123.png" /></p>
<p>这里以AtomicInteger这个类来演示：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CasDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">AtomicInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第一次更新：&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="na">compareAndSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第一次更新后i的值：&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第二次更新：&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="na">compareAndSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第二次更新后i的值：&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第三次更新：&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="na">compareAndSet</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;第三次更新后i的值：&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>输出结果如下：</p>
<div class="highlight"><pre><span></span><code>第一次更新：true
第一次更新后i的值：200
第二次更新：false
第二次更新后i的值：200
第三次更新：true
第三次更新后i的值：300
</code></pre></div>
<p>结果分析：</p>
<div class="highlight"><pre><span></span><code>第一次更新：i的值（1）和预期值（1）相同，所以执行了更新操作，把i的值更新为200
第二次更新：i的值（200）和预期值（1）不同，所以不再执行更新操作
第三次更新：i的值（200）和预期值（1）相同，所以执行了更新操作，把i的值更新为300
</code></pre></div>
<h4 id="932">9.3.2 验证原子性<a class="headerlink" href="#932" title="Permanent link">&para;</a></h4>
<p>还是改造之前的验证volatile关键字的案例如下：</p>
<p><img alt="1595170303332" src="../assets/1595170303332.png" /></p>
<p>测试结果如下：</p>
<p><img alt="1595170398079" src="../assets/1595170398079.png" /></p>
<p>也很完美！</p>
<h4 id="933">9.3.3 缺点<a class="headerlink" href="#933" title="Permanent link">&para;</a></h4>
<p><strong>开销大</strong>：在并发量比较高的情况下，如果反复尝试更新某个变量，却又一直更新不成功，会给CPU带来较大的压力</p>
<p><strong>ABA问题</strong>：当变量从A修改为B再修改回A时，变量值等于期望值A，但是无法判断是否修改，CAS操作在ABA修改后依然成功。 </p>
<p><strong>不能保证代码块的原子性</strong>：CAS机制所保证的只是一个变量的原子性操作，而不能保证整个代码块的原子性。</p>
<h3 id="94-aqs">9.4 AQS<a class="headerlink" href="#94-aqs" title="Permanent link">&para;</a></h3>
<p>AbstractQueuedSynchronizer抽象队列同步器简称AQS，它是实现同步器的基础组件（框架），juc下面Lock的实现以及一些并发工具类（Semaphore、CountDownLatch、CyclicBarrier等）就是通过AQS来实现的。具体用法是通过继承AQS实现其模板方法，然后将子类作为同步组件的内部类。</p>
<p>9.4.1 框架结构</p>
<p>AQS框架结构如下：</p>
<p><img alt="img" src="../assets/10431632-7d2aa48b9b217bbe.jpg" /></p>
<p>AQS维护了一个volatile语义(支持多线程下的可见性)的共享资源变量**state**和一个FIFO（first-in-first-out）<strong>线程等待队列</strong>(多线程竞争state资源被阻塞时，会进入此队列)。</p>
<h4 id="942-aqs">9.4.2 基于AQS实现锁的思路<a class="headerlink" href="#942-aqs" title="Permanent link">&para;</a></h4>
<p>AQS将大部分的同步逻辑均已经实现好，继承的自定义同步器只需要实现state的获取(acquire)和释放(release)的逻辑代码就可以，主要包括下面方法：</p>
<ul>
<li>tryAcquire(int)：独占方式。尝试获取资源，成功则返回true，失败则返回false。</li>
<li>tryRelease(int)：独占方式。尝试释放资源，成功则返回true，失败则返回false。</li>
<li>tryAcquireShared(int)：共享方式。尝试获取资源。负数表示失败；0表示成功，但没有剩余可用资源；正数表示成功，且有剩余资源。</li>
<li>tryReleaseShared(int)：共享方式。尝试释放资源，如果释放后允许唤醒后续等待结点返回true，否则返回false。</li>
<li>isHeldExclusively()：该线程是否正在独占资源。只有用到condition才需要去实现它。</li>
</ul>
<p>也就是说：</p>
<p>​       通过AQS可以实现独占锁（只有一个线程可以获取到锁，如：ReentrantLock），也可以实现共享锁（多个线程都可以获取到锁Semaphore/CountDownLatch等）</p>
<h4 id="943-aqs">9.4.3 基于AQS实现独占锁<a class="headerlink" href="#943-aqs" title="Permanent link">&para;</a></h4>
<p>jdk官方文档给出了使用案例：</p>
<p><img alt="1595502744412" src="../assets/1595502744412.png" /></p>
<p>把jdk文档中的案例copy到我们工程中：</p>
<p><img alt="1595506276170" src="../assets/1595506276170.png" /></p>
<p>就可以直接使用了：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AqsDemo</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>

        <span class="n">DataThree</span> <span class="n">dataThree</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataThree</span><span class="p">();</span>
        <span class="n">CountDownLatch</span> <span class="n">countDownLatch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
                <span class="n">dataThree</span><span class="p">.</span><span class="na">incr</span><span class="p">();</span>
                <span class="n">countDownLatch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
            <span class="p">},</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">countDownLatch</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dataThree</span><span class="p">.</span><span class="na">getNum</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">DataThree</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">num</span><span class="p">;</span>
    <span class="n">Mutex</span> <span class="n">mutex</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mutex</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">incr</span><span class="p">(){</span>
        <span class="n">mutex</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">num</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">mutex</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNum</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">num</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>测试效果如下：</p>
<p><img alt="1595503660735" src="../assets/1595503660735.png" /></p>
<h4 id="944-reentrantlock">9.4.4 ReentrantLock底层原理<a class="headerlink" href="#944-reentrantlock" title="Permanent link">&para;</a></h4>
<p>接下来就以ReetrantLock为例，说明AQS在锁底层的应用。</p>
<p><img alt="1595507428796" src="../assets/1595507428796.png" /></p>
<p>在ReentrantLock类中包含了3个AQS的实现类：</p>
<ol>
<li>抽象类Sync</li>
<li>非公平锁实现类NonfaireSync</li>
<li>公平锁实现类FairSync</li>
</ol>
<p>在ReetrantLock的源码中可以发现：</p>
<p><img alt="1595508265596" src="../assets/1595508265596.png" /></p>
<h4 id="9441-sync">9.4.4.1 Sync抽象类<a class="headerlink" href="#9441-sync" title="Permanent link">&para;</a></h4>
<p>内部方法主要包括：</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * 自定义方法：为非公平锁的实现提供快捷路径</span>
<span class="cm"> */</span>
<span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">lock</span><span class="p">();</span>

<span class="cm">/**</span>
<span class="cm"> * 自定义通用方法，两个子类的tryAcquire方法都需要使用非公平的trylock方法</span>
<span class="cm"> */</span>
<span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">nonfairTryAcquire</span><span class="p">(</span><span class="kt">int</span> <span class="n">acquires</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">Thread</span> <span class="n">current</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getState</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 如果当前线程没有获取到锁</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">compareAndSetState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">acquires</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// 则CAS获取锁</span>
            <span class="n">setExclusiveOwnerThread</span><span class="p">(</span><span class="n">current</span><span class="p">);</span> <span class="c1">// 并把当前线程设置为拥有排他访问权限</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="o">==</span> <span class="n">getExclusiveOwnerThread</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// 如果当前线程已经拥有锁，则重入</span>
        <span class="kt">int</span> <span class="n">nextc</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">acquires</span><span class="p">;</span> <span class="c1">// 每重入一次stat累加acquires</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nextc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// overflow</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;Maximum lock count exceeded&quot;</span><span class="p">);</span>
        <span class="n">setState</span><span class="p">(</span><span class="n">nextc</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * 实现AQS的释放锁方法</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">tryRelease</span><span class="p">(</span><span class="kt">int</span> <span class="n">releases</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getState</span><span class="p">()</span> <span class="o">-</span> <span class="n">releases</span><span class="p">;</span> <span class="c1">// 每释放一次stat就减releases</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">()</span> <span class="o">!=</span> <span class="n">getExclusiveOwnerThread</span><span class="p">())</span> <span class="c1">// 当前线程不是有锁线程抛异常</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalMonitorStateException</span><span class="p">();</span>
    <span class="kt">boolean</span> <span class="n">free</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// stat减为0则释放锁</span>
        <span class="n">free</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">setExclusiveOwnerThread</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">setState</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">free</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">protected</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">isHeldExclusively</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// While we must in general read state before owner,</span>
    <span class="c1">// we don&#39;t need to do so to check if current thread is owner</span>
    <span class="k">return</span> <span class="n">getExclusiveOwnerThread</span><span class="p">()</span> <span class="o">==</span> <span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="9442-nonfairsync">9.4.4.2 NonfairSync<a class="headerlink" href="#9442-nonfairsync" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Sync object for non-fair locks</span>
<span class="cm"> */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">NonfairSync</span> <span class="kd">extends</span> <span class="n">Sync</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">7316153563782823691L</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Performs lock.  Try immediate barge, backing up to normal</span>
<span class="cm">     * acquire on failure.</span>
<span class="cm">     */</span>
    <span class="kd">final</span> <span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">compareAndSetState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">// CAS把stat设置为1</span>
            <span class="n">setExclusiveOwnerThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">());</span> <span class="c1">// 获取到锁</span>
        <span class="k">else</span>
            <span class="n">acquire</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> 
    <span class="p">}</span>

    <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">tryAcquire</span><span class="p">(</span><span class="kt">int</span> <span class="n">acquires</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">nonfairTryAcquire</span><span class="p">(</span><span class="n">acquires</span><span class="p">);</span> <span class="c1">// 使用了Sync抽象类的nonfairTryAcquire方法</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>acquire(1)方法是AQS自己实现的本质就是调用tryAcquire方法，如果tryAcquire获取到锁并无法进入等待队列则中止线程。</p>
<p><img alt="1595508846363" src="../assets/1595508846363.png" /></p>
<h4 id="9443-fairsync">9.4.4.3 FairSync<a class="headerlink" href="#9443-fairsync" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Sync object for fair locks</span>
<span class="cm"> */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FairSync</span> <span class="kd">extends</span> <span class="n">Sync</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3000897897090466540L</span><span class="p">;</span>

    <span class="kd">final</span> <span class="kt">void</span> <span class="nf">lock</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">acquire</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Fair version of tryAcquire.  Don&#39;t grant access unless</span>
<span class="cm">     * recursive call or no waiters or is first.</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">tryAcquire</span><span class="p">(</span><span class="kt">int</span> <span class="n">acquires</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">Thread</span> <span class="n">current</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getState</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hasQueuedPredecessors</span><span class="p">()</span> <span class="o">&amp;&amp;</span>  <span class="c1">// 从线程有序等待队列中获取等待</span>
                <span class="n">compareAndSetState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">acquires</span><span class="p">))</span> <span class="p">{</span> 
                <span class="n">setExclusiveOwnerThread</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="o">==</span> <span class="n">getExclusiveOwnerThread</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// 可重入</span>
            <span class="kt">int</span> <span class="n">nextc</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">acquires</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nextc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;Maximum lock count exceeded&quot;</span><span class="p">);</span>
            <span class="n">setState</span><span class="p">(</span><span class="n">nextc</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>hasQueuedPredecessors具体实现如下：</p>
<p><img alt="1595510443214" src="../assets/1595510443214.png" /></p>
<ol>
<li>当等待队列只有一个线程时，直接获取到锁</li>
<li>如果队列不止一个线程，并且下一个线程就是当前申请锁的线程，则获取锁</li>
</ol>
<h3 id="95">9.5 各种锁<a class="headerlink" href="#95" title="Permanent link">&para;</a></h3>
<p>synchronized：偏向锁（偏向第一个线程，效率最高） ---&gt; 如果有线程竞争升级为轻量级锁（自旋锁） ---&gt; 自旋10次升级为重量级锁（悲观锁）</p>

              
			  <hr><span id="busuanzi_container_page_pv"><font size="3" color="grey">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</font></span><br/>
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../git/Git%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7/" class="md-footer__link md-footer__link--prev" aria-label="Previous: git" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              git
            </div>
          </div>
        </a>
      
      
        
        <a href="../../jvm/jvm/" class="md-footer__link md-footer__link--next" aria-label="Next: jvm" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              jvm
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 尚硅谷
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>