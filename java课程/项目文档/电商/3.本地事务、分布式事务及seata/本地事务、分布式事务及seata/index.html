
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>谷粒商城03 - 我的文档</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="我的文档" class="md-header__button md-logo" aria-label="我的文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            我的文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              谷粒商城03
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/01%20Java%E6%A6%82%E8%BF%B0/01%20-%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/" class="md-tabs__link md-tabs__link--active">
        Java课程
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC1%E7%AB%A0%20%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/" class="md-tabs__link">
        Java就业面试
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      学习文档
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="我的文档" class="md-nav__button md-logo" aria-label="我的文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    我的文档
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Java课程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java课程" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Java课程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Java基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java基础" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Java基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_1" type="checkbox" id="__nav_1_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1_1">
          基础部分
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="基础部分" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_1">
          <span class="md-nav__icon md-icon"></span>
          基础部分
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/01%20Java%E6%A6%82%E8%BF%B0/01%20-%20Java%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        Java概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/02%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/02%20%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        基本语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/03%20%E6%95%B0%E7%BB%84/03%20%E6%95%B0%E7%BB%84/" class="md-nav__link">
        数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/04%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/04%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        面向对象
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86/05%20%E5%BC%82%E5%B8%B8/05%20%E5%BC%82%E5%B8%B8/" class="md-nav__link">
        异常
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1_2" type="checkbox" id="__nav_1_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1_2">
          高级部分
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="高级部分" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          高级部分
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/06%20%E5%B8%B8%E7%94%A8%E7%B1%BBAPI/06%20%E5%B8%B8%E7%94%A8%E7%B1%BBAPI/" class="md-nav__link">
        常用类API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/07%20%E9%9B%86%E5%90%88/07%20%E9%9B%86%E5%90%88/" class="md-nav__link">
        集合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/08%20%E6%B3%9B%E5%9E%8B/08%20%E6%B3%9B%E5%9E%8B/" class="md-nav__link">
        泛型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/09%20File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/09%20File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" class="md-nav__link">
        File类与IO流
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/10%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/10%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        网络编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/11%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/11%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/12%20%E5%8F%8D%E5%B0%84/12%20%E5%8F%8D%E5%B0%84/" class="md-nav__link">
        反射
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/%E9%AB%98%E7%BA%A7%E9%83%A8%E5%88%86/13%20Java8%E6%96%B0%E7%89%B9%E6%80%A7/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" class="md-nav__link">
        Java8新特性
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          MySQL数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MySQL数据库" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          MySQL数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/MySQL5.7%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3/" class="md-nav__link">
        MySQL5.7安装文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/MySQL%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        MySQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/14%20MySQL/JDBC%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        JDBC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          JavaWeb阶段
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="JavaWeb阶段" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          JavaWeb阶段
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day01/day01_HTML%26CSS/" class="md-nav__link">
        HTML&CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day02/day02_JS%26%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="md-nav__link">
        JS&正则表达式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day03/day03_VUE%26%E4%B9%A6%E5%9F%8E%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        VUE&书城第一阶段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day04/day04_XML%26Tomcat%26Http%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        XML&Tomcat&Http协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day05/day05_Servlet/" class="md-nav__link">
        Servlet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day06/day06_Request%26Response/" class="md-nav__link">
        Request&Response
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day07/day07_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第二阶
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day08/day08_Thymeleaf/" class="md-nav__link">
        Thymeleaf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day09/day09_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第三阶段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day10/day10_%E4%BC%9A%E8%AF%9D%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%281%29/" class="md-nav__link">
        会话&书城项目第四阶段1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day11/day11_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第四阶段2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day12/day12_Filter%26Listener%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        Filter&Listener&书城项目第五阶段1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day13/day13_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        书城项目第五阶段2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../JavaWeb%E9%98%B6%E6%AE%B5/day14/day14_Ajax%26Axios%26%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%85%AD%E9%98%B6%E6%AE%B5/" class="md-nav__link">
        Ajax&Axios&书城项目第六阶段
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          经典框架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="经典框架" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          经典框架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Spring%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Spring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/SpringMVC%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        SpringMVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/MyBatis%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        MyBatis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/SSM%20%E6%95%B4%E5%90%88%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        SSM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Maven%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        Maven
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/%E6%A1%86%E6%9E%B6%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%B3%BB%E5%88%97%E4%B9%8BLinuxCentOS7/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E7%BB%8F%E5%85%B8%E6%A1%86%E6%9E%B6/Redis/" class="md-nav__link">
        Redis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" type="checkbox" id="__nav_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_5">
          微服务相关
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="微服务相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          微服务相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/Docker/Docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/ElasticSearch/ElasticSearch/" class="md-nav__link">
        ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/RabbitMQ/RabbitMQ/" class="md-nav__link">
        RabbitMQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/SpringBoot/SpringBoot/" class="md-nav__link">
        SpringBoot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/SpringCloud/SpringCloud/" class="md-nav__link">
        SpringCloud
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_6">
          高级技术
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="高级技术" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          高级技术
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/git/Git%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/juc/JUC/" class="md-nav__link">
        JUC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/jvm/jvm/" class="md-nav__link">
        jvm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/mysql%E9%AB%98%E7%BA%A7/MySQL%E9%AB%98%E7%BA%A7/" class="md-nav__link">
        mysql高级
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/mysql%E9%AB%98%E7%BA%A7/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="md-nav__link">
        MySQL主从复制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/MyCat/Mycat/" class="md-nav__link">
        MyCat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/nginx/Nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7" type="checkbox" id="__nav_1_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7">
          项目文档
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="项目文档" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_7">
          <span class="md-nav__icon md-icon"></span>
          项目文档
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_1" type="checkbox" id="__nav_1_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_1">
          美年旅游
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="美年旅游" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_1">
          <span class="md-nav__icon md-icon"></span>
          美年旅游
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day01/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC1%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游01
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day02/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC2%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游02
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day03/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC3%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游03
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day04/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC4%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day05/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC5%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游05
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day06/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC6%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游06
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day07/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC7%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游07
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day08/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC8%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游08
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day09/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC9%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游09
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day10/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC10%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BE%8E%E5%B9%B4/day11/%E7%BE%8E%E5%B9%B4%E5%9B%BD%E5%AE%BE%E9%A1%B9%E7%9B%AE%E8%AE%B2%E4%B9%89%EF%BC%88%E7%AC%AC11%E7%AB%A0%EF%BC%89/" class="md-nav__link">
        美年旅游11
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_2" type="checkbox" id="__nav_1_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_2">
          尚邻网
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚邻网" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_2">
          <span class="md-nav__icon md-icon"></span>
          尚邻网
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/1.%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/" class="md-nav__link">
        搭建环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/2.%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86/" class="md-nav__link">
        用户角色管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/3.Apache%20Dubbo/" class="md-nav__link">
        Apache Dubbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/4.%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86/" class="md-nav__link">
        服务拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/5.%E4%BA%8C%E6%89%8B%E6%88%BF%E7%AE%A1%E7%90%86/" class="md-nav__link">
        二手房管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/6.%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/" class="md-nav__link">
        图片上传
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/7.%E5%89%8D%E7%AB%AF%E6%88%BF%E6%BA%90%E5%B1%95%E7%A4%BA/" class="md-nav__link">
        前端房源展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/8.%E5%89%8D%E7%AB%AF%E7%99%BB%E5%BD%95%E4%B8%8E%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%85%B3%E6%B3%A8/" class="md-nav__link">
        前端登录与注册与关注
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/9.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" class="md-nav__link">
        权限管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/10.spring%20security/" class="md-nav__link">
        spring security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E9%82%BB%E7%BD%91/11.session%E5%85%B1%E4%BA%AB/" class="md-nav__link">
        session共享
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_3" type="checkbox" id="__nav_1_7_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_3">
          谷粒商城
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="谷粒商城" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_3">
          <span class="md-nav__icon md-icon"></span>
          谷粒商城
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88nginx%E3%80%81cors%E3%80%81oss%EF%BC%89/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        谷粒商城01
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%E5%88%86%E7%B1%BB%E3%80%81%E8%A7%84%E6%A0%BC%E3%80%81%E5%95%86%E5%93%81%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/" class="md-nav__link">
        谷粒商城02
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          谷粒商城03
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        谷粒商城03
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 本地事务
  </a>
  
    <nav class="md-nav" aria-label="1. 本地事务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1. 基本概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2. 隔离级别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3. 相关命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4. 传播行为
  </a>
  
    <nav class="md-nav" aria-label="1.4. 传播行为">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141" class="md-nav__link">
    1.4.1. 伪代码练习
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142" class="md-nav__link">
    1.4.2. 改造商品新增代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-1service-requires_new" class="md-nav__link">
    1.4.3. 测试1：同一service + requires_new
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-2service-requires_new" class="md-nav__link">
    1.4.4. 测试2：不同service + requires_new
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-service" class="md-nav__link">
    1.4.5. 在同一个service中使用传播行为
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    1.5. 回滚策略
  </a>
  
    <nav class="md-nav" aria-label="1.5. 回滚策略">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151" class="md-nav__link">
    1.5.1. 测试编译时异常不回滚
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152" class="md-nav__link">
    1.5.2. 定制回滚策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    1.6. 超时事务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17" class="md-nav__link">
    1.7. 只读事务
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 分布式事务理论
  </a>
  
    <nav class="md-nav" aria-label="2. 分布式事务理论">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1. 分布式事务基础
  </a>
  
    <nav class="md-nav" aria-label="2.1. 分布式事务基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-cap" class="md-nav__link">
    2.1.1. CAP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-base" class="md-nav__link">
    2.1.2. BASE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2.   分布式事务解决方案
  </a>
  
    <nav class="md-nav" aria-label="2.2.   分布式事务解决方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-2pc" class="md-nav__link">
    2.2.1. 两阶段提交（2PC）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-tcc" class="md-nav__link">
    2.2.2. TCC补偿式事务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    2.2.3. 消息事务+最终一致性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-seata" class="md-nav__link">
    3. 分布式事务框架-seata
  </a>
  
    <nav class="md-nav" aria-label="3. 分布式事务框架-seata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1. 结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2. 快速入门
  </a>
  
    <nav class="md-nav" aria-label="3.2. 快速入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-sql" class="md-nav__link">
    3.2.1. 执行sql
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322-seata-server" class="md-nav__link">
    3.2.2. 启动seata-server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323" class="md-nav__link">
    3.2.3. 启动各个微服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#324" class="md-nav__link">
    3.2.4. 测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3. 快速入门案例的启示
  </a>
  
    <nav class="md-nav" aria-label="3.3. 快速入门案例的启示">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" class="md-nav__link">
    3.3.1. 前提：日志表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332" class="md-nav__link">
    3.3.2. 先看依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333" class="md-nav__link">
    3.3.3. 再看配置
  </a>
  
    <nav class="md-nav" aria-label="3.3.3. 再看配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3331-applicationproperties" class="md-nav__link">
    3.3.3.1. application.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3332-registryconf" class="md-nav__link">
    3.3.3.2. registry.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3333-fileconf" class="md-nav__link">
    3.3.3.3. file.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3334-datasourceconfigjava" class="md-nav__link">
    3.3.3.4. DataSourceConfig.java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#334" class="md-nav__link">
    3.3.4.   最后注解
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4.   给商品新增添加分布式事务
  </a>
  
    <nav class="md-nav" aria-label="3.4.   给商品新增添加分布式事务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341-undo_log" class="md-nav__link">
    3.4.1.   添加undo_log日志表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342-gmall-pms" class="md-nav__link">
    3.4.2.   改造gmall-pms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343-gmall-sms" class="md-nav__link">
    3.4.3.   改造gmall-sms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#344-seata-server" class="md-nav__link">
    3.4.4.   seata-server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#345" class="md-nav__link">
    3.4.5.   主键问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../4.elasticsearch%28DSL%E5%8F%8ASpringData-Elasticsearch%29/elasticsearch/" class="md-nav__link">
        谷粒商城04
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5.%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2/%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2/" class="md-nav__link">
        谷粒商城05
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6.%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%EF%BC%88Thymeleaf%EF%BC%89%E5%8F%8A%E6%90%9C%E7%B4%A2%E9%A1%B5%E6%B8%B2%E6%9F%93/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf/" class="md-nav__link">
        谷粒商城06
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../7.%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%EF%BC%88RabbitMQ%EF%BC%89/%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" class="md-nav__link">
        谷粒商城07
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8.%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%28%E7%BC%93%E5%AD%98%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E3%80%81Redisson%E3%80%81%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%29/%E9%A6%96%E9%A1%B5%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB/" class="md-nav__link">
        谷粒商城08
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../9.%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E5%8F%8A%E5%BC%82%E6%AD%A5%E7%BC%96%E6%8E%92%EF%BC%88CompletableFuture%EF%BC%89/%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5/" class="md-nav__link">
        谷粒商城09
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../10.%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88jwt%EF%BC%89/" class="md-nav__link">
        谷粒商城10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../11.%E8%B4%AD%E7%89%A9%E8%BD%A6%EF%BC%88SpringTask%EF%BC%89/%E8%B4%AD%E7%89%A9%E8%BD%A6/" class="md-nav__link">
        谷粒商城11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../12.%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88xxl-job%EF%BC%89/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88xxl-job%EF%BC%89/" class="md-nav__link">
        谷粒商城12
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../13.%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/%E8%AE%A2%E5%8D%95%E3%80%81%E5%BA%93%E5%AD%98/" class="md-nav__link">
        谷粒商城13
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../14.%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/%E6%94%AF%E4%BB%98%E3%80%81%E7%A7%92%E6%9D%80/" class="md-nav__link">
        谷粒商城14
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_4" type="checkbox" id="__nav_1_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_4">
          尚融宝
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚融宝" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_4">
          <span class="md-nav__icon md-icon"></span>
          尚融宝
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part01-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/Part01-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
        项目介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part02-MyBatis-Plus/Part02-MyBatis-Plus/" class="md-nav__link">
        MyBatis-Plus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part03-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/Part03-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        后端接口工程搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part04-%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/Part04-%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        前端知识
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part05-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/Part05-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        管理平台前端搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part06-Alibaba%20EasyExcel/Part06-Alibaba%20EasyExcel/" class="md-nav__link">
        Alibaba EasyExcel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part07-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/Part07-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/" class="md-nav__link">
        数据字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part08-Redis%E7%BC%93%E5%AD%98/Part08-Redis%E7%BC%93%E5%AD%98/" class="md-nav__link">
        Redis缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part09-NuxtJS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93/Part09-NuxtJS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93/" class="md-nav__link">
        NuxtJS服务器端渲染
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part10-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1/Part10-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1/" class="md-nav__link">
        阿里云短信
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java课程/项目文档/尚融宝/Part11-分布式文件系统-阿里云OSS/分布式文件系统-阿里云OSS" class="md-nav__link">
        阿里云OSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C/Part12-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C/" class="md-nav__link">
        用户注册
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part13-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C/Part13-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C/" class="md-nav__link">
        访问令牌
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part14-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/Part14-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/" class="md-nav__link">
        用户认证
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part15-%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86/Part15-%E4%BC%9A%E5%91%98%E7%AE%A1%E7%90%86/" class="md-nav__link">
        会员管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part16-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-OAuth2/Part16-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8-OAuth2/" class="md-nav__link">
        OAuth2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part17-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/Part17-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="md-nav__link">
        内网穿透
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part18-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/Part18-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" class="md-nav__link">
        微信登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part19-%20SpringCloud/Part19-%20SpringCloud/" class="md-nav__link">
        SpringCloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part20-%E8%B4%A6%E6%88%B7%E7%BB%91%E5%AE%9A/Part20-%E8%B4%A6%E6%88%B7%E7%BB%91%E5%AE%9A/" class="md-nav__link">
        账户绑定
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part21-%E7%94%B3%E8%AF%B7%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6/Part21-%E7%94%B3%E8%AF%B7%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6/" class="md-nav__link">
        申请借款额度
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part22-%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6%E5%AE%A1%E6%A0%B8/Part22-%E5%80%9F%E6%AC%BE%E9%A2%9D%E5%BA%A6%E5%AE%A1%E6%A0%B8/" class="md-nav__link">
        借款额度审核
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part23-%E5%80%9F%E6%AC%BE%E7%94%B3%E8%AF%B7/Part23-%E5%80%9F%E6%AC%BE%E7%94%B3%E8%AF%B7/" class="md-nav__link">
        借款申请
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part24-%E5%80%9F%E6%AC%BE%E5%AE%A1%E6%A0%B8/Part24-%E5%80%9F%E6%AC%BE%E5%AE%A1%E6%A0%B8/" class="md-nav__link">
        借款审核
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part25-%E6%A0%87%E7%9A%84%E7%AE%A1%E7%90%86/Part25-%E6%A0%87%E7%9A%84%E7%AE%A1%E7%90%86/" class="md-nav__link">
        标的管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part26-%E6%88%91%E8%A6%81%E6%8A%95%E8%B5%84/Part26-%E6%88%91%E8%A6%81%E6%8A%95%E8%B5%84/" class="md-nav__link">
        我要投资
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part27-%E5%85%85%E5%80%BC/Part27-%E5%85%85%E5%80%BC/" class="md-nav__link">
        充值
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part28-%E6%8A%95%E6%A0%87/Part28-%E6%8A%95%E6%A0%87/" class="md-nav__link">
        投标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part29-%E6%94%BE%E6%AC%BE/Part29-%E6%94%BE%E6%AC%BE/" class="md-nav__link">
        放款
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part30-%E6%8A%95%E8%B5%84%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA/Part30-%E6%8A%95%E8%B5%84%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA/" class="md-nav__link">
        投资列表展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part31-%E6%8F%90%E7%8E%B0%E5%92%8C%E8%BF%98%E6%AC%BE/Part31-%E6%8F%90%E7%8E%B0%E5%92%8C%E8%BF%98%E6%AC%BE/" class="md-nav__link">
        提现和还款
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part32-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83/Part32-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83/" class="md-nav__link">
        个人中心
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part33-%E7%BD%91%E5%85%B3/Part33-%E7%BD%91%E5%85%B3/" class="md-nav__link">
        网关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part34-%E8%A1%A5%E5%85%85/Part34-%E8%A1%A5%E5%85%85/" class="md-nav__link">
        补充
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E8%9E%8D%E5%AE%9D/Part35-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/Part35-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/" class="md-nav__link">
        微信支付
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7_5" type="checkbox" id="__nav_1_7_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_7_5">
          尚医通
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="尚医通" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_7_5">
          <span class="md-nav__icon md-icon"></span>
          尚医通
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day01%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8EMyBatis%20Plus/day01%20%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%20Mybatis%20Plus/" class="md-nav__link">
        项目介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day02%20%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E5%8C%BB%E9%99%A2%E8%AE%BE%E7%BD%AE/day02%20%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E5%8C%BB%E9%99%A2%E8%AE%BE%E7%BD%AE/" class="md-nav__link">
        搭建环境和医院设置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day03%20%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/day03%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/" class="md-nav__link">
        前端基础知识（一）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day04%20%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%88%E4%BA%8C%EF%BC%89/day04%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        前端基础知识（二）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day05%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/day05%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        平台管理前端搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day06%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/day06%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/" class="md-nav__link">
        数据字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day07mongodb/day07mongodb/" class="md-nav__link">
        mongodb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day08%E5%8C%BB%E9%99%A2%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3/day08%E5%8C%BB%E9%99%A2%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3/" class="md-nav__link">
        医院上传接口
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day09%E5%8C%BB%E9%99%A2%E7%AE%A1%E7%90%86/day09%E5%8C%BB%E9%99%A2%E7%AE%A1%E7%90%86/" class="md-nav__link">
        医院管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day10%E6%8E%92%E7%8F%AD%E7%AE%A1%E7%90%86%E5%92%8C%E7%BD%91%E5%85%B3/day10%E6%8E%92%E7%8F%AD%E7%AE%A1%E7%90%86%E5%92%8C%E7%BD%91%E5%85%B3/" class="md-nav__link">
        排班管理和网关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day11%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%A6%96%E9%A1%B5/day11%E5%B9%B3%E5%8F%B0%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%A6%96%E9%A1%B5/" class="md-nav__link">
        平台前端搭建与首页
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day12%E6%89%8B%E6%9C%BA%E7%99%BB%E5%BD%95/day12%E6%89%8B%E6%9C%BA%E7%99%BB%E5%BD%95/" class="md-nav__link">
        手机登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day13%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/day13%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" class="md-nav__link">
        微信登录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day14%E9%98%BF%E9%87%8C%E4%BA%91OSS%E3%80%81%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%B0%B1%E8%AF%8A%E4%BA%BA/day14%E9%98%BF%E9%87%8C%E4%BA%91OSS%E3%80%81%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%B0%B1%E8%AF%8A%E4%BA%BA/" class="md-nav__link">
        阿里云OSS、用户认证与就诊人
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day15%E9%A2%84%E7%BA%A6%E6%8C%82%E5%8F%B7/day15%E9%A2%84%E7%BA%A6%E6%8C%82%E5%8F%B7/" class="md-nav__link">
        预约挂号
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day16%E9%A2%84%E7%BA%A6%E4%B8%8B%E5%8D%95/day16%E9%A2%84%E7%BA%A6%E4%B8%8B%E5%8D%95/" class="md-nav__link">
        预约下单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day17%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/day17%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/" class="md-nav__link">
        微信支付
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%B0%9A%E5%8C%BB%E9%80%9A/day18%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E7%BB%9F%E8%AE%A1/day18%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8E%E7%BB%9F%E8%AE%A1/" class="md-nav__link">
        定时任务与统计
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Java就业面试
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java就业面试" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Java就业面试
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC1%E7%AB%A0%20%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        第1章 面试说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC2%E7%AB%A0%20%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/" class="md-nav__link">
        第2章 手写代码
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC3%E7%AB%A0%20JavaSE/" class="md-nav__link">
        第3章 JavaSE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC4%E7%AB%A0%20JVM/" class="md-nav__link">
        第4章 JVM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC5%E7%AB%A0%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        第5章 设计模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC6%E7%AB%A0%20MySql/" class="md-nav__link">
        第6章 MySql
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC7%E7%AB%A0%20Java%20Web/" class="md-nav__link">
        第7章 Java Web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC8%E7%AB%A0%20SSM%E6%A1%86%E6%9E%B6/" class="md-nav__link">
        第8章 SSM框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC9%E7%AB%A0%20SpringBoot/" class="md-nav__link">
        第9章 SpringBoot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC10%E7%AB%A0%20SpringCloud/" class="md-nav__link">
        第10章 SpringCloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC11%E7%AB%A0%20Redis/" class="md-nav__link">
        第11章 Redis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC12%E7%AB%A0%20MQ/" class="md-nav__link">
        第12章 MQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC13%E7%AB%A0%20ElasticSearch/" class="md-nav__link">
        第13章 ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC14%E7%AB%A0%20Dubbo/" class="md-nav__link">
        第14章 Dubbo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC15%E7%AB%A0%20Zookeeper/" class="md-nav__link">
        第15章 Zookeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC16%E7%AB%A0%20Git/" class="md-nav__link">
        第16章 Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../java%E9%9D%A2%E8%AF%95%E9%A2%98/%E7%AC%AC17%E7%AB%A0%20Linux/" class="md-nav__link">
        第17章 Linux
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        学习文档
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 本地事务
  </a>
  
    <nav class="md-nav" aria-label="1. 本地事务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1. 基本概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2. 隔离级别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3. 相关命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4. 传播行为
  </a>
  
    <nav class="md-nav" aria-label="1.4. 传播行为">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141" class="md-nav__link">
    1.4.1. 伪代码练习
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142" class="md-nav__link">
    1.4.2. 改造商品新增代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-1service-requires_new" class="md-nav__link">
    1.4.3. 测试1：同一service + requires_new
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-2service-requires_new" class="md-nav__link">
    1.4.4. 测试2：不同service + requires_new
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-service" class="md-nav__link">
    1.4.5. 在同一个service中使用传播行为
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    1.5. 回滚策略
  </a>
  
    <nav class="md-nav" aria-label="1.5. 回滚策略">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151" class="md-nav__link">
    1.5.1. 测试编译时异常不回滚
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152" class="md-nav__link">
    1.5.2. 定制回滚策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    1.6. 超时事务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17" class="md-nav__link">
    1.7. 只读事务
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 分布式事务理论
  </a>
  
    <nav class="md-nav" aria-label="2. 分布式事务理论">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1. 分布式事务基础
  </a>
  
    <nav class="md-nav" aria-label="2.1. 分布式事务基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-cap" class="md-nav__link">
    2.1.1. CAP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-base" class="md-nav__link">
    2.1.2. BASE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2.   分布式事务解决方案
  </a>
  
    <nav class="md-nav" aria-label="2.2.   分布式事务解决方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-2pc" class="md-nav__link">
    2.2.1. 两阶段提交（2PC）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-tcc" class="md-nav__link">
    2.2.2. TCC补偿式事务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    2.2.3. 消息事务+最终一致性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-seata" class="md-nav__link">
    3. 分布式事务框架-seata
  </a>
  
    <nav class="md-nav" aria-label="3. 分布式事务框架-seata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1. 结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2. 快速入门
  </a>
  
    <nav class="md-nav" aria-label="3.2. 快速入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-sql" class="md-nav__link">
    3.2.1. 执行sql
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322-seata-server" class="md-nav__link">
    3.2.2. 启动seata-server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323" class="md-nav__link">
    3.2.3. 启动各个微服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#324" class="md-nav__link">
    3.2.4. 测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3. 快速入门案例的启示
  </a>
  
    <nav class="md-nav" aria-label="3.3. 快速入门案例的启示">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" class="md-nav__link">
    3.3.1. 前提：日志表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332" class="md-nav__link">
    3.3.2. 先看依赖
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333" class="md-nav__link">
    3.3.3. 再看配置
  </a>
  
    <nav class="md-nav" aria-label="3.3.3. 再看配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3331-applicationproperties" class="md-nav__link">
    3.3.3.1. application.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3332-registryconf" class="md-nav__link">
    3.3.3.2. registry.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3333-fileconf" class="md-nav__link">
    3.3.3.3. file.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3334-datasourceconfigjava" class="md-nav__link">
    3.3.3.4. DataSourceConfig.java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#334" class="md-nav__link">
    3.3.4.   最后注解
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4.   给商品新增添加分布式事务
  </a>
  
    <nav class="md-nav" aria-label="3.4.   给商品新增添加分布式事务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341-undo_log" class="md-nav__link">
    3.4.1.   添加undo_log日志表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342-gmall-pms" class="md-nav__link">
    3.4.2.   改造gmall-pms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343-gmall-sms" class="md-nav__link">
    3.4.3.   改造gmall-sms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#344-seata-server" class="md-nav__link">
    3.4.4.   seata-server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#345" class="md-nav__link">
    3.4.5.   主键问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="_1">分布式事务<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="1">1. 本地事务<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>商品新增功能非常复杂，商品管理微服务在service层中调用保存spu和sku相关的方法，为了保证数据的一致性，必然会使用事务。</p>
<p>在JavaEE企业级开发的应用领域，为了保证数据的完整性和一致性，必须引入数据库事务的概念，所以事务管理是企业级应用程序开发中必不可少的技术。</p>
<p>咱们之前玩的事务都是本地事务。所谓本地事务，是指该事务仅在当前工程内有效。</p>
<h3 id="11">1.1. 基本概念<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<p>事务的概念：事务是逻辑上一组操作，组成这组操作各个逻辑单元，要么一起成功，要么一起失败。</p>
<p>事务的四个特性（ACID）：</p>
<ol>
<li>
<p>原子性(atomicity)：“原子”的本意是“<strong>不可再分</strong>”，事务的原子性表现为一个事务中涉及到的多个操作在逻辑上缺一不可。事务的原子性要求事务中的所有操作要么都执行，要么都不执行。 </p>
</li>
<li>
<p>一致性(consistency)：“一致”指的是数据的一致，具体是指：所有数据都处于满足业务规则的一致性状态。一致性原则要求：一个事务中不管涉及到多少个操作，都必须保证**事务执行之前**数据是正确的，**事务执行之后**数据仍然是正确的。如果一个事务在执行的过程中，其中某一个或某几个操作失败了，则必须将其他所有操作撤销，将数据恢复到事务执行之前的状态，这就是回滚。</p>
</li>
<li>
<p>隔离性(isolation)：在应用程序实际运行过程中，事务往往是并发执行的，所以很有可能有许多事务同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏。隔离性原则要求多个事务在**并发执行过程中不会互相干扰**。</p>
</li>
<li>
<p>持久性(durability)：持久性原则要求事务执行完成后，对数据的修改永久的保存下来，不会因各种系统错误或其他意外情况而受到影响。通常情况下，事务对数据的修改应该被写入到**持久化存储器**中。</p>
</li>
</ol>
<h3 id="12">1.2. 隔离级别<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<p>事务并发引起一些读的问题：</p>
<ul>
<li>
<p>脏读                     一个事务可以读取另一个事务未提交的数据</p>
</li>
<li>
<p>不可重复读           一个事务可以读取另一个事务已提交的数据  单条记录前后不匹配</p>
</li>
<li>
<p>虚读（幻读）       一个事务可以读取另一个事务已提交的数据  读取的数据前后多了点或者少了点</p>
</li>
</ul>
<p>并发写：使用mysql默认的锁机制（独占锁）</p>
<p>解决读问题：设置事务隔离级别</p>
<ul>
<li>
<p>read uncommitted(0)</p>
</li>
<li>
<p><strong>read committed(2)</strong></p>
</li>
<li>
<p><strong>repeatable read(4)</strong></p>
</li>
<li>
<p>Serializable(8)</p>
</li>
</ul>
<p>隔离级别越高，性能越低。</p>
<p><img alt="img" src="../assets/af5b9c1e-4517-3df2-ad62-af25d1672d12.jpg" /></p>
<p>一般情况下：脏读是不可允许的，不可重复读和幻读是可以被适当允许的。</p>
<h3 id="13">1.3. 相关命令<a class="headerlink" href="#13" title="Permanent link">&para;</a></h3>
<p>查看全局事务隔离级别：SELECT @@global.tx_isolation</p>
<p>设置全局事务隔离级别：set global transaction isolation level read committed;</p>
<p><strong>查看当前会话事务隔离级别：SELECT @@tx_isolation</strong></p>
<p><strong>设置当前会话事务隔离级别：set session transaction isolation level read committed;</strong></p>
<p>查看mysql默认自动提交状态：select @@autocommit</p>
<p>设置mysql默认自动提交状态：set autocommit = 0;【不自动提交】</p>
<p><strong>开启一个事务：start transaction;   /  begin;</strong>   </p>
<p><strong>提交/回滚：commit /  rollback</strong></p>
<p>在事务中创建一个保存点：savepoint tx1</p>
<p>回滚到保存点：rollback to tx1</p>
<h3 id="14">1.4. 传播行为<a class="headerlink" href="#14" title="Permanent link">&para;</a></h3>
<p>事务的传播行为不是jdbc规范中的定义。传播行为主要针对实际开发中的问题</p>
<p><img alt="1567660421239" src="../assets/1567660421239.png" /></p>
<p>七种传播行为：</p>
<p>REQUIRED                    支持当前事务，如果不存在，就新建一个</p>
<p>SUPPORTS                   支持当前事务，如果不存在，就不使用事务</p>
<p>MANDATORY               支持当前事务，如果不存在，抛出异常</p>
<p>REQUIRES_NEW          如果有事务存在，挂起当前事务，创建一个新的事务</p>
<p>NOT_SUPPORTED       以非事务方式运行，如果有事务存在，挂起当前事务</p>
<p>NEVER                           以非事务方式运行，如果有事务存在，抛出异常</p>
<p>NESTED                       如果当前事务存在，则嵌套事务执行（嵌套式事务）</p>
<ul>
<li>
<p>依赖于JDBC3.0提供的SavePoint技术</p>
</li>
<li>
<p>删除用户 删除订单。在删除订单后，设置savePoint，执行删除用户。删除订单和删除用户在同一事务中，删除用户失败，事务回滚savePoint，由用户控制视图提交还是回滚</p>
</li>
</ul>
<p>这七种事务传播机制最常用的就两种：</p>
<p>REQUIRED：一个事务，要么成功，要么失败</p>
<p>REQUIRES_NEW：两个不同事务，彼此之间没有关系。一个事务失败了不影响另一个事务</p>
<h4 id="141">1.4.1. 伪代码练习<a class="headerlink" href="#141" title="Permanent link">&para;</a></h4>
<p>传播行为伪代码模拟：有a,b,c,d,e等5个方法，a中调用b,c,d,e方法的传播行为在小括号中标出</p>
<div class="highlight"><pre><span></span><code><span class="n">a</span><span class="p">(</span><span class="n">required</span><span class="p">){</span>
    <span class="n">b</span><span class="p">(</span><span class="n">required</span><span class="p">);</span>
    <span class="n">c</span><span class="p">(</span><span class="n">requires_new</span><span class="p">);</span>
    <span class="n">d</span><span class="p">(</span><span class="n">required</span><span class="p">);</span>
    <span class="n">e</span><span class="p">(</span><span class="n">requires_new</span><span class="p">);</span>
    <span class="c1">// a方法的业务</span>
<span class="p">}</span>
</code></pre></div>
<p>问题：</p>
<ol>
<li>a方法的业务出现异常，会怎样？a,b,d回滚 c,e不回滚</li>
<li>d方法出现异常，会怎样？a,b,d回滚 c,e不回滚</li>
<li>e方法出现异常，会怎样？a,b,d,e回滚 c不回滚，e方法出异常会上抛影响到上级方法</li>
<li>b方法出现异常，会怎样？a,b回滚 c,d,e未执行</li>
</ol>
<p>加点难度：</p>
<div class="highlight"><pre><span></span><code>a(required){
    b(required){
        f(requires_new);
        g(required)
    }
    c(requires_new){
        h(requires_new)
        i(required)
    }
    d(required);
    e(requires_new);
    // a方法的业务
}
</code></pre></div>
<p>问题：</p>
<ol>
<li>a方法业务出异常</li>
<li>e方法出异常</li>
<li>d方法出异常</li>
<li>h,i方法分别出异常</li>
<li>i方法出异常</li>
<li>f,g方法分别出异常</li>
</ol>
<h4 id="142">1.4.2. 改造商品新增代码<a class="headerlink" href="#142" title="Permanent link">&para;</a></h4>
<p>现在商品保存的方法结构如下：</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">bigSave</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">/// 1.保存spu相关</span>
        <span class="c1">// 1.1. 保存spu基本信息 spu_info</span>
        <span class="n">Long</span> <span class="n">spuId</span> <span class="o">=</span> <span class="n">saveSpu</span><span class="p">(</span><span class="n">spuVo</span><span class="p">);</span>

        <span class="c1">// 1.2. 保存spu的描述信息 spu_info_desc</span>
        <span class="n">saveSpuDesc</span><span class="p">(</span><span class="n">spuVo</span><span class="p">,</span> <span class="n">spuId</span><span class="p">);</span>

        <span class="c1">// 1.3. 保存spu的规格参数信息</span>
        <span class="n">saveBaseAttr</span><span class="p">(</span><span class="n">spuVo</span><span class="p">,</span> <span class="n">spuId</span><span class="p">);</span>

        <span class="c1">/// 2. 保存sku相关信息</span>
        <span class="n">saveSku</span><span class="p">(</span><span class="n">spuVo</span><span class="p">,</span> <span class="n">spuId</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 保存sku相关信息及营销信息</span>
<span class="cm">     * @param spuInfoVO</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">saveSku</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">,</span> <span class="n">Long</span> <span class="n">spuId</span><span class="p">)</span> <span class="p">{</span> <span class="err">。。。</span> <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 保存spu基本属性信息</span>
<span class="cm">     * @param spuInfoVO</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">saveBaseAttr</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">,</span> <span class="n">Long</span> <span class="n">spuId</span><span class="p">)</span> <span class="p">{</span> <span class="err">。。。</span> <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 保存spu描述信息（图片）</span>
<span class="cm">     * @param spuInfoVO</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">saveSpuDesc</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">,</span> <span class="n">Long</span> <span class="n">spuId</span><span class="p">)</span> <span class="p">{</span> <span class="err">。。。</span> <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 保存spu基本信息</span>
<span class="cm">     * @param spuInfoVO</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">saveSpu</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">)</span> <span class="p">{</span>  <span class="err">。。。</span> <span class="p">}</span>
</code></pre></div>
<p>为了测试事务传播行为，我们在SpuInfoService接口中把saveSkuInfoWithSaleInfo、saveBaseAttrs、saveSpuDesc、saveSpuInfo声明为service接口方法。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SpuInfoService</span> <span class="kd">extends</span> <span class="n">IService</span><span class="o">&lt;</span><span class="n">SpuInfoEntity</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">PageVo</span> <span class="nf">queryPage</span><span class="p">(</span><span class="n">QueryCondition</span> <span class="n">params</span><span class="p">);</span>

    <span class="n">PageVo</span> <span class="nf">querySpuInfo</span><span class="p">(</span><span class="n">QueryCondition</span> <span class="n">condition</span><span class="p">,</span> <span class="n">Long</span> <span class="n">catId</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">saveSpuInfoVO</span><span class="p">(</span><span class="n">SpuInfoVO</span> <span class="n">spuInfoVO</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">saveSku</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">,</span> <span class="n">Long</span> <span class="n">spuId</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">saveBaseAttr</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">,</span> <span class="n">Long</span> <span class="n">spuId</span><span class="p">);</span>

    <span class="kt">void</span> <span class="nf">saveSpuDesc</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">,</span> <span class="n">Long</span> <span class="n">spuId</span><span class="p">);</span>

    <span class="n">Long</span> <span class="nf">saveSpu</span><span class="p">(</span><span class="n">SpuVo</span> <span class="n">spuVo</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>再把SpuInfoServiceImpl实现类的对应方法改成public：</p>
<p><img alt="1584780507279" src="../assets/1584780507279.png" /></p>
<h4 id="143-1service-requires_new">1.4.3. 测试1：同一service + requires_new<a class="headerlink" href="#143-1service-requires_new" title="Permanent link">&para;</a></h4>
<p>springboot 1.x使用事务需要在引导类上添加@EnableTransactionManagement注解开启事务支持</p>
<p>springboot 2.x可直接使用@Transactional玩事务，传播行为默认是REQUIRED</p>
<p>添加事务：</p>
<p><img alt="1584784895102" src="../assets/1584784895102.png" /></p>
<p>这时，在保存商品的主方法中制造异常：</p>
<p><img alt="1584784987731" src="../assets/1584784987731.png" /></p>
<p>由于保存商品描述方法使用的是requires_new，spu应该会回滚，spu_desc应该保存成功。</p>
<p>清空pms_spu_desc表，再添加一个spu保存。</p>
<p>结果pms_spu_desc表中依然没有数据。</p>
<p>但是控制台打印了新增pms_spu_desc表的sql语句：</p>
<p><img alt="1584791120439" src="../assets/1584791120439.png" /></p>
<p>说明saveSpuDesc方法的事务回滚了，也就是说该方法配置的事务传播机制没有生效。</p>
<p>解决方案：</p>
<ol>
<li>把service方法放到不同的service中</li>
<li>使用动态代理对象调用该方法</li>
</ol>
<h4 id="144-2service-requires_new">1.4.4. 测试2：不同service + requires_new<a class="headerlink" href="#144-2service-requires_new" title="Permanent link">&para;</a></h4>
<p>把saveSpuDesc方法放到SpuDescService中：</p>
<p><img alt="1584791341509" src="../assets/1584791341509.png" /></p>
<p>在实现类中实现该方法，可以把之前的实现copy过来：</p>
<p><img alt="1584791517742" src="../assets/1584791517742.png" /></p>
<p>改造SpuServiceImpl中保存商品的方法，调用SpuDescServiceImpl的saveSpuDesc方法：</p>
<p><img alt="1584791613579" src="../assets/1584791613579.png" /></p>
<p>再次重启gmall-pms，虽然控制台依然报错，但是数据可以保存成功，说明没有在一个事务中。</p>
<p><img alt="1567687774435" src="../assets/1567687774435.png" /></p>
<p>为什么测试1的事务传播行为没有生效，而测试2的事务传播行为生效了？</p>
<p><strong>spring的事务是声明式事务，而声明式事务的本质是Spring AOP，SpringAOP的本质是动态代理。</strong></p>
<p><strong>事务要生效必须是代理对象在调用。</strong></p>
<p>测试1：通过this调用同一个service中的方法，this是指service实现类对象本身，不是代理对象，就相当于方法中的代码粘到了大方法里面，相当于还是一个方法。</p>
<p>测试2：通过其他service对象（spuDescService）调用，这个service对象本质是动态代理对象</p>
<p>接下来debug，打个断点看看：</p>
<ol>
<li>spuDescService：</li>
</ol>
<p><img alt="1567689094127" src="../assets/1567689094127.png" /></p>
<ol>
<li>this:</li>
</ol>
<p><img alt="1567689136840" src="../assets/1567689136840.png" /></p>
<h4 id="145-service">1.4.5. 在同一个service中使用传播行为<a class="headerlink" href="#145-service" title="Permanent link">&para;</a></h4>
<p>只需要把测试1中的<code>this.方法名()</code>替换成<code>this代理对象.方法名()</code>即可。</p>
<p>问题是怎么在service中获取当前类的代理对象？</p>
<p>在类中获取代理对象分三个步骤：</p>
<ol>
<li>导入aop的场景依赖：spring-boot-starter-aop</li>
<li>开启AspectJ的自动代理，同时要暴露代理对象：@EnableAspectJAutoProxy(exposeProxy=true)</li>
<li>获取代理对象：SpuInfoService proxy = (SpuInfoService) AopContext.currentProxy();</li>
</ol>
<p>具体如下：</p>
<div class="highlight"><pre><span></span><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p><img alt="1567690207315" src="../assets/1567690207315.png" /></p>
<p><img alt="1567690368936" src="../assets/1567690368936.png" /></p>
<p>重启后测试：先清空pms_spu_info_desc表中数据</p>
<p><img alt="1567690577522" src="../assets/1567690577522.png" /></p>
<p>表中数据新增成功，说明saveSpuDesc方法走的是自己的事务，传播行为生效了。</p>
<p>debug可以看到，spuInfoService是一个代理对象。</p>
<p><img alt="1567690539055" src="../assets/1567690539055.png" /></p>
<h3 id="15">1.5. 回滚策略<a class="headerlink" href="#15" title="Permanent link">&para;</a></h3>
<p>事务很重要的另一个特征是程序出异常时，会回滚。但并不是所有的异常都会回滚。</p>
<p>默认情况下的回滚策略：</p>
<ul>
<li>运行时异常：不受检异常，没有强制要求try-catch，都会回滚。例如：ArrayOutOfIndex，OutofMemory，NullPointException</li>
<li>编译时异常：受检异常，必须处理，要么try-catch要么throws，都不回滚。例如：FileNotFoundException</li>
</ul>
<p>可以通过@Transactional注解的下面几个属性改变回滚策略：</p>
<p><img alt="1567670630801" src="../assets/1567670630801.png" /></p>
<p>rollbackFor：指定的异常必须回滚</p>
<p>noRollbackFor：发生指定的异常不用回滚</p>
<h4 id="151">1.5.1. 测试编译时异常不回滚<a class="headerlink" href="#151" title="Permanent link">&para;</a></h4>
<p>在商品保存方法中制造一个编译时异常：</p>
<p><img alt="1584791955821" src="../assets/1584791955821.png" /></p>
<p>重启测试，注意pms_spu表中数据：</p>
<p>控制台报异常：</p>
<p><img alt="1567691494892" src="../assets/1567691494892.png" /></p>
<p>pms_spu表中的数据新增成功了。</p>
<p><img alt="1567691611593" src="../assets/1567691611593.png" /></p>
<p>也就证明了编译时异常不回滚。</p>
<h4 id="152">1.5.2. 定制回滚策略<a class="headerlink" href="#152" title="Permanent link">&para;</a></h4>
<p>经过刚才的测试，我们知道：</p>
<ol>
<li>ArithmeticException异常（int i = 1/0）会回滚</li>
<li>FileNotFoundException异常（new FileInputStream("xxxx")）不回滚</li>
</ol>
<p>接下来我们来改变一下这个策略：</p>
<p><img alt="1584792095693" src="../assets/1584792095693.png" /></p>
<p>测试：</p>
<ol>
<li>FileNotFoundException：在程序中添加new FileInputStream("xxxx")，然后测试。</li>
</ol>
<p><img alt="1567692233983" src="../assets/1567692233983.png" /></p>
<p>还是id还是17，说明回滚了（回滚也会占用id=18）</p>
<ol>
<li>ArithmeticException：在程序中添加int i = 1/0; 然后测试。</li>
</ol>
<p><img alt="1567692364759" src="../assets/1567692364759.png" /></p>
<p>id是19，说明没有回滚。</p>
<h3 id="16">1.6. 超时事务<a class="headerlink" href="#16" title="Permanent link">&para;</a></h3>
<p>@Transactional注解，还有一个属性是timeout超时时间，单位是秒。</p>
<p><img alt="1567692523018" src="../assets/1567692523018.png" /></p>
<p>timeout=3：是指第一个sql开始执行到最后一个sql结束执行之间的间隔时间。</p>
<p>即：超时时间（timeout）是指数据库超时，不是业务超时。</p>
<p>改造之前商品保存方法：SpuInfoServiceImpl类中</p>
<p><img alt="1584792229794" src="../assets/1584792229794.png" /></p>
<p>重启测试：控制台出现事务超时异常</p>
<p><img alt="1567693383569" src="../assets/1567693383569.png" /></p>
<h3 id="17">1.7. 只读事务<a class="headerlink" href="#17" title="Permanent link">&para;</a></h3>
<p>@Transactional注解最后一个属性是只读事务属性</p>
<p><img alt="1567693468270" src="../assets/1567693468270.png" /></p>
<p>如果一个方法标记为readOnly=true事务，则代表该方法只能查询，不能增删改。readOnly默认为false</p>
<p>给商品新增的事务标记为只读事务：</p>
<p><img alt="1584792311622" src="../assets/1584792311622.png" /></p>
<p>测试：</p>
<p><img alt="1567693694019" src="../assets/1567693694019.png" /></p>
<h2 id="2">2. 分布式事务理论<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>商品管理微服务在service层中除了保存spu和sku相关的方法，又远程调用gmall-sms的保存接口，并在gmall-sms的service层中调用了保存营销信息的相关方法。如果保存营销信息的方法出现异常，会怎样？</p>
<p>传统的一个工程内为了保证数据的一致性，使用本地事务。本地事务只能解决同一工程中的事务问题，而现在的场景更加复杂，关系到两个工程模块，怎么保证要么都成功，要么都失败？</p>
<p>​       分布式事务就是一次大的操作由不同的小操作组成，这些小的操作分布在不同的服务器上，且属于不同的应用，分布式事务需要保证这些小操作要么全部成功，要么全部失败。</p>
<p>​       分布式事务场景：不同应用相同数据库，相同应用不同数据库，不同应用不同数据库。</p>
<p>​       分布式事务产生的原因：分布式系统异常除了本地事务那些异常之外，还有：机器宕机、网络异常、消息丢失、消息乱序、数据错误、不可靠的TCP、存储数据丢失...</p>
<p><img alt="1567696219358" src="../assets/1567696219358.png" /></p>
<h3 id="21">2.1. 分布式事务基础<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>数据库的 ACID 四大特性，已经无法满足我们分布式事务，这个时候又有一些新的大佬提出一些新的理论。</p>
<h4 id="211-cap">2.1.1. CAP<a class="headerlink" href="#211-cap" title="Permanent link">&para;</a></h4>
<p>分布式存储系统的CAP原理（分布式系统的三个指标）：</p>
<ol>
<li><strong>C**onsistency（一致性）：在分布式系统中的所有数据备份，在**同一时刻是否同样的值</strong>。</li>
</ol>
<p>对于数据分布在不同节点上的数据来说，如果在某个节点更新了数据，那么在其他节点如果都能读取到这个最新的数据，那么就称为强一致，如果有某个节点没有读取到，那就是分布式不一致。</p>
<ol>
<li>
<p>**A**vailability（可用性）：在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（要求数据需要备份）</p>
</li>
<li>
<p>**P**artition tolerance（分区容忍性）：大多数分布式系统都分布在多个子网络。每个子网络就叫做一个区（partition）。分区容错的意思是，区间通信可能失败。</p>
</li>
</ol>
<p>CAP理论就是说在分布式存储系统中，最多只能实现上面的两点。而由于当前的网络硬件肯定会出现延迟丢包等问题，所以**分区容忍性是我们无法避免的**。所以我们只能在一致性和可用性之间进行权衡，没有系统能同时保证这三点。要么选择CP、要么选择AP。</p>
<p>问题：zookeeper分布式协调组件 是 <strong>CP</strong> 还是 AP</p>
<p>动画：<a href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p>
<p>我们的妥协：BASE</p>
<h4 id="212-base">2.1.2. BASE<a class="headerlink" href="#212-base" title="Permanent link">&para;</a></h4>
<p>​       BASE是对CAP中一致性和可用性权衡的结果，其来源于对大规模互联网系统分布式实践的结论，是基于CAP定理逐步演化而来的，其核心思想是即使无法做到强一致性（Strong consistency），但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性（Eventual consistency）。接下来看看BASE中的三要素：</p>
<ol>
<li>Basically Available（<strong>基本可用</strong>）</li>
</ol>
<p>基本可用是指分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用。 
   电商大促时，为了应对访问量激增，部分用户可能会被引导到降级页面，服务层也可能只提供降级服务。这就是损失部分可用性的体现。</p>
<ol>
<li>Soft state（软状态）</li>
</ol>
<p>软状态是指允许系统存在中间状态，而该中间状态不会影响系统整体可用性。分布式存储中一般一份数据至少会有三个副本，**允许不同节点间副本同步的延时**就是软状态的体现。mysql replication的异步复制也是一种体现。</p>
<ol>
<li>Eventually consistent（最终一致性）</li>
</ol>
<p>最终一致性是指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。弱一致性和强一致性相反，最终一致性是弱一致性的一种特殊情况。</p>
<p>BASE模型是传统ACID模型的反面，不同于ACID，BASE强调牺牲高一致性，从而获得可用性，数据**允许在一段时间内的不一致，只要保证最终一致就可以了**。</p>
<h3 id="22">2.2.   分布式事务解决方案<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<p>分布式事务是企业集成中的一个**技术难点**，也是每一个分布式系统架构中都会涉及到的一个东西，特别是在微服务架构中，<strong>几乎可以说是无法避免</strong>。</p>
<p>主流的解决方案如下：</p>
<ol>
<li>基于XA协议的两阶段提交（2PC）</li>
<li>TCC编程模式</li>
<li>消息事务+最终一致性</li>
</ol>
<h4 id="221-2pc">2.2.1. 两阶段提交（2PC）<a class="headerlink" href="#221-2pc" title="Permanent link">&para;</a></h4>
<p>2PC即两阶段提交协议，是将整个事务流程分为两个阶段，准备阶段（Prepare phase）、提交阶段（commit
phase），2是指两个阶段，P是指准备阶段，C是指提交阶段。</p>
<p><img alt="img" src="../assets/913887-20160328134232723-1604465391.png" /></p>
<p>第一阶段：事务协调器要求每个涉及到事务的数据库预提交(precommit)此操作，并反映是否可以提交.</p>
<p>第二阶段：事务协调器要求每个数据库提交数据。</p>
<p>其中，如果有任何一个数据库否决此次提交，那么所有数据库都会被要求回滚它们在此事务中的那部分信息。</p>
<p>目前主流数据库均支持2PC【2 Phase Commit】</p>
<p>XA 是一个两阶段提交协议，又叫做 XA Transactions。</p>
<p>MySQL从5.5版本开始支持，SQL Server 2005 开始支持，Oracle 7 开始支持。</p>
<p>​       总的来说，XA协议比较简单，而且一旦商业数据库实现了XA协议，使用分布式事务的成本也比较低。但是，XA也有致命的缺点，那就是性能不理想，特别是在交易下单链路，往往并发量很高，XA无法满足高并发场景。</p>
<ol>
<li>两阶段提交涉及多次节点间的网络通信，通信时间太长！</li>
<li>事务时间相对于变长了，锁定的资源的时间也变长了，造成资源等待时间也增加好多。</li>
<li>XA目前在商业数据库支持的比较理想，在mysql数据库中支持的不太理想，mysql的XA实现，没有记录prepare阶段日志，主备切换会导致主库与备库数据不一致。许多nosql也没有支持XA，这让XA的应用场景变得非常狭隘。</li>
</ol>
<p>对应的开源框架：atomikos</p>
<h4 id="222-tcc">2.2.2. TCC补偿式事务<a class="headerlink" href="#222-tcc" title="Permanent link">&para;</a></h4>
<p>是一种编程式分布式事务解决方案。</p>
<p>TCC 其实就是采用的补偿机制，其核心思想是：针对每个操作，都要注册一个与其对应的确认和补偿（撤销）操作。TCC模式要求从服务提供三个接口：Try、Confirm、Cancel。</p>
<ul>
<li>Try：主要是对业务系统做检测及资源预留</li>
<li>Confirm：真正执行业务，不作任何业务检查；只使用Try阶段预留的业务资源；Confirm操作满足幂等性。</li>
<li>Cancel：释放Try阶段预留的业务资源；Cancel操作满足幂等性。</li>
</ul>
<p>整个TCC业务分成两个阶段完成：</p>
<p><img alt="img" src="../assets/434101-20180414152822741-1232436610.png" /></p>
<p>第一阶段：主业务服务分别调用所有从业务的try操作，并在活动管理器中登记所有从业务服务。当所有从业务服务的try操作都调用成功或者某个从业务服务的try操作失败，进入第二阶段。</p>
<p>第二阶段：活动管理器根据第一阶段的执行结果来执行confirm或cancel操作。如果第一阶段所有try操作都成功，则活动管理器调用所有从业务活动的confirm操作。否则调用所有从业务服务的cancel操作。</p>
<p>举个例子，假如 Bob 要向 Smith 转账100元，思路大概是：</p>
<p>我们有一个本地方法，里面依次调用</p>
<ol>
<li>
<p>首先在 Try 阶段，要先检查Bob的钱是否充足，并把这100元锁住，Smith账户也冻结起来。</p>
</li>
<li>
<p>在 Confirm 阶段，执行远程调用的转账的操作，转账成功进行解冻。</p>
</li>
<li>
<p>如果第2步执行成功，那么转账成功，如果第二步执行失败，则调用远程冻结接口对应的解冻方法 (Cancel)。</p>
</li>
</ol>
<p>缺点：</p>
<ul>
<li>Canfirm和Cancel的**幂等性**很难保证。</li>
<li>这种方式缺点比较多，通常在**复杂场景下是不推荐使用**的，除非是非常简单的场景，非常容易提供回滚Cancel，而且依赖的服务也非常少的情况。</li>
<li>这种实现方式会造成**代码量庞大，耦合性高**。而且非常有局限性，因为有很多的业务是无法很简单的实现回滚的，如果串行的服务很多，回滚的成本实在太高。</li>
</ul>
<p>不少大公司里，其实都是自己研发 TCC 分布式事务框架的，专门在公司内部使用。国内开源出去的：ByteTCC，TCC-transaction，Himly。</p>
<h4 id="223">2.2.3. 消息事务+最终一致性<a class="headerlink" href="#223" title="Permanent link">&para;</a></h4>
<p>基于消息中间件的两阶段提交往往用在高并发场景下，将一个分布式事务拆成一个消息事务（A系统的本地操作+发消息）+B系统的本地操作，其中B系统的操作由消息驱动，只要消息事务成功，那么A操作一定成功，消息也一定发出来了，这时候B会收到消息去执行本地操作，如果本地操作失败，消息会重投，直到B操作成功，这样就变相地实现了A与B的分布式事务。</p>
<p><img alt="1567702580183" src="../assets/1567702580183.png" /></p>
<p>虽然上面的方案能够完成A和B的操作，但是A和B并不是严格一致的，而是最终一致的，我们在这里牺牲了一致性，换来了性能的大幅度提升。当然，这种玩法也是有风险的，如果B一直执行不成功，那么一致性会被破坏，具体要不要玩，还是得看业务能够承担多少风险。</p>
<p>适用于高并发最终一致</p>
<p>低并发基本一致：二阶段提交</p>
<p>高并发强一致：没有解决方案</p>
<h2 id="3-seata">3. 分布式事务框架-seata<a class="headerlink" href="#3-seata" title="Permanent link">&para;</a></h2>
<p>seata：Simple Extensible Autonomous Transaction Architecture</p>
<p>官方：<a href="https://github.com/seata/seata">https://github.com/seata/seata</a></p>
<p>中文wiki：<a href="https://github.com/seata/seata">https://github.com/seata/seata</a></p>
<p>2019 年 1 月，阿里巴巴中间件团队发起了开源项目 Fescar（Fast &amp; EaSy Commit And Rollback），和社区一起共建开源分布式事务解决方案。Fescar 的愿景是让分布式事务的使用像本地事务的使用一样，简单和高效，并逐步解决开发者们遇到的分布式事务方面的所有难题。</p>
<p><strong>Fescar 开源后，蚂蚁金服加入 Fescar 社区参与共建，并在 Fescar 0.4.0 版本中贡献了 TCC 模式。</strong></p>
<p>为了打造更中立、更开放、生态更加丰富的分布式事务开源社区，经过社区核心成员的投票，大家决定对 Fescar 进行品牌升级，并更名为 <strong>Seata</strong>，意为：<strong>Simple Extensible Autonomous Transaction Architecture</strong>，是一套一站式分布式事务解决方案。</p>
<p>Seata 融合了阿里巴巴和蚂蚁金服在分布式事务技术上的积累，并沉淀了新零售、云计算和新金融等场景下丰富的实践经验，但要实现**适用于所有的分布式事务场景**的愿景，仍有很长的路要走。因此，我们决定建立一个完全中立的分布式事务组织，希望更多的企业、开发者能够加入我们，一起打造 Seata。</p>
<p>历史：</p>
<p><strong>Ant Financial</strong></p>
<p>XTS：Extended Transaction Service，可扩展事务服务。蚂蚁金服中间件团队自2007年以来开发了分布式事务中间件，广泛应用于Ant Financial，解决了跨数据库和服务的数据一致性问题。</p>
<p>DTX：Distributed Transaction Extended。自2013年以来，XTS已在Ant Financial Cloud上发布，名称为DTX。</p>
<p><strong>阿里巴巴</strong></p>
<p>TXC：Taobao Transaction Constructor。阿里巴巴中间件团队自2014年起启动该项目，以解决因应用程序架构从单片机改为微服务而导致的分布式事务问题。</p>
<p>GTS：Global Transaction Service。 TXC作为Aliyun中间件产品，新名称GTS自2016年起发布。</p>
<p>Fescar：我们从2019年开始基于TXC / GTS开源开源项目Fescar，以便在未来与社区密切合作。</p>
<p><strong>Seata社区</strong></p>
<p>Seata：简单的可扩展自治交易架构。 Ant Financial加入Fescar，使其成为一个更加中立和开放的分布式服务社区，并将Fescar更名为Seata。</p>
<h3 id="31">3.1. 结构<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>Seata有3个基本组件：</p>
<ul>
<li>Transaction Coordinator(TC)：事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚。</li>
<li>Transaction Manager(TM)：事务管理器，控制**全局事务**的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议。</li>
<li>Resource Manager(RM)：资源管理器，控制**分支事务**，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚。</li>
</ul>
<p><img alt="Model" src="assets/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f6c61726b2f302f323031382f706e672f31383836322f313534353031333931353238362d34613930663064662d356664612d343165312d393165302d3261613364333331633033352e706e67.png" /></p>
<p>全局事务与分支事务：</p>
<p>a Distributed Transaction is a Global Transaction which is made up with a batch of Branch Transaction, and normally Branch Transaction is just Local Transaction.</p>
<p><img alt="1567735232409" src="../assets/1567735232409.png" /></p>
<p>Seata管理分布式事务的典型生命周期：</p>
<ul>
<li>TM 向 TC 申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的 XID。</li>
<li>XID 在微服务调用链路的上下文中传播。</li>
<li>RM 向 TC 注册分支事务，将其纳入 XID 对应全局事务的管辖。</li>
<li>TM 向 TC 发起针对 XID 的全局提交或回滚决议。</li>
<li>TC 调度 XID 下管辖的全部分支事务完成提交或回滚请求。</li>
</ul>
<p><img alt="Architecture" src="../assets/seata_procees.png" /> </p>
<p>至此，seata的协议机制总体上看与 XA 是一致的。但是是有差别的：</p>
<p><img alt="RM in Architecture" src="../assets/seata-xa.png" /></p>
<p>XA 方案的 RM 实际上是在数据库层，RM 本质上就是数据库自身（通过提供支持 XA 的驱动程序来供应用使用）。</p>
<p>而 Fescar 的 RM 是以二方包的形式作为中间件层部署在应用程序这一侧的，不依赖于数据库本身对协议的支持，当然也不需要数据库支持 XA 协议。这点对于微服务化的架构来说是非常重要的：应用层不需要为本地事务和分布式事务两类不同场景来适配两套不同的数据库驱动。</p>
<p>这个设计，剥离了分布式事务方案对数据库在 <strong>协议支持</strong> 上的要求。</p>
<h3 id="32">3.2. 快速入门<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>springCloud整合seata案例：<a href="https://github.com/seata/seata-samples/tree/master/springcloud-jpa-seata">https://github.com/seata/seata-samples/tree/master/springcloud-jpa-seata</a></p>
<p>案例工程结构如下：</p>
<p><img alt="undefined" src="../assets/seata-springcloud-sample.png" /> </p>
<p>接下来，就根据这个官方案例学习seata该怎么使用。</p>
<p>课前资料中的demo工程就是基于官方的案例修改后的demo。</p>
<p><img alt="1590146449906" src="../assets/1590146449906.png" /></p>
<p>解压后把springcloud-jpa-seata工程，导入eclipse。导入后：</p>
<p><img alt="1567743542465" src="../assets/1567743542465.png" /></p>
<p>怎么启动这些工程，官方也给出文档，参照demo工程中README.md：</p>
<p><img alt="1567743654040" src="../assets/1567743654040.png" /></p>
<h4 id="321-sql">3.2.1. 执行sql<a class="headerlink" href="#321-sql" title="Permanent link">&para;</a></h4>
<p>把压缩包下springcloud-jpa-seata/sql目录下的sql文件导入数据库</p>
<p><img alt="1567744673843" src="../assets/1567744673843.png" /></p>
<p>导入后，有案例工程微服务对应的3个数据库：</p>
<p><img alt="1567744814798" src="../assets/1567744814798.png" /></p>
<h4 id="322-seata-server">3.2.2. 启动seata-server<a class="headerlink" href="#322-seata-server" title="Permanent link">&para;</a></h4>
<p>下载地址：<a href="https://github.com/seata/seata/releases">https://github.com/seata/seata/releases</a></p>
<p>自行下载，或者使用课前资料中提供的。</p>
<p><img alt="1590147857778" src="../assets/1590147857778.png" /></p>
<p>解压后双击bin目录下的seata-server.bat</p>
<p><img alt="1590147942860" src="../assets/1590147942860.png" /></p>
<h4 id="323">3.2.3. 启动各个微服务<a class="headerlink" href="#323" title="Permanent link">&para;</a></h4>
<p>先修改各个微服务的application.properties中有关数据库连接信息的配置，例如：storage-service</p>
<p><img alt="1567751459520" src="../assets/1567751459520.png" /></p>
<div class="highlight"><pre><span></span><code><span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:mysql://172.16.116.100:3306/db_storage?useSSL=false&amp;serverTimezone=UTC</span><span class="w"></span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">root</span><span class="w"></span>
<span class="na">spring.datasource.password</span><span class="o">=</span><span class="s">root</span><span class="w"></span>
</code></pre></div>
<p>其他微服务，请自行修改。注意：url中的数据库名要对应。</p>
<p>然后，依次启动四个微服务。</p>
<h4 id="324">3.2.4. 测试<a class="headerlink" href="#324" title="Permanent link">&para;</a></h4>
<p>依据官方文档，进行测试：</p>
<p><img alt="1567751856641" src="../assets/1567751856641.png" /></p>
<p>测试前，观察数据库：</p>
<p><img alt="1567752177296" src="../assets/1567752177296.png" /></p>
<p><img alt="1567752217418" src="../assets/1567752217418.png" /></p>
<p><img alt="1567752259127" src="../assets/1567752259127.png" /></p>
<p><strong>正常提交情况：</strong></p>
<p>在浏览器中输入：<a href="http://127.0.0.1:8084/purchase/commit">http://127.0.0.1:8084/purchase/commit</a></p>
<p><img alt="1567752001898" src="../assets/1567752001898.png" /></p>
<p>测试结果：</p>
<p><img alt="1567752312314" src="../assets/1567752312314.png" /></p>
<p><img alt="1567752668656" src="../assets/1567752668656.png" /></p>
<p><img alt="1567752484335" src="../assets/1567752484335.png" /></p>
<p>business-service源码，其实就是1001账户花了5金钱购买了2001物品。前后数据一致</p>
<p><strong>异常回滚情况：</strong></p>
<p>在浏览器访问：<a href="http://127.0.0.1:8084/purchase/rollback">http://127.0.0.1:8084/purchase/rollback</a></p>
<p><img alt="1567752825796" src="../assets/1567752825796.png" /></p>
<p>查看数据库，会发现各个表数据不变！！</p>
<p>查看控制台，account-service、order-service、business-service报错！这是因为business-service的rollback请求的业务（BusinessController）是这样的：</p>
<p><img alt="1567752967167" src="../assets/1567752967167.png" /></p>
<p>在account-service的AccountService中判断账号是否是1002，是就抛出运行时异常。</p>
<p><img alt="1567753059865" src="../assets/1567753059865.png" /></p>
<p>总结流程：浏览器访问/rollback &rarr; business-service的Controller让1002账户买东西 &rarr; order-service创建订单，并远程调用1002的账户信息扣款 &rarr; account-service扣款，并在最后制造一个运行时异常。</p>
<p>导致：account-service异常 &rarr; 调用方order-service异常 &rarr; 调用方business-service异常。</p>
<p>但是：storage-service执行正常。</p>
<p>由于business-service使用了分布式事务，所以storage-service数据要回滚。最后都没有数据更新</p>
<p><img alt="1567753455081" src="../assets/1567753455081.png" /></p>
<p>如果，把@GlobalTransactional注解去掉或者改成@Transactional注解会怎么样？</p>
<p>自行测试一下。肯定会出现分布式事务问题：即库存会被正常扣掉</p>
<h3 id="33">3.3. 快速入门案例的启示<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>springCloud整合seata官方文档：<a href="https://github.com/seata/seata-samples/blob/master/doc/quick-integration-with-spring-cloud.md">https://github.com/seata/seata-samples/blob/master/doc/quick-integration-with-spring-cloud.md</a></p>
<p>玩任何技术，无非就是三个东西：</p>
<ol>
<li>依赖</li>
<li>配置</li>
<li>注解</li>
</ol>
<p>接下来以storage-service为例，总结一下seata的玩法。</p>
<h4 id="331">3.3.1. 前提：日志表<a class="headerlink" href="#331" title="Permanent link">&para;</a></h4>
<p>每个数据库都要有一张undo_log日志表，sql如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">FOREIGN_KEY_CHECKS</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for undo_log</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">undo_log</span><span class="o">`</span><span class="p">;</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">context</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">rollback_info</span><span class="o">`</span><span class="w"> </span><span class="n">longblob</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">log_status</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">log_created</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">log_modified</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">ext</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">ux_undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<h4 id="332">3.3.2. 先看依赖<a class="headerlink" href="#332" title="Permanent link">&para;</a></h4>
<p>引入了两个和seata有关的依赖</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-seata<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.1.0.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.seata<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>seata-all<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<h4 id="333">3.3.3. 再看配置<a class="headerlink" href="#333" title="Permanent link">&para;</a></h4>
<p><img alt="1567754876355" src="../assets/1567754876355.png" /></p>
<p>主要是这4个配置文件：</p>
<ol>
<li>application.properties</li>
<li>registry.conf：配置注册中心和配置中心，默认是file。</li>
<li>file.conf：seata工作规则信息</li>
<li>DataSourceConfig：配置代理数据源实现分支事务，如果没有注入，事务无法成功回滚</li>
</ol>
<h5 id="3331-applicationproperties">3.3.3.1. application.properties<a class="headerlink" href="#3331-applicationproperties" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="na">spring.cloud.alibaba.seata.tx-service-group</span><span class="o">=</span><span class="s">my_test_tx_group</span><span class="w"></span>
</code></pre></div>
<p>需要注意的是 <code>service.vgroup_mapping</code>这个配置，在 Spring Cloud 中默认是<code>${spring.application.name}-fescar-service-group</code>，可以通过指定<code>application.properties</code>的 <code>spring.cloud.alibaba.seata.tx-service-group</code>这个属性覆盖，但是必须要和 <code>file.conf</code>中的一致，否则会提示：</p>
<div class="highlight"><pre><span></span><code>no available service &#39;null&#39; found, please make sure registry config correct
</code></pre></div>
<h5 id="3332-registryconf">3.3.3.2. registry.conf<a class="headerlink" href="#3332-registryconf" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>registry {
  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa
  type = &quot;file&quot;

  nacos {
    serverAddr = &quot;localhost&quot;
    namespace = &quot;public&quot;
    cluster = &quot;default&quot;
  }
  eureka {
    serviceUrl = &quot;http://localhost:8761/eureka&quot;
    application = &quot;default&quot;
    weight = &quot;1&quot;
  }
  redis {
    serverAddr = &quot;localhost:6379&quot;
    db = &quot;0&quot;
  }
  zk {
    cluster = &quot;default&quot;
    serverAddr = &quot;127.0.0.1:2181&quot;
    session.timeout = 6000
    connect.timeout = 2000
  }
  consul {
    cluster = &quot;default&quot;
    serverAddr = &quot;127.0.0.1:8500&quot;
  }
  etcd3 {
    cluster = &quot;default&quot;
    serverAddr = &quot;http://localhost:2379&quot;
  }
  sofa {
    serverAddr = &quot;127.0.0.1:9603&quot;
    application = &quot;default&quot;
    region = &quot;DEFAULT_ZONE&quot;
    datacenter = &quot;DefaultDataCenter&quot;
    cluster = &quot;default&quot;
    group = &quot;SEATA_GROUP&quot;
    addressWaitTime = &quot;3000&quot;
  }
  file {
    name = &quot;file.conf&quot;
  }
}

config {
  # file、nacos 、apollo、zk、consul、etcd3
  type = &quot;file&quot;

  nacos {
    serverAddr = &quot;localhost&quot;
    namespace = &quot;public&quot;
    cluster = &quot;default&quot;
  }
  consul {
    serverAddr = &quot;127.0.0.1:8500&quot;
  }
  apollo {
    app.id = &quot;seata-server&quot;
    apollo.meta = &quot;http://192.168.1.204:8801&quot;
  }
  zk {
    serverAddr = &quot;127.0.0.1:2181&quot;
    session.timeout = 6000
    connect.timeout = 2000
  }
  etcd3 {
    serverAddr = &quot;http://localhost:2379&quot;
  }
  file {
    name = &quot;file.conf&quot;
  }
}
</code></pre></div>
<h5 id="3333-fileconf">3.3.3.3. file.conf<a class="headerlink" href="#3333-fileconf" title="Permanent link">&para;</a></h5>
<p>该文件的命名取决于registry.conf配置中心的配置</p>
<p>由于registry.conf中配置的是</p>
<p><img alt="1567757677307" src="../assets/1567757677307.png" /></p>
<p>也就是说：file.conf文件名取决于registry的配置中心配置，如果registry配置的配置中心不是file，可以没有改文件。例如：如果配置中心是nacos，这是file.conf文件就不需要了，把file.conf文件内容交给nacos就可</p>
<p>网络传输配置：</p>
<div class="highlight"><pre><span></span><code><span class="err">transport</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="c"># tcp udt unix-domain-socket</span><span class="w"></span>
<span class="na">  type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TCP&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c">#NIO NATIVE</span><span class="w"></span>
<span class="na">  server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NIO&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c">#enable heartbeat</span><span class="w"></span>
<span class="na">  heartbeat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="w">  </span><span class="c">#thread factory for netty</span><span class="w"></span>
<span class="w">  </span><span class="err">thread-factory</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="na">    boss-thread-prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NettyBoss&quot;</span><span class="w"></span>
<span class="na">    worker-thread-prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NettyServerNIOWorker&quot;</span><span class="w"></span>
<span class="na">    server-executor-thread-prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NettyServerBizHandler&quot;</span><span class="w"></span>
<span class="na">    share-boss-worker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span><span class="w"></span>
<span class="na">    client-selector-thread-prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NettyClientSelector&quot;</span><span class="w"></span>
<span class="na">    client-selector-thread-size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span><span class="w"></span>
<span class="na">    client-worker-thread-prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NettyClientWorkerThread&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c"># netty boss thread size,will not be used for UDT</span><span class="w"></span>
<span class="na">    boss-thread-size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span><span class="w"></span>
<span class="w">    </span><span class="c">#auto default pin or 8</span><span class="w"></span>
<span class="na">    worker-thread-size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="c">## transaction log store, only used in seata-server</span><span class="w"></span>
<span class="err">store</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="c">## store mode: file、db</span><span class="w"></span>
<span class="na">  mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;file&quot;</span><span class="w"></span>

<span class="w">  </span><span class="c">## file store property</span><span class="w"></span>
<span class="w">  </span><span class="err">file</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="c">## store location dir</span><span class="w"></span>
<span class="na">    dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sessionStore&quot;</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>

<span class="w">  </span><span class="c">## database store property</span><span class="w"></span>
<span class="w">  </span><span class="err">db</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="c">## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.</span><span class="w"></span>
<span class="na">    datasource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dbcp&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c">## mysql/oracle/h2/oceanbase etc.</span><span class="w"></span>
<span class="na">    db-type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span><span class="w"></span>
<span class="na">    driver-class-name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="w"></span>
<span class="na">    url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:mysql://127.0.0.1:3306/seata&quot;</span><span class="w"></span>
<span class="na">    user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span><span class="w"></span>
<span class="na">    password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="err">service</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="c"># 事务分组，默认：${spring.applicaiton.name}-fescar-service-group，可以随便写</span><span class="w"></span>
<span class="w">  </span><span class="c"># 可以通过application.properties的spring.cloud.alibaba.seata.tx-service-group覆盖</span><span class="w"></span>
<span class="na">  vgroup_mapping.${spring.application.name}-fescar-service-group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c"># 仅支持单节点，不要配置多地址，这里的default要和事务分组的值一致</span><span class="w"></span>
<span class="na">  default.grouplist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;127.0.0.1:8091&quot; #seata-server服务器地址，默认是8091</span><span class="w"></span>
<span class="w">  </span><span class="c"># 降级，当前不支持</span><span class="w"></span>
<span class="na">  enableDegrade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span><span class="w"></span>
<span class="w">  </span><span class="c"># 禁用全局事务</span><span class="w"></span>
<span class="na">  disableGlobalTransaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="err">client</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="err">rm</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="na">    async.commit.buffer.limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10000</span><span class="w"></span>
<span class="w">    </span><span class="err">lock</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="na">      retry.internal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10</span><span class="w"></span>
<span class="na">      retry.times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">30</span><span class="w"></span>
<span class="na">      retry.policy.branch-rollback-on-conflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="na">    report.retry.count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5</span><span class="w"></span>
<span class="na">    table.meta.check.enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span><span class="w"></span>
<span class="na">    report.success.enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="w">  </span><span class="err">tm</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="na">    commit.retry.count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5</span><span class="w"></span>
<span class="na">    rollback.retry.count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="w">  </span><span class="err">undo</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="na">    data.validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="na">    log.serialization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jackson&quot;</span><span class="w"></span>
<span class="na">    log.table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;undo_log&quot;</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="w">  </span><span class="err">log</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="na">    exceptionRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">100</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="w">  </span><span class="err">support</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="c"># auto proxy the DataSource bean</span><span class="w"></span>
<span class="na">    spring.datasource.autoproxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>
<h5 id="3334-datasourceconfigjava">3.3.3.4. DataSourceConfig.java<a class="headerlink" href="#3334-datasourceconfigjava" title="Permanent link">&para;</a></h5>
<p>每一个微服务原来自己的数据源都必须使用DataSourceProxy代理，这样seata才能掌控所有事务。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataSourceConfig</span> <span class="p">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;spring.datasource&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">DruidDataSource</span> <span class="nf">druidDataSource</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DruidDataSource</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 需要将 DataSourceProxy 设置为主数据源，否则事务无法回滚</span>
<span class="cm">     *</span>
<span class="cm">     * @param druidDataSource The DruidDataSource</span>
<span class="cm">     * @return The default datasource</span>
<span class="cm">     */</span>
    <span class="nd">@Primary</span>
    <span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;dataSource&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="p">(</span><span class="n">DruidDataSource</span> <span class="n">druidDataSource</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceProxy</span><span class="p">(</span><span class="n">druidDataSource</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="334">3.3.4.   最后注解<a class="headerlink" href="#334" title="Permanent link">&para;</a></h4>
<p>主业务方法添加全局事务：@GlobalTransactional</p>
<p>分支业务方法添加本地事务注解：@Transactional</p>
<h3 id="34">3.4.   给商品新增添加分布式事务<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<h4 id="341-undo_log">3.4.1.   添加undo_log日志表<a class="headerlink" href="#341-undo_log" title="Permanent link">&para;</a></h4>
<p>给每个数据库添加undo_log日志表：</p>
<div class="highlight"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">FOREIGN_KEY_CHECKS</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">-- ----------------------------</span>
<span class="c1">-- Table structure for undo_log</span>
<span class="c1">-- ----------------------------</span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">undo_log</span><span class="o">`</span><span class="p">;</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">context</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">rollback_info</span><span class="o">`</span><span class="w"> </span><span class="n">longblob</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">log_status</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">log_created</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">log_modified</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">`</span><span class="n">ext</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">ux_undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>例如：guli_pms</p>
<p><img alt="1567759877276" src="../assets/1567759877276.png" /></p>
<h4 id="342-gmall-pms">3.4.2.   改造gmall-pms<a class="headerlink" href="#342-gmall-pms" title="Permanent link">&para;</a></h4>
<p>在pom.xml中同一引入seata的依赖：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-seata<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.0.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.seata<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>seata-all<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.8.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p>添加配置文件：</p>
<p><img alt="1567773401161" src="../assets/1567773401161.png" /></p>
<p>registry.conf内容如下：</p>
<div class="highlight"><pre><span></span><code>registry {
  type = &quot;nacos&quot;
  nacos {
    serverAddr = &quot;localhost:8848&quot;
    namespace = &quot;public&quot;
    cluster = &quot;default&quot;
  }
}

config {
  type = &quot;file&quot;
  file {
    name = &quot;file.conf&quot;
  }
}
</code></pre></div>
<p>file.conf内容如下：</p>
<div class="highlight"><pre><span></span><code>service {
  #vgroup-&gt;rgroup
  # 根据工程的服务名修改
  vgroup_mapping.pms-service-fescar-service-group = &quot;default&quot;
  #only support single node
  default.grouplist = &quot;127.0.0.1:8091&quot;
  #degrade current not support
  enableDegrade = false
  #disable
  disable = false
}
</code></pre></div>
<p>DataSourceConfig配置：</p>
<p><img alt="1567775140238" src="../assets/1567775140238.png" /></p>
<p>内容如下：</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataSourceConfig</span> <span class="p">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;spring.datasource&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">hikariDataSource</span><span class="p">(</span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${spring.datasource.url}&quot;</span><span class="p">)</span><span class="n">String</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HikariDataSource</span> <span class="n">hikariDataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HikariDataSource</span><span class="p">();</span>
        <span class="n">hikariDataSource</span><span class="p">.</span><span class="na">setJdbcUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">hikariDataSource</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 需要将 DataSourceProxy 设置为主数据源，否则事务无法回滚</span>
<span class="cm">     *</span>
<span class="cm">     * @param hikariDataSource The HikariDataSource</span>
<span class="cm">     * @return The default datasource</span>
<span class="cm">     */</span>
    <span class="nd">@Primary</span>
    <span class="nd">@Bean</span><span class="p">(</span><span class="s">&quot;dataSource&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="p">(</span><span class="n">DataSource</span> <span class="n">hikariDataSource</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceProxy</span><span class="p">(</span><span class="n">hikariDataSource</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>SpuInfoServiceImpl实现类保存商品信息的主方法：</p>
<div class="highlight"><pre><span></span><code>    <span class="cm">/**</span>
<span class="cm">     * 保存商品信息</span>
<span class="cm">     * @param spuInfoVO</span>
<span class="cm">     */</span>
    <span class="nd">@GlobalTransactional</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveSpuInfoVO</span><span class="p">(</span><span class="n">SpuInfoVO</span> <span class="n">spuInfoVO</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="p">{</span>
        <span class="c1">/// 1.保存spu相关</span>
        <span class="c1">// 1.1. 保存spu基本信息 spu_info</span>
        <span class="k">this</span><span class="p">.</span><span class="na">saveSpuInfo</span><span class="p">(</span><span class="n">spuInfoVO</span><span class="p">);</span>

        <span class="c1">// 1.2. 保存spu的描述信息 spu_info_desc</span>
        <span class="k">this</span><span class="p">.</span><span class="na">spuInfoDescService</span><span class="p">.</span><span class="na">saveSpuDesc</span><span class="p">(</span><span class="n">spuInfoVO</span><span class="p">);</span>

        <span class="c1">// 1.3. 保存spu的规格参数信息</span>
        <span class="k">this</span><span class="p">.</span><span class="na">saveBaseAttrs</span><span class="p">(</span><span class="n">spuInfoVO</span><span class="p">);</span>

        <span class="c1">/// 2. 保存sku相关信息</span>
        <span class="k">this</span><span class="p">.</span><span class="na">saveSkuInfoWithSaleInfo</span><span class="p">(</span><span class="n">spuInfoVO</span><span class="p">);</span>

        <span class="c1">// 最后制造异常</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>
<p>其他所有方法包括SpuInfoDescServiceImpl中的方法都只加普通注解：@Transactional</p>
<h4 id="343-gmall-sms">3.4.3.   改造gmall-sms<a class="headerlink" href="#343-gmall-sms" title="Permanent link">&para;</a></h4>
<p>pom.xml的依赖、file.conf、registry.conf、DataSourceConfig等等直接从gmall-pms拷贝过来即可</p>
<p>只需要把registry.conf中的如下内容修改一下：</p>
<p><img alt="1567775543491" src="../assets/1567775543491.png" /></p>
<p>然后在业务方法上添加@Transactional注解即可。</p>
<h4 id="344-seata-server">3.4.4.   seata-server<a class="headerlink" href="#344-seata-server" title="Permanent link">&para;</a></h4>
<p>一旦我们使用注册中心，进行服务的发现，seata服务器也得配置放在注册中心。</p>
<p>修改registry.conf配置文件，把seata-server事务协调管理器也注册到nacos注册中心</p>
<p><img alt="1567775739170" src="../assets/1567775739170.png" /></p>
<p>如下内容修改一下：</p>
<p><img alt="1567775909128" src="../assets/1567775909128.png" /></p>
<p>回到bin目录下，重新启动seata-server。</p>
<h4 id="345">3.4.5.   主键问题<a class="headerlink" href="#345" title="Permanent link">&para;</a></h4>
<p><img alt="1567770750119" src="../assets/1567770750119.png" /></p>
<p><img alt="1567770815333" src="../assets/1567770815333.png" /></p>

              
			  <hr><span id="busuanzi_container_page_pv"><font size="3" color="grey">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</font></span><br/>
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../2.%E5%88%86%E7%B1%BB%E3%80%81%E8%A7%84%E6%A0%BC%E3%80%81%E5%95%86%E5%93%81%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%8F%8A%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 谷粒商城02" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              谷粒商城02
            </div>
          </div>
        </a>
      
      
        
        <a href="../../4.elasticsearch%28DSL%E5%8F%8ASpringData-Elasticsearch%29/elasticsearch/" class="md-footer__link md-footer__link--next" aria-label="Next: 谷粒商城04" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              谷粒商城04
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 尚硅谷
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>